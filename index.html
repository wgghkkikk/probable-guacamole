<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„ØºØ±Ù Ø§Ù„Ù…Ù„ÙƒÙŠØ© ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    
    <style>
        :root { --main: #ffd700; --bg: #000; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Ø´Ø±ÙŠØ· Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØºØ±Ù */
        .room-tabs { display: flex; background: #111; border-bottom: 2px solid var(--main); }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: bold; transition: 0.3s; color: #888; border-left: 1px solid #222; }
        .tab.active { background: var(--main); color: #000; box-shadow: inset 0 0 10px rgba(0,0,0,0.5); }

        #master-layout { display: flex; flex: 1; gap: 10px; padding: 10px; overflow: hidden; }
        .panel { background: #0a0a0a; border: 2px solid #222; border-radius: 15px; display: flex; flex-direction: column; }
        .drag-handle { background: #111; padding: 8px; cursor: move; text-align: center; font-size: 11px; color: var(--main); border-radius: 13px 13px 0 0; }

        #sidebar { width: 200px; flex-shrink: 0; }
        #main-chat-area { flex-grow: 1; }

        /* Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .mics-row { display: flex; gap: 5px; padding: 8px; background: #0f0f0f; }
        .mic-slot { flex: 1; background: #1a1a1a; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 1px dashed #444; }
        
        #yt-box { padding: 10px; background: #0f0f0f; border-bottom: 1px solid #222; }
        #video-screen { display: none; height: 180px; margin-top: 5px; border-radius: 10px; overflow: hidden; }

        #chat-window { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 12px; max-width: 80%; border: 1px solid #222; }
        .msg.me { align-self: flex-end; border-right: 3px solid var(--main); background: #1a1a1a; }
        .msg.bot { align-self: center; border: 1px solid #00f2ff; color: #00f2ff; text-align: center; width: 90%; }

        .input-bar { padding: 12px; background: #0a0a0a; display: flex; gap: 10px; border-top: 1px solid #222; }
        input[type="text"] { flex: 1; background: #000; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 20px; outline: none; }
        button.send { background: var(--main); border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="room-tabs">
        <div id="tab-main" class="tab active" onclick="switchRoom('main')">ğŸ›ï¸ Ø§Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¹Ø§Ù…</div>
        <div id="tab-private" class="tab" onclick="switchRoom('private')">ğŸ¤« Ø§Ù„ØºØ±ÙØ© Ø§Ù„ÙØ±Ø¹ÙŠØ©</div>
    </div>

    <div id="master-layout">
        <div id="sidebar" class="panel">
            <div class="drag-handle">âœ¥ Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† âœ¥</div>
            <div id="users-list" style="padding:10px;"></div>
        </div>

        <div id="main-chat-area" class="panel">
            <div class="drag-handle">âœ¥ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© âœ¥</div>
            
            <div id="main-room-extras">
                <div class="mics-row">
                    <div class="mic-slot" id="m1">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ</div>
                    <div class="mic-slot" id="m2">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ</div>
                    <div class="mic-slot" id="m3">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ</div>
                    <div class="mic-slot" id="m4">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ</div>
                </div>
                <div id="yt-box">
                    <input type="text" id="yt-search" placeholder="Ø¨Ø­Ø« ÙŠÙˆØªÙŠÙˆØ¨..." style="width:70%; background:#000; color:#fff; border:1px solid #333; padding:5px;">
                    <button onclick="doSearch()">ğŸ”</button>
                    <div id="video-screen"></div>
                </div>
            </div>

            <div id="chat-window"></div>

            <div class="input-bar">
                <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...">
                <button class="send" onclick="postMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    
    let currentRoom = 'main'; // Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    let myName = "";

    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨
    new Sortable(document.getElementById('master-layout'), { handle: '.drag-handle', animation: 200 });

    auth.onAuthStateChanged(user => {
        if (user) {
            myName = user.email === "rgrghh77@gmail.com" ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('status/' + user.uid).set({ n: myName });
            db.ref('status/' + user.uid).onDisconnect().remove();
            switchRoom('main');
            loadUsers();
            syncMics();
        } else { window.location.href = "index.html"; }
    });

    // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØºØ±Ù
    function switchRoom(room) {
        currentRoom = room;
        // ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById('tab-main').classList.toggle('active', room === 'main');
        document.getElementById('tab-private').classList.toggle('active', room === 'private');
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¹Ø§Ù… (ÙŠÙˆØªÙŠÙˆØ¨ ÙˆÙ…Ø§ÙŠÙƒØ§Øª)
        document.getElementById('main-room-extras').style.display = (room === 'main') ? 'block' : 'none';
        
        // ØªØµÙÙŠØ± Ø§Ù„Ø´Ø§Øª ÙˆØªØ­Ù…ÙŠÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
        document.getElementById('chat-window').innerHTML = '';
        db.ref('msgs/' + currentRoom).off(); // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØºØ±ÙØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        loadMessages();
    }

    function postMsg() {
        const inp = document.getElementById('msgInput');
        if(!inp.value.trim()) return;
        db.ref('msgs/' + currentRoom).push({ u: myName, t: inp.value, m: myName.includes("ğŸ‘‘") });
        inp.value = '';
    }

    function loadMessages() {
        db.ref('msgs/' + currentRoom).limitToLast(30).on('child_added', snap => {
            const d = snap.val();
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.className = `msg ${d.m ? 'me' : 'other'}`;
            div.innerHTML = `<small style="color:var(--main);">${d.u}</small><br>${d.t}`;
            win.appendChild(div);
            win.scrollTop = win.scrollHeight;
        });
    }

    function loadUsers() {
        db.ref('status').on('value', snap => {
            const list = document.getElementById('users-list');
            list.innerHTML = `<div style="color:#00f2ff; margin-bottom:10px;">ğŸ¤– Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ©</div>`;
            snap.forEach(u => {
                list.innerHTML += `<div style="font-size:12px; margin-bottom:5px;">ğŸŸ¢ ${u.val().n}</div>`;
            });
        });
    }

    // (ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ ÙˆØ§Ù„Ù…Ø§ÙŠÙƒØ§Øª Ù…Ø¯Ù…Ø¬Ø© Ù„ØªØ¹Ù…Ù„ ÙÙŠ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙ‚Ø·)
    // ... ØªÙ… Ø§Ø®ØªØµØ§Ø±Ù‡Ø§ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ø±Ø¹Ø© Ø§Ù„ÙƒÙˆØ¯ ÙˆÙ…Ø³Ø§Ø­ØªÙ‡ ...
    function syncMics() {
        for(let i=1; i<=4; i++) {
            db.ref('mics/s'+i).on('value', s => {
                document.getElementById('m'+i).innerHTML = s.val() ? `ğŸ¤ ${s.val().n}` : `ğŸ™ï¸ Ø®Ø§Ù„ÙŠ`;
            });
        }
    }
</script>
</body>
</html>
