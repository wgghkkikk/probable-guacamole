<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER RG - ROYAL SYSTEM</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --owner-bg: linear-gradient(45deg, #ff0000, #550000, #ff0000);
            --admin-bg: linear-gradient(45deg, #7000ff, #000033, #7000ff);
            --gold: #ffd700;
        }
        body { margin: 0; background: #000; color: #fff; font-family: 'Cairo', sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ù…Ø¹ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« */
        header { 
            padding: 10px 20px; background: #0a0a0a; border-bottom: 2px solid #1a1a1a;
            display: flex; justify-content: space-between; align-items: center;
        }
        .refresh-btn { 
            cursor: pointer; text-align: center; color: var(--gold); 
            transition: 0.3s; display: flex; flex-direction: column; align-items: center;
        }
        .refresh-btn:active { transform: rotate(180deg); }
        .refresh-btn i { font-size: 24px; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ù…ØªØ­Ø±Ùƒ (Ù…Ø«Ù„ Ø·Ù„Ø¨Ùƒ) */
        .rank-bar {
            position: relative; width: 220px; height: 35px; 
            margin: 5px auto; border-radius: 50px; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 14px; text-shadow: 0 0 5px #000;
            border: 1px solid rgba(255,255,255,0.2);
        }
        /* Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…ØªØ­Ø±Ùƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±ØªØ¨Ø© */
        .rank-bar::before {
            content: ""; position: absolute; inset: 0;
            background: var(--owner-bg); background-size: 200% 200%;
            animation: move-bg 3s linear infinite; z-index: -1;
        }
        @keyframes move-bg { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }

        /* Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„Ù…Ù†ØªØµÙ */
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .msg-container { width: 100%; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .msg-content { 
            max-width: 85%; padding: 12px 20px; border-radius: 15px; 
            background: rgba(255,255,255,0.03); border: 1px solid #1a1a1a;
            font-size: 16px; position: relative;
        }
        .owner-glow { box-shadow: 0 0 15px rgba(255,0,0,0.4); border-color: #ff0000 !important; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        #side-list {
            position: fixed; right: -280px; top: 0; bottom: 0; width: 260px;
            background: #050505; border-left: 2px solid var(--gold); transition: 0.4s; z-index: 1000;
        }
        #side-list.active { right: 0; }

        /* Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-box { padding: 15px; background: #0a0a0a; display: flex; gap: 10px; border-top: 1px solid #1a1a1a; }
        #mInp { flex: 1; background: #151515; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 10px; }
        .send-btn { background: var(--gold); border: none; padding: 0 20px; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 20px; font-weight: 900; color: var(--gold);">MASTER RG ğŸ‘‘</div>
    <div class="refresh-btn" onclick="location.reload()">
        <span style="font-size:20px;">ğŸ”„</span>
        <span style="font-size:10px;">ØªØ­Ø¯ÙŠØ«</span>
    </div>
    <button onclick="document.getElementById('side-list').classList.toggle('active')" style="background:none; border:1px solid var(--gold); color:var(--gold); border-radius:5px; padding:5px 10px;">ğŸ‘¥</button>
</header>

<div id="side-list">
    <h4 style="text-align:center; color:var(--gold); border-bottom:1px solid #222; padding:15px;">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† Ø§Ù„Ø¢Ù†</h4>
    <div id="users"></div>
</div>

<div id="chat-window"></div>

<div class="input-box">
    <input type="text" id="mInp" placeholder="Ø³ÙˆÙ„Ù ÙŠØ§ Ù…Ù„Ùƒ Ø§Ù„ÙØ®Ø§Ù…Ø©...">
    <button onclick="sendMsg()" class="send-btn">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let myName = localStorage.getItem('rg_name') || "";
    if(!myName) {
        myName = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
        if(myName) localStorage.setItem('rg_name', myName); else location.reload();
    }

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±ØªØ¨Ø© - Ø¹Ø¯Ù„ "Ù…Ø§Ø³ØªØ±" Ù„Ø§Ø³Ù…Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    let role = (myName === "Ù…Ø§Ø³ØªØ±" || myName === "MASTER RG") ? "ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª" : "Ø¹Ø¶Ùˆ Ù…Ù…ÙŠØ²";

    function sendMsg() {
        let t = document.getElementById('mInp').value.trim();
        if(!t) return;
        db.ref('rooms/main').push({
            u: myName,
            t: t,
            r: role,
            time: Date.now()
        });
        document.getElementById('mInp').value = "";
    }

    function load() {
        db.ref('rooms/main').limitToLast(40).on('child_added', snap => {
            let m = snap.val();
            let isOwner = m.r === "ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª";
            let div = document.createElement('div');
            div.className = "msg-container";
            div.innerHTML = `
                <div class="rank-bar" style="${isOwner ? '' : 'background: #333;'}">
                    ${isOwner ? 'ğŸ‘‘ ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª ğŸ‘‘' : m.r}
                </div>
                <div style="color:var(--gold); font-size:12px; margin-bottom:5px;">${m.u}</div>
                <div class="msg-content ${isOwner ? 'owner-glow' : ''}">
                    ${m.t}
                </div>
            `;
            document.getElementById('chat-window').appendChild(div);
            document.getElementById('chat-window').scrollTop = document.getElementById('chat-window').scrollHeight;
        });
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ§Ø¬Ø¯
    db.ref('online/'+myName).set({ n: myName, r: role });
    db.ref('online/'+myName).onDisconnect().remove();
    db.ref('online').on('value', snap => {
        let list = document.getElementById('users');
        list.innerHTML = "";
        snap.forEach(u => {
            let user = u.val();
            list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #111; font-size:13px;">ğŸŸ¢ ${user.n} <small style="color:var(--gold)">(${user.r})</small></div>`;
        });
    });

    load();
</script>
</body>
</html>
