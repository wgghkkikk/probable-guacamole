<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CH-ALLOSH SUPREME 2025</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ff6a00; --dark: #000; --panel: #111; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; margin: 0; padding: 0; }
        
        body, html { 
            height: 100%; width: 100%; background: var(--dark); 
            color: white; overflow: hidden; position: fixed; 
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar { 
            height: 60px; background: #000; border-bottom: 2px solid var(--main);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; position: fixed; top: 0; width: 100%; z-index: 2000;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .content-area {
            position: absolute; top: 60px; bottom: 70px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ÙÙˆØªØ± */
            width: 100%; display: flex;
        }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (ØªØµØ­ÙŠØ­ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª) */
        .side {
            position: fixed; top: 60px; bottom: 70px; width: 280px;
            background: var(--panel); z-index: 1500; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto; border: 1px solid #222;
        }

        /* Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† -> ÙŠØ³Ø§Ø± Ø­ØµØ±Ø§Ù‹ */
        #left-side { left: -280px; }
        #left-side.open { left: 0; }

        /* Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -> ÙŠÙ…ÙŠÙ† Ø­ØµØ±Ø§Ù‹ */
        #right-side { right: -280px; }
        #right-side.open { right: 0; }

        /* Ø§Ù„Ø´Ø§Øª */
        .chat-container {
            flex: 1; height: 100%; overflow-y: auto; padding: 15px;
            display: flex; flex-direction: column; gap: 10px;
        }

        /* Ø§Ù„ÙÙˆØªØ± Ø§Ù„Ø£Ø³ÙÙ„ */
        .bottom-bar {
            position: fixed; bottom: 0; height: 70px; width: 100%;
            background: #0a0a0a; border-top: 1px solid #222;
            display: flex; align-items: center; padding: 0 10px; gap: 10px; z-index: 2000;
        }

        #msg-input {
            flex: 1; height: 45px; background: #1a1a1a; border: 1px solid #333;
            border-radius: 25px; color: white; padding: 0 15px; outline: none; font-size: 16px;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¹Ø§Ø¦Ù… */
        #yt-float {
            position: fixed; top: 70px; left: 10px; width: 200px; 
            background: #111; border: 1px solid var(--main); border-radius: 10px;
            z-index: 2500; display: none; overflow: hidden;
        }

        /* Ø§Ù„Ø­Ø§Ø³Ø¨Ø© */
        @media (min-width: 1024px) {
            .side { position: relative; top: 0; bottom: 0; width: 0; visibility: hidden; }
            .side.open { width: 300px; visibility: visible; }
            #left-side { order: -1; }
            #right-side { order: 1; }
        }

        /* Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #gate { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; }
        .card { background: #111; padding: 30px; border: 2px solid var(--main); border-radius: 20px; text-align: center; width: 300px; }
        
        .msg { background: #161616; padding: 10px; border-radius: 10px; border-right: 4px solid var(--main); }
    </style>
</head>
<body>

<div id="gate">
    <div class="card">
        <h2 style="color:var(--main); margin-bottom: 20px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©</h2>
        <input type="text" id="user-nick" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" style="width:100%; padding:10px; border-radius:10px; margin-bottom: 20px;">
        <button onclick="login()" style="width:100%; padding:10px; background:var(--main); color:white; border:none; border-radius:10px; font-weight:bold;">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div id="yt-float">
    <div style="background:#222; padding:5px; display:flex; justify-content:space-between;">
        <span style="font-size:10px;">Player</span>
        <b onclick="document.getElementById('yt-float').style.display='none'" style="cursor:pointer;">X</b>
    </div>
    <iframe id="yt-frame" style="width:100%; height:120px;" frameborder="0"></iframe>
</div>

<div class="top-bar">
    <button onclick="toggleSide('left')" style="background:none; border:none; font-size:24px; color:white;">ğŸ‘¥</button>
    <div style="color:var(--main); font-weight:bold;">CH-ALLOSH</div>
    <button onclick="toggleSide('right')" style="background:none; border:none; font-size:24px; color:white;">âš™ï¸</button>
</div>

<div class="content-area">
    <div id="left-side" class="side">
        <div style="padding:20px;"><h3>ğŸ‘¥ Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†</h3><hr><div id="users"></div></div>
    </div>
    
    <div class="chat-container" id="chat-box"></div>

    <div id="right-side" class="side">
        <div style="padding:20px; text-align:center;">
            <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3><hr>
            <img id="my-pic" src="https://via.placeholder.com/80" style="width:80px; border-radius:50%; border:2px solid var(--main); margin:15px 0;">
            <button onclick="pickAvatar()" style="width:100%; padding:8px; background:var(--main); color:white; border:none; border-radius:10px;">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</button>
        </div>
    </div>
</div>

<div class="bottom-bar">
    <button onclick="sendImg()" style="background:none; border:none; font-size:24px; color:var(--main);">â•</button>
    <input type="text" id="msg-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." onkeypress="if(event.key==='Enter') send()">
    <button onclick="send()" style="background:var(--main); border:none; width:45px; height:45px; border-radius:50%; color:white;">ğŸš€</button>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let me = { name: "", color: "#ff6a00", avatar: "https://via.placeholder.com/80" };

    function toggleSide(id) {
        document.getElementById(id + '-side').classList.toggle('open');
    }

    function login() {
        let n = document.getElementById('user-nick').value.trim();
        if(!n) return;
        me.name = n;
        document.getElementById('gate').style.display = 'none';
        start();
    }

    function start() {
        db.ref('p_v14/'+me.name).set(me);
        db.ref('p_v14/'+me.name).onDisconnect().remove();

        db.ref('p_v14').on('value', s => {
            let h = "";
            s.forEach(u => h += `<div style="padding:10px; color:${u.val().color}">â— ${u.val().name}</div>`);
            document.getElementById('users').innerHTML = h;
        });

        db.ref('m_v14').limitToLast(30).on('child_added', s => {
            let d = s.val();
            let box = document.getElementById('chat-box');
            let div = document.createElement('div');
            div.className = "msg";
            
            let text = d.text;
            let yt = text.match(/(?:youtu\.be\/|youtube\.com\/.*v=)([\w-]{11})/);
            if(yt) {
                text = `<div>${text}</div><button onclick="playYT('${yt[1]}')" style="background:red; color:white; border:none; padding:5px; border-radius:5px; margin-top:5px;">â–¶ ØªØ´ØºÙŠÙ„</button>`;
            } else if(text.startsWith('IMG:')) {
                text = `<img src="${text.replace('IMG:','')}" style="width:100%; border-radius:10px;">`;
            }

            div.innerHTML = `<b style="color:${d.color}">${d.sender}:</b> <div>${text}</div>`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
    }

    function playYT(id) {
        document.getElementById('yt-frame').src = "https://www.youtube.com/embed/" + id;
        document.getElementById('yt-float').style.display = 'block';
    }

    function send() {
        let i = document.getElementById('msg-input');
        if(!i.value) return;
        db.ref('m_v14').push({ sender: me.name, color: me.color, text: i.value });
        i.value = "";
    }

    function sendImg() {
        let i = document.createElement('input'); i.type='file'; i.accept='image/*';
        i.onchange = e => {
            let r = new FileReader();
            r.onload = ev => db.ref('m_v14').push({ sender: me.name, color: me.color, text: 'IMG:'+ev.target.result });
            r.readAsDataURL(e.target.files[0]);
        };
        i.click();
    }

    function pickAvatar() {
        let i = document.createElement('input'); i.type='file'; i.accept='image/*';
        i.onchange = e => {
            let r = new FileReader();
            r.onload = ev => {
                document.getElementById('my-pic').src = ev.target.result;
                me.avatar = ev.target.result;
                db.ref('p_v14/'+me.name).update({ avatar: ev.target.result });
            };
            r.readAsDataURL(e.target.files[0]);
        };
        i.click();
    }
</script>
</body>
</html>
