<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘‘ Ø´Ø§Øª Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --bg: #0b0b0b; --panel: #161616; --king-color: #ffcc00; }
        body { margin: 0; font-family: 'Cairo', sans-serif; background: var(--bg); color: white; display: flex; height: 100vh; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙŠÙ†) */
        #user-sidebar { width: 260px; background: var(--panel); border-left: 1px solid #333; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; background: var(--gold); color: black; font-weight: bold; text-align: center; font-size: 18px; }
        #user-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .user-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-bottom: 1px solid #222; }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--gold); }
        .user-name-list { font-size: 14px; font-weight: bold; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #chat-main { flex-grow: 1; display: flex; flex-direction: column; background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png'); }
        header { padding: 15px 25px; background: #111; display: flex; justify-content: space-between; border-bottom: 2px solid var(--gold); align-items: center; }
        
        #messages { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .msg-box { max-width: 70%; padding: 10px 15px; border-radius: 12px; position: relative; }
        .king-msg { align-self: flex-start; background: linear-gradient(45deg, #222, #333); border-right: 4px solid var(--gold); color: var(--king-color); }
        .user-msg { align-self: flex-end; background: #222; border-left: 4px solid #555; }
        .msg-info { font-size: 11px; margin-bottom: 5px; display: flex; justify-content: space-between; gap: 10px; opacity: 0.8; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
        #input-container { padding: 20px; background: #111; display: flex; gap: 10px; border-top: 1px solid #333; }
        #msg-input { flex-grow: 1; background: #222; border: 1px solid #444; padding: 12px; border-radius: 8px; color: white; outline: none; }
        #msg-input:focus { border-color: var(--gold); }
        .btn-send { background: var(--gold); color: black; border: none; padding: 0 25px; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù…Ø®ÙÙŠØ©) */
        #king-panel { position: fixed; bottom: 80px; right: 20px; background: var(--panel); border: 1px solid var(--gold); padding: 15px; border-radius: 10px; display: none; }
    </style>
</head>
<body>

    <aside id="user-sidebar">
        <div class="sidebar-header">ğŸ›¡ï¸ ÙØ±Ø³Ø§Ù† Ø§Ù„Ù…Ù…Ù„ÙƒØ©</div>
        <div id="user-list">
            <div class="user-item">
                <img src="https://via.placeholder.com/35/gold/black?text=ğŸ‘‘" class="user-avatar">
                <span class="user-name-list" style="color: var(--gold);">Ø§Ù„Ù…Ù„Ùƒ Ø¹Ù„ÙˆØ´</span>
            </div>
            </div>
    </aside>

    <main id="chat-main">
        <header>
            <div style="font-size: 20px; font-weight: bold;">ğŸ‘‘ Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ <small style="font-size: 10px; color: gold;">(Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©)</small></div>
            <button onclick="togglePanel()" style="background:none; border:1px solid gold; color:gold; cursor:pointer; padding:5px 10px; border-radius:5px;">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        </header>

        <div id="messages"></div>

        <div id="king-panel">
            <button onclick="clearChat()" style="width:100%; margin-bottom:10px; color: red;">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</button>
            <button onclick="changeTopic()" style="width:100%;">ğŸ“¢ ØªØºÙŠÙŠØ± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
        </div>

        <div id="input-container">
            <input type="text" id="msg-input" placeholder="Ø§ÙƒØªØ¨ Ù…Ø±Ø³ÙˆÙ…Ùƒ Ø§Ù„Ù…Ù„ÙƒÙŠ ÙŠØ§ Ø¹Ù„ÙˆØ´...">
            <button class="btn-send" onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </main>

    <script>
        const firebaseConfig = { databaseURL: "https://alloush-kingdom-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function send() {
            const inp = document.getElementById('msg-input');
            if(inp.value.trim() !== "") {
                db.ref("messages").push().set({
                    user: "ğŸ‘‘ Ø¹Ù„ÙˆØ´",
                    text: inp.value,
                    rank: "Ø§Ù„Ù…Ù„Ùƒ",
                    time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                    isKing: true
                });
                inp.value = "";
            }
        }

        db.ref("messages").limitToLast(40).on("child_added", (snap) => {
            const m = snap.val();
            const div = document.createElement('div');
            div.className = `msg-box ${m.isKing ? 'king-msg' : 'user-msg'}`;
            div.innerHTML = `
                <div class="msg-info"><span>${m.user} (${m.rank})</span> <span>${m.time}</span></div>
                <div style="word-wrap: break-word;">${m.text}</div>
            `;
            document.getElementById('messages').appendChild(div);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        });

        function togglePanel() {
            const p = document.getElementById('king-panel');
            p.style.display = p.style.display === "none" ? "block" : "none";
        }

        function clearChat() {
            if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø´Ø§ØªØŸ")) {
                db.ref("messages").remove();
                location.reload();
            }
        }
    </script>
</body>
</html>
