<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>MASTER RG - CONTROL PANEL</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        /* Ø«ÙŠÙ… Ù…Ù„ÙƒÙŠ Ø£Ø¨ÙŠØ¶ Ù…Ø±ÙŠØ­ */
        body { font-family: 'Cairo', sans-serif; background: #fdfdfd; margin: 0; display: flex; height: 100vh; }
        #sidebar { width: 280px; border-left: 1px solid #eee; background: #fff; padding: 15px; }
        #chat-area { flex: 1; display: flex; flex-direction: column; }
        
        /* ØªØµÙ…ÙŠÙ… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .admin-box {
            position: fixed; top: 20%; left: 50%; transform: translateX(-50%);
            background: #fff; border: 2px solid #ff0000; padding: 20px;
            border-radius: 15px; box-shadow: 0 5px 30px rgba(0,0,0,0.2);
            display: none; z-index: 1000; text-align: center;
        }
        .btn { padding: 8px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; color: white; }
        .btn-kick { background: #e74c3c; } /* Ø·Ø±Ø¯ */
        .btn-mute { background: #f1c40f; } /* ÙƒØªÙ… */
        .btn-up { background: #2ecc71; }   /* ØªØ±Ù‚ÙŠØ© */
        
        /* Ø±ØªØ¨Ø© Ù…ØªØ­Ø±ÙƒØ© ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª */
        .owner-bar {
            background: linear-gradient(90deg, #ff0000, #330000, #ff0000);
            background-size: 200% auto; animation: shine 3s linear infinite;
            color: white; padding: 2px 10px; border-radius: 5px; font-weight: bold;
        }
        @keyframes shine { to { background-position: 200% center; } }
    </style>
</head>
<body>

<div id="sidebar">
    <h3 style="color: #d4af37;">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† ğŸŒ</h3>
    <div id="userList"></div>
</div>

<div id="chat-area">
    <header style="padding: 15px; background: #fff; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
        <b>MASTER RG ğŸ‘‘</b>
        <div id="myStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª...</div>
    </header>
    <div id="messages" style="flex:1; overflow-y:auto; padding: 20px;"></div>
</div>

<div id="adminPanel" class="admin-box">
    <h4 id="targetUser">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
    <button class="btn btn-kick" onclick="fireAction('kick')">Ø·Ø±Ø¯ Ù†Ù‡Ø§Ø¦ÙŠ â›”</button>
    <button class="btn btn-mute" onclick="fireAction('mute')">ÙƒØªÙ… Ø§Ù„ØµÙˆØª ğŸ”‡</button>
    <button class="btn btn-up" onclick="fireAction('promote')">ØªØ±Ù‚ÙŠØ© Ù…Ø´Ø±Ù ğŸ–ï¸</button>
    <br>
    <button onclick="closePanel()" style="margin-top:10px; border:none; background:none; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
</div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    // 1. ØªØ­Ø¯ÙŠØ¯ Ù‡ÙˆÙŠØªÙƒ
    let myName = localStorage.getItem('master_name') || prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
    if (myName) localStorage.setItem('master_name', myName);

    // Ø§Ù„Ø±ØªØ¨Ø©: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ø³Ù…Ùƒ "Ù…Ø§Ø³ØªØ±" ØªØ£Ø®Ø° ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©
    let myRank = (myName === "Ù…Ø§Ø³ØªØ±" || myName === "MASTER RG") ? "ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª" : "Ø¹Ø¶Ùˆ";
    document.getElementById('myStatus').innerText = "Ø±ØªØ¨ØªÙƒ: " + myRank;

    let selectedUser = "";

    // 2. Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† + Ù…ÙŠØ²Ø© Ø§Ù„Ø¶ØºØ· Ù„Ù„ØªØ­ÙƒÙ…
    db.ref('presence').on('value', snap => {
        const list = document.getElementById('userList');
        list.innerHTML = "";
        snap.forEach(userSnap => {
            const user = userSnap.val();
            const div = document.createElement('div');
            div.style.padding = "10px";
            div.style.cursor = "pointer";
            div.style.borderBottom = "1px solid #f9f9f9";
            div.innerHTML = `<b>${user.n}</b> <small>(${user.r})</small>`;
            
            // Ø¥Ø°Ø§ ÙƒÙ†Øª Ø£Ù†Øª ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§ØªØŒ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø§Ø³Ù… ØªØ¸Ù‡Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            div.onclick = () => {
                if (myRank === "ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª" && user.n !== myName) {
                    selectedUser = user.n;
                    document.getElementById('targetUser').innerText = "Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù€: " + user.n;
                    document.getElementById('adminPanel').style.display = "block";
                }
            };
            list.appendChild(div);
        });
    });

    // 3. ØªÙ†ÙÙŠØ° "Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª" ÙØ¹Ù„ÙŠØ§Ù‹ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function fireAction(actionType) {
        if (actionType === 'kick') {
            db.ref('commands/' + selectedUser).set({ action: 'kick', by: myName });
        } else if (actionType === 'mute') {
            db.ref('commands/' + selectedUser).set({ action: 'mute', by: myName });
        } else if (actionType === 'promote') {
            db.ref('presence/' + selectedUser + '/r').set('Ù…Ø´Ø±Ù');
        }
        closePanel();
    }

    // 4. Ù†Ø¸Ø§Ù… "Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø£ÙˆØ§Ù…Ø±" (Ù‡Ù†Ø§ ÙŠØ­Ø¯Ø« Ø§Ù„Ø·Ø±Ø¯ Ø§Ù„ÙØ¹Ù„ÙŠ)
    db.ref('commands/' + myName).on('value', snap => {
        const cmd = snap.val();
        if (cmd && cmd.action === 'kick') {
            alert("ØªÙ… Ø·Ø±Ø¯Ùƒ Ù…Ù† Ù‚Ø¨Ù„ ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª!");
            document.body.innerHTML = "<h1 style='text-align:center; margin-top:100px;'>Ø£Ù†Øª Ù…Ø·Ø±ÙˆØ¯ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø´Ø§Øª â›”</h1>";
            db.ref('presence/' + myName).remove();
        }
    });

    function closePanel() { document.getElementById('adminPanel').style.display = "none"; }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    db.ref('presence/' + myName).set({ n: myName, r: myRank });
    db.ref('presence/' + myName).onDisconnect().remove();

</script>
</body>
</html>
