<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø­Ø± ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    
    <style>
        :root { --main: #ffd700; --bg: #000; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ±ØªÙŠØ¨ */
        #layout-container { display: flex; flex-direction: row; flex: 1; overflow: hidden; }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙƒØµÙ†Ø§Ø¯ÙŠÙ‚ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø³Ø­Ø¨ */
        .panel { border: 1px solid #222; background: #0a0a0a; position: relative; transition: border 0.3s; }
        .handle { background: #111; padding: 5px; cursor: move; text-align: center; font-size: 10px; color: var(--main); border-bottom: 1px solid #333; }

        #sidebar { width: 200px; }
        #chat-area { flex: 1; display: flex; flex-direction: column; }

        .mic-slots { display: flex; gap: 5px; padding: 5px; background: #111; }
        .slot { flex: 1; background: #1a1a1a; height: 45px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 1px dashed #444; }

        #yt-section { background: #111; padding: 10px; }
        #live-display { display: none; height: 180px; background: #000; border-bottom: 2px solid var(--main); }

        #chat-box { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 12px; max-width: 85%; border: 1px solid #222; }
        .msg.me { align-self: flex-end; border-right: 3px solid var(--main); background: #1a1a1a; }
        .msg.bot { align-self: center; border: 1px solid #00f2ff; background: rgba(0, 242, 255, 0.05); color: #00f2ff; text-align: center; width: 90%; }

        .input-bar { padding: 10px; background: #0a0a0a; display: flex; gap: 10px; border-top: 1px solid #222; }
        input[type="text"] { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #333; background: #000; color: #fff; outline: none; }
        
        #admin-tool { position: fixed; bottom: 70px; left: 10px; background: var(--main); color: #000; border: none; padding: 10px; border-radius: 10px; font-weight: bold; z-index: 1000; display: none; cursor: pointer; }
    </style>
</head>
<body>

    <button id="admin-tool" onclick="resetLayout()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ ğŸ› ï¸</button>

    <div id="layout-container">
        <div id="sidebar" class="panel">
            <div class="handle">::: Ø§Ø³Ø­Ø¨ Ù…Ù† Ù‡Ù†Ø§ Ù„Ù†Ù‚Ù„ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† :::</div>
            <h4 style="text-align:center; color:var(--main); margin:10px 0;">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ†</h4>
            <div id="user-list"></div>
        </div>

        <div id="chat-area" class="panel">
            <div class="handle">::: Ø§Ø³Ø­Ø¨ Ù…Ù† Ù‡Ù†Ø§ Ù„Ù†Ù‚Ù„ Ø§Ù„Ø´Ø§Øª :::</div>
            
            <div class="mic-slots">
                <div class="slot" id="s1">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(1)">ØµØ¹ÙˆØ¯</button></div>
                <div class="slot" id="s2">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(2)">ØµØ¹ÙˆØ¯</button></div>
                <div class="slot" id="s3">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(3)">ØµØ¹ÙˆØ¯</button></div>
                <div class="slot" id="s4">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(4)">ØµØ¹ÙˆØ¯</button></div>
            </div>

            <div id="yt-section">
                <div style="display:flex; gap:5px;">
                    <input type="text" id="yt-inp" placeholder="Ø¨Ø­Ø« ÙŠÙˆØªÙŠÙˆØ¨...">
                    <button onclick="searchYT()" style="background:var(--main); border:none; padding:5px; border-radius:5px;">ğŸ”</button>
                    <button onclick="db.ref('live').remove()" style="background:red; color:#fff; border:none; padding:5px; border-radius:5px;">X</button>
                </div>
                <div id="yt-results" style="display:flex; overflow-x:auto; gap:10px; margin-top:5px;"></div>
            </div>

            <div id="live-display"></div>
            <div id="chat-box"></div>

            <div class="input-bar">
                <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø« ÙŠØ§ Ù…Ù„Ùƒ...">
                <button onclick="send()" style="background:var(--main); border:none; padding:8px 15px; border-radius:20px; font-weight:bold;">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>

<script>
    const YT_KEY = "AIzaSyC4wFkLrA_BlNzreseXQLeSp_40Gbmu9VU";
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    const auth = firebase.auth();
    let myName = "";

    // ØªÙØ¹ÙŠÙ„ Ø®Ø§ØµÙŠØ© Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª Ù„Ù„Ø£Ù‚Ø³Ø§Ù…
    const container = document.getElementById('layout-container');
    new Sortable(container, {
        handle: '.handle', 
        animation: 150,
        ghostClass: 'blue-background-class'
    });

    auth.onAuthStateChanged(user => {
        if (user) {
            const isMe = user.email === "rgrghh77@gmail.com";
            if(isMe) document.getElementById('admin-tool').style.display = 'block';
            myName = isMe ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('status/' + user.uid).set({ n: myName });
            db.ref('status/' + user.uid).onDisconnect().remove();
            loadChat(); loadUsers(); syncMics(); watchYT();
        } else { window.location.href = "index.html"; }
    });

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠ ---
    function checkBot(text) {
        const t = text.toLowerCase();
        if(t === "Ø¨ÙˆØª") sendBot("Ù†Ø¹Ù… ÙŠØ§ Ù…Ù„Ùƒ Ø¹Ù„ÙˆØ´ØŒ Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ø­Ù…Ø§ÙŠØªÙƒ! ğŸ›¡ï¸");
        if(t.includes("Ø¹Ù„ÙˆØ´")) sendBot("Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ Ù‡Ùˆ ØªØ§Ø¬ Ø§Ù„Ø±Ø£Ø³ ğŸ‘‘");
        if(t === "ØªØµÙÙŠØ±") { if(myName.includes("Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±")) db.ref('msgs').remove(); }
    }

    function sendBot(txt) {
        db.ref('msgs').push({ u: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–", t: txt, type: 'bot' });
    }

    // --- ÙŠÙˆØªÙŠÙˆØ¨ ---
    async function searchYT() {
        const q = document.getElementById('yt-inp').value;
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${q}&type=video&maxResults=5&key=${YT_KEY}`);
        const data = await res.json();
        const resDiv = document.getElementById('yt-results');
        resDiv.innerHTML = '';
        data.items.forEach(v => {
            resDiv.innerHTML += `<div onclick="playVideo('${v.id.videoId}')" style="cursor:pointer; min-width:80px;"><img src="${v.snippet.thumbnails.default.url}" width="80"><p style="font-size:8px;">${v.snippet.title.substring(0,10)}</p></div>`;
        });
    }

    function playVideo(id) { db.ref('live').set({ id: id, active: true }); }
    function watchYT() {
        db.ref('live').on('value', snap => {
            const v = snap.val();
            const disp = document.getElementById('live-display');
            if(v && v.active) { disp.style.display = 'block'; disp.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${v.id}?autoplay=1" frameborder="0" allowfullscreen></iframe>`; }
            else { disp.style.display = 'none'; }
        });
    }

    // --- Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙˆØ§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ---
    function send() {
        const i = document.getElementById('mInp');
        if(!i.value.trim()) return;
        db.ref('msgs').push({ u: myName, t: i.value, m: myName.includes("Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±") });
        checkBot(i.value);
        i.value = '';
    }

    function loadChat() {
        db.ref('msgs').limitToLast(25).on('child_added', snap => {
            const d = snap.val();
            const div = document.createElement('div');
            div.className = `msg ${d.type === 'bot' ? 'bot' : (d.m ? 'me' : 'other')}`;
            div.innerHTML = `<b style="font-size:10px; color:var(--main)">${d.u}</b><br>${d.t}`;
            document.getElementById('chat-box').appendChild(div);
            document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
        });
        db.ref('msgs').on('child_removed', () => location.reload());
    }

    function loadUsers() {
        db.ref('status').on('value', snap => {
            const list = document.getElementById('user-list');
            list.innerHTML = `<div style="padding:8px; color:#00f2ff; font-weight:bold;">ğŸ¤– Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ©</div>`;
            snap.forEach(c => { list.innerHTML += `<div style="padding:8px; font-size:12px; border-bottom:1px solid #111;">ğŸŸ¢ ${c.val().n}</div>`; });
        });
    }

    function joinMic(n) {
        const ref = db.ref('mics/s' + n);
        ref.once('value', s => { if(s.val() && s.val().n === myName) ref.remove(); else if(!s.val()) ref.set({ n: myName }); });
    }

    function syncMics() {
        for(let i=1; i<=4; i++) {
            db.ref('mics/s' + i).on('value', s => {
                const el = document.getElementById('s' + i);
                if(s.val()) el.innerHTML = `ğŸ¤ ${s.val().n} <button onclick="joinMic(${i})" style="font-size:8px;">X</button>`;
                else el.innerHTML = `ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(${i})" style="font-size:8px;">ØµØ¹ÙˆØ¯</button>`;
            });
        }
    }

    function resetLayout() { location.reload(); }
</script>
</body>
</html>
