<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; --side-w: 220px; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥Ø®ÙØ§Ø¡ */
        #sidebar { 
            width: var(--side-w); background: #0a0a0a; border-left: 1px solid var(--main); 
            padding: 15px; box-sizing: border-box; flex-shrink: 0; transition: 0.4s;
            position: relative; z-index: 10;
        }
        #sidebar.hidden { margin-right: calc(var(--side-w) * -1); }

        .user-card { padding: 8px; border-radius: 10px; background: #151515; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; border: 1px solid #222; }
        .online-dot { width: 8px; height: 8px; background: #00ff00; border-radius: 50%; }
        .bot-dot { background: #00f2ff; box-shadow: 0 0 8px #00f2ff; }

        .main-chat { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª */
        .mic-slots { display: flex; background: #111; padding: 5px; gap: 5px; border-bottom: 1px solid #222; }
        .slot { flex: 1; background: #1a1a1a; height: 50px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; border: 1px dashed #444; }
        .slot.active { border: 1px solid var(--main); }

        /* Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ */
        .yt-area { background: #111; padding: 10px; border-bottom: 1px solid var(--main); }
        #yt-results { display: flex; overflow-x: auto; gap: 10px; padding: 5px; }
        .yt-card { min-width: 100px; text-align: center; cursor: pointer; }
        .yt-card img { width: 90px; border-radius: 5px; }

        #live-display { display: none; height: 200px; background: #000; }

        #chat-box { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 12px; max-width: 80%; font-size: 14px; }
        .msg.me { align-self: flex-end; background: #222; border-right: 3px solid var(--main); }
        .msg.other { align-self: flex-start; background: #1a1a1a; border-left: 3px solid #eee; }
        .msg.bot { border-right: 3px solid #00f2ff; background: #111; }

        .input-bar { padding: 10px; background: #0a0a0a; display: flex; gap: 10px; border-top: 1px solid #222; }
        input[type="text"] { flex: 1; padding: 10px 15px; border-radius: 20px; border: 1px solid #333; background: #000; color: #fff; outline: none; }
        
        #toggle-hint { position: fixed; top: 10px; right: 10px; font-size: 10px; color: var(--main); z-index: 20; opacity: 0.5; }
    </style>
</head>
<body onclick="checkToggle(event)">

    <div id="toggle-hint">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â†”ï¸</div>

    <div id="sidebar">
        <h4 style="text-align:center; color:var(--main); margin:0 0 10px 0;">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ†</h4>
        <div id="online-users">
            <div class="user-card">
                <div class="online-dot bot-dot"></div>
                <span style="color:#00f2ff; font-weight:bold; font-size:12px;">Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–</span>
            </div>
        </div>
    </div>

    <div class="main-chat">
        <div class="mic-slots">
            <div class="slot" id="s1">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(1)" style="font-size:9px;">ØµØ¹ÙˆØ¯</button></div>
            <div class="slot" id="s2">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(2)" style="font-size:9px;">ØµØ¹ÙˆØ¯</button></div>
            <div class="slot" id="s3">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(3)" style="font-size:9px;">ØµØ¹ÙˆØ¯</button></div>
            <div class="slot" id="s4">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(4)" style="font-size:9px;">ØµØ¹ÙˆØ¯</button></div>
        </div>

        <div class="yt-area">
            <div style="display:flex; gap:5px;">
                <input type="text" id="yt-inp" placeholder="Ø¨Ø­Ø« ÙŠÙˆØªÙŠÙˆØ¨..." style="flex:1; padding:5px; border-radius:5px; border:1px solid #444; background:#000; color:#fff;">
                <button onclick="searchYT()" style="background:var(--main); border:none; padding:5px 15px; border-radius:5px; cursor:pointer;">ğŸ”</button>
            </div>
            <div id="yt-results"></div>
        </div>

        <div id="live-display"></div>

        <div id="chat-box"></div>

        <div class="input-bar">
            <input type="text" id="mInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
            <button onclick="send()" style="background:var(--main); border:none; padding:8px 20px; border-radius:20px; font-weight:bold; cursor:pointer;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

<script>
    const YT_KEY = "AIzaSyC4wFkLrA_BlNzreseXQLeSp_40Gbmu9VU"; 
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    const auth = firebase.auth();
    let myName = "";

    // Ø§Ø®ÙØ§Ø¡ ÙˆØ§Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø¶ØºØ·
    function checkToggle(e) {
        if (e.clientX > window.innerWidth - 50 || e.target.id === "toggle-hint") {
            document.getElementById('sidebar').classList.toggle('hidden');
        }
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            myName = user.email === "rgrghh77@gmail.com" ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('status/' + user.uid).set({ n: myName });
            db.ref('status/' + user.uid).onDisconnect().remove();
            loadChat(); loadUsers(); syncMics(); watchYT();
        } else { window.location.href = "index.html"; }
    });

    // ÙŠÙˆØªÙŠÙˆØ¨
    async function searchYT() {
        const q = document.getElementById('yt-inp').value;
        if(!q) return;
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${q}&type=video&maxResults=5&key=${YT_KEY}`);
        const data = await res.json();
        const resDiv = document.getElementById('yt-results');
        resDiv.innerHTML = '';
        data.items.forEach(v => {
            resDiv.innerHTML += `
                <div class="yt-card" onclick="playVideo('${v.id.videoId}')">
                    <img src="${v.snippet.thumbnails.default.url}">
                    <p style="font-size:9px; color:#fff; margin:2px;">${v.snippet.title.substring(0,20)}</p>
                </div>`;
        });
    }

    function playVideo(id) { db.ref('live').set({ id: id, active: true }); document.getElementById('yt-results').innerHTML = ''; }
    
    function watchYT() {
        db.ref('live').on('value', snap => {
            const v = snap.val();
            const disp = document.getElementById('live-display');
            if(v && v.active) {
                disp.style.display = 'block';
                disp.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${v.id}?autoplay=1" frameborder="0" allowfullscreen></iframe>`;
            } else { disp.style.display = 'none'; }
        });
    }

    // Ù…Ø§ÙŠÙƒØ§Øª
    function joinMic(n) {
        const ref = db.ref('mics/s' + n);
        ref.once('value', s => {
            if(s.val() && s.val().n === myName) ref.remove();
            else if(!s.val()) ref.set({ n: myName });
        });
    }

    function syncMics() {
        for(let i=1; i<=4; i++) {
            db.ref('mics/s' + i).on('value', s => {
                const el = document.getElementById('s' + i);
                if(s.val()) el.innerHTML = `ğŸ¤ ${s.val().n} <button onclick="joinMic(${i})" style="font-size:8px;">Ù†Ø²ÙˆÙ„</button>`;
                else el.innerHTML = `ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(${i})" style="font-size:8px;">ØµØ¹ÙˆØ¯</button>`;
            });
        }
    }

    // Ø´Ø§Øª ÙˆØ¨ÙˆØª
    function send() {
        const i = document.getElementById('mInp');
        if(!i.value.trim()) return;
        db.ref('msgs').push({ u: myName, t: i.value, m: auth.currentUser.email === "rgrghh77@gmail.com" });
        if(i.value === "Ø¨ÙˆØª") {
            setTimeout(()=> db.ref('msgs').push({ u: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–", t: "Ù†Ø¹Ù… ÙŠØ§ Ù…Ù„ÙƒØŒ Ø£Ù†Ø§ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©!", type: 'bot' }), 1000);
        }
        i.value = '';
    }

    function loadChat() {
        db.ref('msgs').limitToLast(30).on('child_added', snap => {
            const d = snap.val();
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = `msg ${d.m ? 'me' : 'other'} ${d.type==='bot' ? 'bot' : ''}`;
            div.innerHTML = `<b style="font-size:10px; color:var(--main)">${d.u}</b><br>${d.t}`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
    }

    function loadUsers() {
        db.ref('status').on('value', snap => {
            const list = document.getElementById('online-users');
            list.innerHTML = `<div class="user-card"><div class="online-dot bot-dot"></div><span style="color:#00f2ff; font-weight:bold; font-size:12px;">Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–</span></div>`;
            snap.forEach(c => {
                list.innerHTML += `<div class="user-card"><div class="online-dot"></div><span style="font-size:12px; color:#fff;">${c.val().n}</span></div>`;
            });
        });
    }
</script>
</body>
</html>
