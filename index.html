<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>MASTER RG - CLEAN EDITION</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --royal-blue: #1a2a6c; --text-color: #2c3e50; --bg-paper: #ffffff; --accent: #e74c3c; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { margin: 0; background: var(--bg-paper); color: var(--text-color); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ù†Ø¸ÙŠÙ Ø¬Ø¯Ø§Ù‹ */
        header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .logo { font-size: 22px; font-weight: 900; color: var(--royal-blue); cursor: pointer; }
        .on-stats { font-size: 11px; color: #888; border: 1px solid #eee; padding: 4px 10px; border-radius: 20px; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø±ÙˆÙ…Ø§Øª Ø¨Ø¯ÙˆÙ† Ø­ÙˆØ§Ù */
        .rooms-bar { display: flex; overflow-x: auto; padding: 10px 15px; gap: 10px; border-bottom: 1px solid #f9f9f9; scrollbar-width: none; }
        .rooms-bar::-webkit-scrollbar { display: none; }
        .r-btn { padding: 6px 15px; border: none; background: #f5f5f5; border-radius: 8px; font-size: 13px; color: #666; cursor: pointer; white-space: nowrap; transition: 0.3s; }
        .r-btn.active { background: var(--royal-blue); color: #fff; font-weight: bold; }

        /* Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù†Ø¸ÙŠÙØ© */
        #chatBox { flex: 1; overflow-y: auto; padding: 20px; background: #fff; }
        .message { margin-bottom: 18px; border-bottom: 1px solid #fcfcfc; padding-bottom: 10px; transition: 0.2s; }
        .u-header { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; cursor: pointer; }
        .u-name { font-weight: 700; color: var(--royal-blue); font-size: 14px; }
        .content { font-size: 16px; line-height: 1.6; color: #333; }
        
        /* Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³ */
        .quote { background: #f8f9fa; padding: 8px 12px; border-right: 3px solid #ddd; font-size: 12px; margin-bottom: 8px; border-radius: 4px; color: #777; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³ÙÙ„ÙŠØ© */
        .input-box { padding: 15px; border-top: 1px solid #eee; display: flex; align-items: center; gap: 12px; background: #fff; }
        #mInput { flex: 1; border: 1px solid #eee; background: #fbfbfb; padding: 12px 15px; border-radius: 12px; outline: none; font-size: 15px; }
        .send-btn { background: var(--royal-blue); color: #fff; border: none; width: 45px; height: 45px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
        #profileView { position: fixed; inset: 0; background: rgba(255,255,255,0.98); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .p-img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--royal-blue); margin-bottom: 15px; object-fit: cover; }

        #repPreview { display: none; padding: 5px 20px; background: #f0f0f0; font-size: 11px; border-top: 1px solid #eee; }
    </style>
</head>
<body>

<header>
    <div class="logo" onclick="openProfile()">MASTER RG ğŸ‘‘</div>
    <div class="on-stats" id="userCount">... Ù…ØªØµÙ„</div>
</header>

<div class="rooms-bar">
    <button class="r-btn active" onclick="changeRoom('main', this)">Ø§Ù„Ø¹Ø±Ø´</button>
    <button class="r-btn" onclick="changeRoom('vip', this)">Ø§Ù„Ø¯ÙŠÙˆØ§Ù†</button>
    <button class="r-btn" onclick="changeRoom('game', this)">Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</button>
    <button class="r-btn" onclick="changeRoom('elite', this)">Ø§Ù„Ù†Ø®Ø¨Ø©</button>
</div>

<div id="chatBox"></div>

<div id="repPreview">
    Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰: <span id="repUser"></span> 
    <button onclick="cancelReply()" style="border:none; background:none; color:red; float:left;">âœ•</button>
</div>

<div class="input-box">
    <input type="text" id="mInput" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...">
    <button onclick="sendMessage()" class="send-btn">â¤</button>
</div>

<div id="profileView">
    <img id="myImg" class="p-img" src="">
    <h2 id="myName"></h2>
    <button onclick="editInfo()" style="padding:10px 20px; border-radius:10px; border:1px solid #ddd; background:none;">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</button>
    <button onclick="closeProfile()" style="margin-top:20px; color:red; border:none; background:none;">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let my = {
        n: localStorage.getItem('rg_n') || "",
        p: localStorage.getItem('rg_p') || "https://ui-avatars.com/api/?name=User"
    };

    if(!my.n) {
        let n = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
        if(n) { localStorage.setItem('rg_n', n); location.reload(); }
    }

    let curRoom = "main", reply = null;

    function changeRoom(id, btn) {
        curRoom = id;
        document.querySelectorAll('.r-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        loadMessages();
    }

    function sendMessage() {
        let t = document.getElementById('mInput').value.trim();
        if(!t) return;
        
        db.ref('rooms/'+curRoom).push({ u: my.n, t: t, p: my.p, reply: reply });
        
        // Ø¨ÙˆØª Ø§Ù„ÙØ²Ø¹Ø©
        const brain = { "Ù‡Ù„Ùˆ": "Ù‡Ù„Ø§ ÙˆØºÙ„Ø§ Ø¨Ù†ÙˆØ± Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ğŸ‘‘", "Ø´Ù„ÙˆÙ†Ùƒ": "Ø¨Ø®ÙŠØ± ÙŠØ§ Ø°Ù‡Ø¨ØŒ Ø£Ù†Øª Ø´Ù„ÙˆÙ†ÙƒØŸ", "Ù…Ù†ÙˆØ±": "Ù†ÙˆØ±Ùƒ Ø¹Ø§ÙƒØ³ ÙŠØ§ ØºØ§Ù„ÙŠ ğŸŒ¹", "ÙƒÙÙˆ": "ÙƒÙÙˆ Ù…Ù†Ùƒ ÙŠØ§ Ø¨Ø·Ù„" };
        for(let k in brain) { if(t.includes(k)) { setTimeout(()=> db.ref('rooms/'+curRoom).push({ u: "ğŸ¤– BOT", t: brain[k], bot: true, p: "https://cdn-icons-png.flaticon.com/512/4712/4712035.png" }), 800); break; } }
        
        cancelReply();
        document.getElementById('mInput').value = "";
    }

    function loadMessages() {
        db.ref('rooms/'+curRoom).off();
        const box = document.getElementById('chatBox');
        box.innerHTML = "";
        db.ref('rooms/'+curRoom).limitToLast(40).on('child_added', snap => {
            let m = snap.val();
            let div = document.createElement('div');
            div.className = "message";
            div.innerHTML = `
                <div class="u-header" onclick="setReply('${m.u}','${m.t}')">
                    <img src="${m.p}" style="width:20px; height:20px; border-radius:50%">
                    <span class="u-name">${m.u}</span>
                    ${m.u === my.n ? `<span style="color:red; font-size:10px; margin-right:auto;" onclick="db.ref('rooms/${curRoom}/${snap.key}').remove()">Ø­Ø°Ù</span>` : ''}
                </div>
                <div class="content" onclick="setReply('${m.u}','${m.t}')">
                    ${m.reply ? `<div class="quote"><b>${m.reply.u}:</b> ${m.reply.t}</div>` : ''}
                    ${m.t}
                </div>`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
    }

    function setReply(u, t) {
        reply = { u, t };
        document.getElementById('repUser').innerText = u;
        document.getElementById('repPreview').style.display = 'block';
    }

    function cancelReply() { reply = null; document.getElementById('repPreview').style.display = 'none'; }

    function openProfile() {
        document.getElementById('myName').innerText = my.n;
        document.getElementById('myImg').src = my.p;
        document.getElementById('profileView').style.display = 'flex';
    }
    function closeProfile() { document.getElementById('profileView').style.display = 'none'; }
    function editInfo() {
        let val = prompt("Ø±Ø§Ø¨Ø· ØµÙˆØ±ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©:");
        if(val) { my.p = val; localStorage.setItem('rg_p', val); openProfile(); }
    }

    db.ref('on/'+my.n).set(true); db.ref('on/'+my.n).onDisconnect().remove();
    db.ref('on').on('value', snap => { document.getElementById('userCount').innerText = snap.numChildren() + " Ù…ØªØµÙ„"; });

    loadMessages();
</script>
</body>
</html>
