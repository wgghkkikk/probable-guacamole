<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¹Ø§Ù… ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    
    <style>
        :root { --main: #ffd700; --bg: #000; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ±ØªÙŠØ¨ */
        #master-layout { display: flex; flex: 1; gap: 10px; padding: 10px; overflow: hidden; }

        .panel { background: #0a0a0a; border: 2px solid #222; border-radius: 15px; display: flex; flex-direction: column; position: relative; }
        .drag-handle { background: #111; padding: 8px; cursor: move; text-align: center; font-size: 11px; color: var(--main); border-radius: 13px 13px 0 0; font-weight: bold; border-bottom: 1px solid #222; }

        #sidebar { width: 220px; flex-shrink: 0; }
        #chat-area { flex-grow: 1; }

        /* Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª */
        .mics-row { display: flex; gap: 5px; padding: 10px; background: #0f0f0f; border-bottom: 1px solid #222; }
        .mic-slot { flex: 1; background: #1a1a1a; height: 50px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; border: 1px dashed #444; }
        .mic-slot.active { border: 1px solid var(--main); box-shadow: 0 0 10px rgba(255,215,0,0.2); }

        /* Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ */
        #yt-section { padding: 10px; background: #0f0f0f; border-bottom: 1px solid var(--main); }
        #video-screen { display: none; height: 200px; background: #000; margin-top: 10px; border-radius: 10px; overflow: hidden; border: 1px solid var(--main); }

        /* Ø§Ù„Ø´Ø§Øª */
        #chat-window { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #050505; }
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 80%; border: 1px solid #222; }
        .msg.me { align-self: flex-end; background: #1a1a1a; border-right: 4px solid var(--main); }
        .msg.bot { align-self: center; background: rgba(0, 242, 255, 0.1); border: 1px solid #00f2ff; color: #00f2ff; text-align: center; width: 90%; }

        .input-bar { padding: 15px; background: #0a0a0a; display: flex; gap: 10px; border-top: 1px solid #222; }
        input[type="text"] { flex: 1; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 25px; outline: none; }
        button.send { background: var(--main); color: #000; border: none; padding: 0 20px; border-radius: 25px; font-weight: bold; cursor: pointer; }

        .bot-tag { color: #00f2ff; font-weight: bold; display: flex; align-items: center; gap: 5px; padding: 5px; border-bottom: 1px solid #111; }
    </style>
</head>
<body>

    <div id="master-layout">
        <div id="sidebar" class="panel">
            <div class="drag-handle">âœ¥ Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† âœ¥</div>
            <div id="users-container" style="padding: 10px; overflow-y: auto;">
                <div class="bot-tag">ğŸ¤– Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ©</div>
                <div id="online-list"></div>
            </div>
        </div>

        <div id="chat-area" class="panel">
            <div class="drag-handle">âœ¥ Ø§Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ âœ¥</div>
            
            <div class="mics-row">
                <div class="mic-slot" id="slot1">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="micAction(1)" style="font-size:8px;">ØµØ¹ÙˆØ¯</button></div>
                <div class="mic-slot" id="slot2">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="micAction(2)" style="font-size:8px;">ØµØ¹ÙˆØ¯</button></div>
                <div class="mic-slot" id="slot3">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="micAction(3)" style="font-size:8px;">ØµØ¹ÙˆØ¯</button></div>
                <div class="mic-slot" id="slot4">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="micAction(4)" style="font-size:8px;">ØµØ¹ÙˆØ¯</button></div>
            </div>

            <div id="yt-section">
                <div style="display:flex; gap:5px;">
                    <input type="text" id="yt-query" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙÙŠØ¯ÙŠÙˆ..." style="flex:1; background:#000; color:#fff; border:1px solid #333; padding:8px; border-radius:5px;">
                    <button onclick="ytSearch()" style="background:var(--main); border:none; padding:8px; border-radius:5px; cursor:pointer;">ğŸ”</button>
                </div>
                <div id="yt-results" style="display:flex; overflow-x:auto; gap:10px; margin-top:5px;"></div>
                <div id="video-screen"></div>
            </div>

            <div id="chat-window"></div>

            <div class="input-bar">
                <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø« ÙŠØ§ Ù…Ù„Ùƒ...">
                <button class="send" onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let myName = "";

    new Sortable(document.getElementById('master-layout'), { handle: '.drag-handle', animation: 200 });

    auth.onAuthStateChanged(user => {
        if (user) {
            myName = user.email === "rgrghh77@gmail.com" ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('status/' + user.uid).set({ n: myName });
            db.ref('status/' + user.uid).onDisconnect().remove();
            initKingdom();
        } else { window.location.href = "index.html"; }
    });

    function initKingdom() {
        loadChat();
        loadUsers();
        syncMics();
        syncYT();
    }

    // --- Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ---
    function sendMsg() {
        const i = document.getElementById('mInp');
        if(!i.value.trim()) return;
        db.ref('main_msgs').push({ u: myName, t: i.value, m: myName.includes("ğŸ‘‘") });
        if(i.value.includes("Ø¨ÙˆØª")) db.ref('main_msgs').push({ u: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–", t: "Ù†Ø¹Ù… ÙŠØ§ Ù…Ù„ÙƒØŒ Ø£Ù†Ø§ ØªØ­Øª Ø£Ù…Ø±Ùƒ!", type: 'bot' });
        i.value = '';
    }

    function loadChat() {
        db.ref('main_msgs').limitToLast(40).on('child_added', snap => {
            const d = snap.val();
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.className = `msg ${d.type === 'bot' ? 'bot' : (d.m ? 'me' : 'other')}`;
            div.innerHTML = `<small style="color:var(--main); font-weight:bold;">${d.u}</small><br>${d.t}`;
            win.appendChild(div);
            win.scrollTop = win.scrollHeight;
        });
    }

    // --- Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ ---
    const YT_KEY = "AIzaSyC4wFkLrA_BlNzreseXQLeSp_40Gbmu9VU";
    async function ytSearch() {
        const q = document.getElementById('yt-query').value;
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${q}&type=video&maxResults=5&key=${YT_KEY}`);
        const data = await res.json();
        const resDiv = document.getElementById('yt-results');
        resDiv.innerHTML = '';
        data.items.forEach(v => {
            resDiv.innerHTML += `<div onclick="play('${v.id.videoId}')" style="cursor:pointer; min-width:80px;"><img src="${v.snippet.thumbnails.default.url}" width="80"><p style="font-size:8px;">${v.snippet.title.substring(0,10)}</p></div>`;
        });
    }
    function play(id) { db.ref('yt_live').set({ id: id, active: true }); }
    function syncYT() {
        db.ref('yt_live').on('value', snap => {
            const v = snap.val();
            const screen = document.getElementById('video-screen');
            if(v && v.active) {
                screen.style.display = 'block';
                screen.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${v.id}?autoplay=1" frameborder="0" allowfullscreen></iframe>`;
            } else { screen.style.display = 'none'; }
        });
    }

    // --- Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† ÙˆØ§Ù„Ù…Ø§ÙŠÙƒØ§Øª ---
    function loadUsers() {
        db.ref('status').on('value', snap => {
            const list = document.getElementById('online-list');
            list.innerHTML = '';
            snap.forEach(u => { list.innerHTML += `<div style="padding:5px; font-size:12px;">ğŸŸ¢ ${u.val().n}</div>`; });
        });
    }

    function micAction(n) {
        const ref = db.ref('mics/s' + n);
        ref.once('value', s => {
            if(s.val() && s.val().n === myName) ref.remove();
            else if(!s.val()) ref.set({ n: myName });
        });
    }

    function syncMics() {
        for(let i=1; i<=4; i++) {
            db.ref('mics/s' + i).on('value', s => {
                const el = document.getElementById('slot' + i);
                if(s.val()) {
                    el.className = "mic-slot active";
                    el.innerHTML = `ğŸ¤ <b>${s.val().n}</b> <button onclick="micAction(${i})" style="font-size:8px;">Ù†Ø²ÙˆÙ„</button>`;
                } else {
                    el.className = "mic-slot";
                    el.innerHTML = `ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="micAction(${i})" style="font-size:8px;">ØµØ¹ÙˆØ¯</button>`;
                }
            });
        }
    }
</script>
</body>
</html>
