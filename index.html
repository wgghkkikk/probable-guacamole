<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø§Ø³ØªØ± RG</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --neon: #00f2ff; --pink: #ff004c; --gold: #ffcc00; --bg: #000; }
        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; padding: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; position: fixed; width: 100%; }
        
        header { height: 55px; background: #111; border-bottom: 2px solid var(--neon); display: flex; justify-content: space-between; align-items: center; padding: 0 10px; position: absolute; top: 0; width: 100%; z-index: 1000; }
        .btn-m { background: #222; color: var(--neon); border: 1px solid var(--neon); padding: 6px 12px; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 13px; }

        #chat-container { position: absolute; top: 55px; left: 0; right: 0; bottom: 75px; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 15px; }

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø·ÙˆØ± */
        .msg-box { display: flex; gap: 10px; align-items: flex-start; }
        .msg-img { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--neon); object-fit: cover; }
        .msg-content { background: #151515; padding: 10px; border-radius: 12px; border-right: 3px solid var(--neon); flex: 1; position: relative; }
        .msg-user { color: var(--neon); font-weight: bold; font-size: 13px; display: block; margin-bottom: 4px; }
        .msg-tools { display: flex; gap: 10px; margin-top: 8px; border-top: 1px solid #222; padding-top: 5px; }
        .tool-btn { background: none; border: none; color: #666; font-size: 11px; cursor: pointer; padding: 0; }
        .tool-btn:hover { color: #fff; }

        /* Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .input-footer { position: fixed; bottom: 0; left: 0; right: 0; height: 75px; background: #111; border-top: 2px solid var(--neon); display: flex; align-items: center; padding: 0 10px; gap: 8px; z-index: 9999; }
        input { flex: 1; background: #000; color: #fff; border: 1px solid #444; height: 45px; padding: 0 15px; border-radius: 25px; font-size: 16px; outline: none; }
        #sendBtn { background: var(--neon); border: none; height: 45px; padding: 0 20px; border-radius: 25px; font-weight: bold; cursor: pointer; color: #000; }

        /* Ø§Ù„Ø³ØªØ§Ø±Ø§Øª */
        .sidebar { position: fixed; top: 55px; bottom: 75px; width: 250px; background: #0a0a0a; z-index: 5000; transition: 0.3s; padding: 15px; border: 1px solid #222; display: none; overflow-y: auto; }
        .sidebar.active { display: block; }
        #right-s { right: 0; }
        #left-s { left: 0; }

        /* Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ØªØ§Ø±Ø© */
        .profile-edit { text-align: center; border-bottom: 1px solid #222; padding-bottom: 15px; margin-bottom: 15px; }
        .p-img-large { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--neon); object-fit: cover; margin-bottom: 10px; }
    </style>
</head>
<body>

<header>
    <button class="btn-m" onclick="toggle('right')">Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†</button>
    <b style="color:var(--neon)">MASTER RG</b>
    <button class="btn-m" onclick="toggle('left')">Ø§Ù„Ù…Ù„Ù</button>
</header>

<div id="chat-container"></div>

<div id="right-s" class="sidebar">
    <h3 style="color:var(--neon); font-size: 16px;">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ†</h3>
    <div style="color:var(--gold)">ğŸ‘‘ Ø§Ù„Ù…Ø§Ø³ØªØ± RG</div>
</div>

<div id="left-s" class="sidebar">
    <div class="profile-edit">
        <img src="https://via.placeholder.com/80" id="myViewImg" class="p-img-large">
        <h4 id="myViewName" style="margin: 5px 0;">Ø§Ù„Ù…Ø§Ø³ØªØ± RG</h4>
        <input type="text" id="newName" placeholder="ØºÙŠØ± Ø§Ø³Ù…Ùƒ..." style="width:100%; margin-bottom:10px; background:#000; color:#fff; border:1px solid #333; padding:5px;">
        <p style="font-size:11px;">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ:</p>
        <input type="file" id="imgFile" accept="image/*" onchange="updatePhoto(this)" style="font-size:10px; color:#666;">
        <button class="btn-m" onclick="saveProfile()" style="width:100%; margin-top:10px;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    </div>
    <button class="btn-m" onclick="location.reload()" style="width:100%">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Øª</button>
</div>

<div class="input-footer">
    <input type="text" id="msgInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." autocomplete="off">
    <button id="sendBtn" onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let myData = {
        name: localStorage.getItem('rg-name') || "Ø§Ù„Ù…Ø§Ø³ØªØ±_RG",
        img: localStorage.getItem('rg-img') || "https://via.placeholder.com/80"
    };

    function refreshProfileUI() {
        document.getElementById('myViewImg').src = myData.img;
        document.getElementById('myViewName').innerText = myData.name;
    }
    refreshProfileUI();

    function updatePhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => { myData.img = e.target.result; };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function saveProfile() {
        const n = document.getElementById('newName').value;
        if(n) myData.name = n;
        localStorage.setItem('rg-name', myData.name);
        localStorage.setItem('rg-img', myData.img);
        refreshProfileUI();
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸!");
    }

    function toggle(id) {
        const el = document.getElementById(id + '-s');
        const isVisible = el.style.display === 'block';
        document.getElementById('right-s').style.display = 'none';
        document.getElementById('left-s').style.display = 'none';
        if (!isVisible) el.style.display = 'block';
    }

    function send() {
        const t = document.getElementById('msgInp').value;
        if(t.trim()) {
            db.ref('messages').push({ u: myData.name, t: t, i: myData.img });
            document.getElementById('msgInp').value = '';
        }
    }

    db.ref('messages').limitToLast(30).on('child_added', (snap) => {
        const m = snap.val();
        const id = snap.key;
        const div = document.createElement('div');
        div.className = 'msg-box';
        div.innerHTML = `
            <img src="${m.i || 'https://via.placeholder.com/40'}" class="msg-img">
            <div class="msg-content">
                <span class="msg-user">${m.u}</span>
                <div>${m.t}</div>
                <div class="msg-tools">
                    <button class="tool-btn" onclick="quote('${m.u}')">ğŸ’¬ Ø§Ù‚ØªØ¨Ø§Ø³</button>
                    <button class="tool-btn" onclick="deleteMsg('${id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    <button class="tool-btn" style="color:var(--pink)">â¤ï¸</button>
                </div>
            </div>
        `;
        const c = document.getElementById('chat-container');
        c.appendChild(div);
        c.scrollTop = c.scrollHeight;
    });

    function deleteMsg(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ")) db.ref('messages/'+id).remove(); location.reload(); }
    function quote(user) { document.getElementById('msgInp').value = `@${user} : `; document.getElementById('msgInp').focus(); }
</script>

</body>
</html>
