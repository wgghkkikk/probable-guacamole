// 1. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
db.ref('status').on('child_added', (snapshot) => {
    const user = snapshot.val();
    db.ref('main_msgs').push({
        uid: "system_bot",
        n: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–",
        av: "https://cdn-icons-png.flaticon.com/512/4712/4712035.png",
        t: `ÙŠØ§ Ù‡Ù„Ø§ Ø¨ÙŠÙƒ ÙŠØ§ ${user.n}ØŒ Ù†ÙˆØ±Øª Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘âœ¨`,
        type: "welcome"
    });
});

// 2. Ù…ÙŠØ²Ø© Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„Ø´Ø§Øª (Shake Effect)
function shakeChat() {
    const win = document.getElementById('chat-win');
    win.style.animation = "shake 0.5s";
    setTimeout(() => win.style.animation = "", 500);
}

// 3. ØªØ­Ø¯ÙŠØ« ÙØ­Øµ Ø§Ù„Ø¨ÙˆØª (Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„ÙŠ Ø¨Ø§Ù„ØµÙˆØ±Ø©)
function checkBotCommand(msgText, userName) {
    if (msgText === "Ø§Ø³Ø¦Ù„Ø©" || msgText === "Ø£Ø³Ø¦Ù„Ø©") {
        startSmartQuiz();
        return true;
    }
    // Ø¥Ø°Ø§ ÙƒØªØ¨ "Ø§Ù†ÙØ¬Ø§Ø±" ÙŠÙ‡ØªØ² Ø§Ù„Ø´Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ÙƒÙ„ (ØªØ­ØªØ§Ø¬ Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ø§Ù„ÙÙŠØ±Ø¨ÙŠØ³)
    if (msgText === "Ø§Ù†ÙØ¬Ø§Ø±") {
        shakeChat();
    }
    
    if (currentAnswer !== "" && msgText.trim() === currentAnswer) {
        db.ref('main_msgs').push({
            uid: "system_bot",
            n: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–",
            av: "https://cdn-icons-png.flaticon.com/512/4712/4712035.png",
            t: `ğŸ‰ ÙƒÙÙˆÙˆÙˆ ÙŠØ§ ${userName}.. Ø¬ÙˆØ§Ø¨Ùƒ ØµØ­! Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù‡Ùˆ [ ${currentAnswer} ]`,
            type: "system"
        });
        currentAnswer = "";
        return true;
    }
    return false;
}
