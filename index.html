// 1. Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø±Ø¹Ø¯ Ø§Ù„Ù…Ù„ÙƒÙŠ
function playThunder() {
    const thunder = new Audio('https://www.soundjay.com/nature/thunder-storm-01.mp3');
    thunder.volume = 0.5; // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª
    thunder.play().catch(e => console.log("Ø§Ù„ØµÙˆØª ÙŠØ­ØªØ§Ø¬ ØªÙØ§Ø¹Ù„ Ø£ÙˆÙ„Ø§Ù‹")); 
}

// 2. ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù„ØªØ´ØºÙŠÙ„ (Ø§Ù„Ù…Ø·Ø± + Ø§Ù„Ø±Ø¹Ø¯) Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©
db.ref("messages").limitToLast(1).on("child_added", (snap) => {
    const d = snap.val();
    if(d.effect === "fire_rain") {
        makeItRain();   // ØªØ³Ø§Ù‚Ø· Ø§Ù„Ù†Ø§Ø± ðŸ”¥
        playThunder();  // ØµÙˆØª Ø§Ù„Ø±Ø¹Ø¯ âš¡
    }
    // ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø®Ø·ÙˆØ· (fire, gold-flow)
    renderMessage(d); 
});

// 3. ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª Ù„ØªØ¨Ù‚Ù‰ Ù†Ø§Ø¨Ø¶Ø© Ø¨Ø§Ù„Ø­ÙŠØ§Ø©
function initKingdom() {
    const name = document.getElementById('my-name').value;
    db.ref("activity_log").push().set({ user: name, time: new Date().toLocaleString('ar-EG') });
    
    const eList = document.getElementById('emoji-list');
    eList.innerHTML = ""; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø³Ø±Ø¹Ø©

    // Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ù‚Ù…Ø© Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ ÙˆØ§Ù„Ù„Ù…Ø¹Ø©
    const specialStickers = ["ðŸ‘‘", "ðŸ”¥", "âš¡", "âš”ï¸", "ðŸ›¡ï¸", "ðŸŒŸ", "ðŸš€", "ðŸ§¿"];
    specialStickers.forEach(stk => {
        let s = document.createElement('span');
        s.className = 'emoji-item';
        s.style.fontSize = "40px"; 
        s.style.animation = "pulse 1.5s infinite";
        s.style.filter = "drop-shadow(0 0 8px gold)"; 
        s.innerText = stk;
        s.onclick = () => { document.getElementById('msg-in').value += stk; };
        eList.appendChild(s);
    });

    // ØªØ­Ù…ÙŠÙ„ Ø¢Ù„Ø§Ù Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª (ÙˆØ¬ÙˆÙ‡ØŒ Ø£Ø¹Ù„Ø§Ù…ØŒ Ø±Ù…ÙˆØ²)
    const ranges = [[0x1F600, 0x1F64F], [0x1F300, 0x1F5FF], [0x1F680, 0x1F6FF], [0x1F900, 0x1F9FF], [0x1F1E6, 0x1F1FF]];
    ranges.forEach(range => {
        for (let i = range[0]; i <= range[1]; i++) {
            let s = document.createElement('span');
            s.className = 'emoji-item';
            s.innerText = String.fromCodePoint(i);
            s.onclick = () => { document.getElementById('msg-in').value += s.innerText; };
            eList.appendChild(s);
        }
    });
}
