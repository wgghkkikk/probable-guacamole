<div class="profile-card" style="background: #1a1a1a; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #333;">
    <div id="user-avatar-container">
        <img id="my-avatar" src="https://via.placeholder.com/80" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--main-orange); object-fit: cover;">
    </div>
    <h3 id="display-name" style="margin: 10px 0; color: var(--main-orange);">Ø¹Ù„ÙˆØ´</h3>
    <p style="font-size: 12px; color: #888;">Ø§Ù„Ø±ØªØ¨Ø©: Ø§Ù„Ù…Ø§Ø³ØªØ±</p>
    
    <button onclick="changeMyPhoto()" style="background: var(--main-orange); color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; width: 100%;">
        ğŸ“· ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©
    </button>
</div>

<script>
// 1. Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ù† Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
function changeMyPhoto() {
    let input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    
    input.onchange = e => {
        let file = e.target.files[0];
        let reader = new FileReader();
        
        reader.onload = function(event) {
            let imageData = event.target.result;
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙˆØ±Ø§Ù‹
            document.getElementById('my-avatar').src = imageData;
            
            // Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªØµÙØ­ Ø£Ùˆ Firebase (Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ)
            mySet.avatar = imageData; 
            // Ø¥Ø°Ø§ ØªØ±ÙŠØ¯ ØªØ®Ø²Ù†Ù‡Ø§ Ø¨Ù€ Firebase Ù„Ù„Ø¹Ø¶Ùˆ:
            // db.ref('users/' + mySet.name).update({avatar: imageData});
        };
        reader.readAsDataURL(file);
    };
    input.click();
}

// 2. ØªØ­Ø¯ÙŠØ« Ù†Ø¸Ø§Ù… Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ù„ÙŠØ¯Ø¹Ù… Ø±ÙˆØ§Ø¨Ø· (youtu.be) Ø§Ù„Ù„ÙŠ Ø¨Ø§Ù„ØµÙˆØ±Ø©
function getYTId(url) {
    let regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
    let match = url.match(regExp);
    return (match && match[2].length === 11) ? match[2] : null;
}

// 3. ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„ÙŠØ¯Ø¹Ù… Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ ÙˆØ§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
db.ref('supreme_chat').limitToLast(50).on('child_added', snap => {
    let d = snap.val();
    let area = document.getElementById('chat-area');
    let div = document.createElement('div');
    div.className = 'msg-bubble';
    
    let content = d.text;
    let ytId = getYTId(content);

    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ (ÙŠØ´ØªØºÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ)
    if(ytId) {
        content = `<div>${content}</div><iframe src="https://www.youtube.com/embed/${ytId}" frameborder="0" allowfullscreen style="width:100%; height:200px; border-radius:10px; margin-top:10px;"></iframe>`;
    } 
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª
    else if(content.startsWith('DATA:IMG')) {
        content = `<img src="${content.replace('DATA:IMG','')}" style="width:100%; border-radius:10px; cursor:pointer;" onclick="window.open(this.src)">`;
    }

    div.innerHTML = `<b style="color:${d.color}">${d.sender}:</b> <div>${content}</div>`;
    area.appendChild(div);
    area.scrollTop = area.scrollHeight;
});
</script>
