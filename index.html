<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>MASTER RG - The Empire Social</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; --red: #ff4444; --bg: #000; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Cairo', sans-serif; overflow: hidden; }

        /* Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 60px; background: #111; display: flex; justify-content: space-around; align-items: center; border-top: 2px solid var(--neon); z-index: 2000; }
        .nav-item { color: #888; font-size: 12px; text-align: center; cursor: pointer; }
        .nav-item.active { color: var(--neon); }

        .page { position: fixed; top: 0; left: 0; right: 0; bottom: 60px; background: var(--bg); display: none; overflow-y: auto; }
        .page.active { display: block; }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª */
        .level-badge { font-size: 10px; background: var(--gold); color: #000; padding: 2px 6px; border-radius: 5px; margin-right: 5px; }
        .xp-bar { height: 3px; background: var(--neon); position: absolute; bottom: 0; left: 0; transition: 0.3s; }

        /* Ø­Ø§Ø¦Ø· Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª */
        .post-card { background: #111; margin: 15px; border-radius: 15px; border: 1px solid #222; overflow: hidden; }
        .post-img { width: 100%; max-height: 300px; object-fit: cover; }
        .post-info { padding: 12px; }
        .like-btn { color: var(--red); cursor: pointer; display: flex; align-items: center; gap: 5px; }

        /* Ø§Ù„Ø®Ø§Øµ */
        .private-chat { position: fixed; inset: 0; background: #000; z-index: 3000; display: none; }
        
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© */
        header { height: 60px; background: #111; border-bottom: 2px solid var(--neon); display: flex; align-items: center; justify-content: center; position: sticky; top: 0; }
        .msg { display: flex; padding: 10px; border-bottom: 1px solid #111; }
        .msg img { width: 45px; height: 45px; border-radius: 10px; border: 2px solid var(--neon); margin-left: 10px; }
    </style>
</head>
<body>

<div id="rooms-page" class="page active">
    <header><b>Ø§Ù„Ø±ÙˆÙ…Ø§Øª ğŸ›</b></header>
    <div style="padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div onclick="openChat('main')" style="background:#111; padding:20px; border-radius:15px; text-align:center; border:1px solid var(--neon);">ğŸ‘‘ Ø§Ù„Ø¹Ø±Ø´</div>
        <div onclick="openChat('game')" style="background:#111; padding:20px; border-radius:15px; text-align:center; border:1px solid var(--gold);">ğŸ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div>
    </div>
</div>

<div id="social-page" class="page">
    <header><b>Ø­Ø§Ø¦Ø· Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ğŸ“¸</b></header>
    <div style="padding:15px;">
        <button onclick="newPost()" style="width:100%; background:var(--neon); border:none; padding:10px; border-radius:10px; font-weight:bold;">Ù†Ø´Ø± ØµÙˆØ±Ø©/Ù…Ù†Ø´ÙˆØ± +</button>
    </div>
    <div id="posts-container"></div>
</div>

<div id="profile-page" class="page">
    <header><b>Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ ğŸ‘¤</b></header>
    <div style="text-align:center; padding:30px;">
        <img id="my-p-img" src="" style="width:100px; height:100px; border-radius:20px; border:3px solid var(--gold);">
        <h2 id="my-p-name"></h2>
        <div style="background:#111; padding:10px; border-radius:10px; margin:20px;">
            <p style="color:var(--gold)">Level: <span id="my-level">1</span></p>
            <div style="width:100%; height:10px; background:#222; border-radius:5px; overflow:hidden;">
                <div id="xp-progress" style="width:0%; height:100%; background:var(--neon);"></div>
            </div>
            <p style="font-size:10px; color:#666; margin-top:5px;">ØªÙØ§Ø¹Ù„ Ø£ÙƒØ«Ø± Ù„Ø±ÙØ¹ Ù…Ø³ØªÙˆØ§Ùƒ!</p>
        </div>
    </div>
</div>

<div id="chat-view" class="page" style="z-index: 100; bottom: 0;">
    <header>
        <button onclick="closeChat()" style="position:absolute; right:15px; background:none; border:none; color:var(--neon); font-size:20px;">â”</button>
        <b id="chat-title"></b>
    </header>
    <div id="chat-msgs" style="position:absolute; top:60px; bottom:70px; left:0; right:0; overflow-y:auto; padding:10px;"></div>
    <div style="position:absolute; bottom:0; width:100%; height:70px; background:#111; display:flex; align-items:center; padding:10px;">
        <input type="text" id="msgInp" style="flex:1; background:#000; color:#fff; border:1px solid #333; padding:10px; border-radius:10px;">
        <button onclick="sendMsg()" style="background:var(--neon); border:none; padding:10px; border-radius:10px; margin-right:5px;">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" onclick="showPage('rooms')">ğŸ›<br>Ø§Ù„Ø±ÙˆÙ…Ø§Øª</div>
    <div class="nav-item" onclick="showPage('social')">ğŸ“¸<br>Ø§Ù„Ø­Ø§Ø¦Ø·</div>
    <div class="nav-item" onclick="showPage('profile')">ğŸ‘¤<br>Ù…Ù„ÙÙŠ</div>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let my = {
        n: localStorage.getItem('rg-n') || "User_" + Math.floor(Math.random()*99),
        i: localStorage.getItem('rg-i') || "https://ui-avatars.com/api/?name=U",
        xp: parseInt(localStorage.getItem('rg-xp')) || 0,
        lvl: Math.floor((parseInt(localStorage.getItem('rg-xp')) || 0) / 100) + 1
    };

    if(!localStorage.getItem('rg-n')) { 
        let n = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
        if(n) { localStorage.setItem('rg-n', n); location.reload(); }
    }

    function showPage(p) {
        document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
        document.getElementById(p + '-page').classList.add('active');
        document.querySelectorAll('.nav-item').forEach(ni => ni.classList.remove('active'));
        if(p === 'profile') updateProfileUI();
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ÙÙ„
    function addXP(amount) {
        my.xp += amount;
        localStorage.setItem('rg-xp', my.xp);
        my.lvl = Math.floor(my.xp / 100) + 1;
    }

    function updateProfileUI() {
        document.getElementById('my-p-img').src = my.i;
        document.getElementById('my-p-name').innerText = my.n;
        document.getElementById('my-level').innerText = my.lvl;
        document.getElementById('xp-progress').style.width = (my.xp % 100) + "%";
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ø¦Ø· (Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª)
    function newPost() {
        let txt = prompt("Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ø§Ù‹ Ù„Ù„Ù…Ù†Ø´ÙˆØ±:");
        let img = prompt("Ø¶Ø¹ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):");
        if(txt) {
            db.ref('posts').push({ u: my.n, t: txt, img: img, likes: 0 });
            addXP(20);
        }
    }

    db.ref('posts').on('child_added', snap => {
        let p = snap.val();
        let div = document.createElement('div');
        div.className = 'post-card';
        div.innerHTML = `
            ${p.img ? `<img src="${p.img}" class="post-img">` : ''}
            <div class="post-info">
                <b style="color:var(--neon)">${p.u}</b>
                <p>${p.t}</p>
                <div class="like-btn" onclick="likePost('${snap.key}')">â¤ï¸ ${p.likes || 0}</div>
            </div>`;
        document.getElementById('posts-container').prepend(div);
    });

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
    let curChat = "";
    function openChat(id) {
        curChat = id;
        document.getElementById('chat-title').innerText = id;
        document.getElementById('chat-view').classList.add('active');
        loadChat();
    }

    function closeChat() { document.getElementById('chat-view').classList.remove('active'); }

    function sendMsg() {
        let t = document.getElementById('msgInp').value;
        if(t) {
            db.ref('chats/'+curChat).push({ u: my.n, t: t, i: my.i, l: my.lvl });
            addXP(5);
            document.getElementById('msgInp').value = "";
        }
    }

    function loadChat() {
        db.ref('chats/'+curChat).off();
        db.ref('chats/'+curChat).limitToLast(30).on('child_added', snap => {
            let m = snap.val();
            let div = document.createElement('div');
            div.className = 'msg';
            div.innerHTML = `<img src="${m.i}">
                <div>
                    <div style="font-size:12px;"><span class="level-badge">Lv.${m.l}</span> <b color="var(--neon)">${m.u}</b></div>
                    <div style="background:#1a1a1a; padding:8px; border-radius:10px; margin-top:5px;">${m.t}</div>
                </div>`;
            document.getElementById('chat-msgs').appendChild(div);
            document.getElementById('chat-msgs').scrollTop = document.getElementById('chat-msgs').scrollHeight;
        });
    }

    updateProfileUI();
</script>
</body>
</html>
