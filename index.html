<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ | V114 ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');
        :root { --main: #ffd700; --bg: #0b0b0b; --pvt: #e040fb; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); color: white; height: 100vh; overflow: hidden; position: relative; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { height: 60px; background: #000; border-bottom: 2px solid var(--main); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; }
        
        /* Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù… */
        #main-chat { height: calc(100vh - 170px); overflow-y: auto; padding: 15px; padding-bottom: 30px; }
        .bubble { background: #1a1a1a; padding: 10px; border-radius: 12px; border-right: 4px solid var(--main); margin-bottom: 10px; max-width: 85%; }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®Ø§Øµ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© (Ù…Ø«Ù„ Ø§Ù„Ø´Ø§ØªØ§Øª) */
        #pvt-trigger {
            position: fixed; bottom: 120px; right: 20px; width: 55px; height: 55px;
            background: linear-gradient(45deg, #000, #333); border: 2px solid var(--main);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 24px; cursor: pointer; z-index: 999;
            box-shadow: 0 0 15px var(--main); animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .badge { position: absolute; top: -5px; left: -5px; width: 18px; height: 18px; background: red; border-radius: 50%; border: 2px solid white; display: none; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®Ø§Øµ */
        #pvt-window { position: fixed; inset: 0; background: #050505; z-index: 9999; display: none; flex-direction: column; }
        .pvt-header { height: 60px; background: #111; border-bottom: 2px solid var(--pvt); display: flex; align-items: center; padding: 0 15px; font-weight: bold; }
        #pvt-flow { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .pvt-b { padding: 10px; border-radius: 10px; max-width: 80%; line-height: 1.5; }
        .me { background: var(--pvt); align-self: flex-start; }
        .them { background: #333; align-self: flex-end; }

        /* Ø§Ù„ÙÙˆØªØ± */
        .footer { position: fixed; bottom: 0; width: 100%; height: 110px; background: #000; border-top: 2px solid var(--main); padding: 10px 15px 40px; display: flex; align-items: center; z-index: 1000; }
        #msg-in { flex: 1; height: 40px; background: #111; border: 1px solid var(--main); border-radius: 20px; color: white; padding: 0 15px; outline: none; }
        .send-btn { background: var(--main); color: #000; border: none; padding: 0 15px; border-radius: 20px; font-weight: 900; margin-right: 8px; height: 40px; cursor: pointer; }

        .side { position: fixed; top: 0; bottom: 0; width: 280px; background: #0a0a0a; z-index: 5000; transition: 0.3s; right: -285px; border-left: 2px solid var(--main); }
        .side.active { right: 0; }
    </style>
</head>
<body>

<div class="header">
    <button onclick="document.getElementById('side-r').classList.toggle('active')" style="background:none; border:none; font-size:24px; color:white;">ğŸ‘¥</button>
    <div style="color:var(--main); font-weight:900;">Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´</div>
    <div style="width:24px;"></div>
</div>

<div id="main-chat"></div>

<div id="pvt-trigger" onclick="alert('Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ Ù„ÙØªØ­ Ø§Ù„Ø®Ø§Øµ Ù…Ø¹Ù‡!')">
    ğŸ“©
    <div id="notif-dot" class="badge"></div>
</div>

<div class="footer">
    <input type="text" id="msg-in" placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¬Ù…ÙŠØ¹..." onkeypress="if(event.key==='Enter') sendGen()">
    <button class="send-btn" onclick="sendGen()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<div id="pvt-window">
    <div class="pvt-header">
        <button onclick="closePvt()" style="background:none; border:none; color:white; font-size:24px; margin-left:15px;">âœ–</button>
        <span>Ø®Ø§Øµ: <span id="pvt-name" style="color:var(--pvt);">...</span></span>
    </div>
    <div id="pvt-flow"></div>
    <div class="footer" style="border-top-color:var(--pvt);">
        <input type="text" id="pvt-in" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù…Ø³Ø© Ø®Ø§ØµØ©..." onkeypress="if(event.key==='Enter') sendPvt()">
        <button class="send-btn" style="background:var(--pvt); color:white;" onclick="sendPvt()">Ù‡Ù…Ø³</button>
    </div>
</div>

<div id="side-r" class="side">
    <h3 style="text-align:center; padding:20px; color:var(--main); border-bottom:1px solid #222;">ğŸ‘¤ Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ†</h3>
    <div id="on-list" style="padding:10px;"></div>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let uName = localStorage.getItem('chat_name') || prompt("Ø§Ø³Ù…Ùƒ:") || "Ø²Ø§Ø¦Ø±";
    localStorage.setItem('chat_name', uName);
    let myTarget = "";

    // Ø¹Ø§Ù…
    function sendGen() {
        let i = document.getElementById('msg-in'); if(!i.value) return;
        db.ref('v114_gen').push({ u: uName, t: i.value });
        i.value = "";
    }

    // ÙØªØ­ Ø®Ø§Øµ
    function openPvt(name) {
        if(name === uName) return;
        myTarget = name;
        document.getElementById('pvt-name').innerText = name;
        document.getElementById('pvt-window').style.display = 'flex';
        document.getElementById('pvt-flow').innerHTML = "";
        document.getElementById('notif-dot').style.display = 'none';
        
        let room = [uName, name].sort().join("_");
        db.ref('v114_pvt/' + room).off();
        db.ref('v114_pvt/' + room).on('child_added', s => {
            let d = s.val();
            let div = document.createElement('div');
            div.className = `pvt-b ${d.from === uName ? 'me' : 'them'}`;
            div.innerText = d.t;
            document.getElementById('pvt-flow').appendChild(div);
            document.getElementById('pvt-flow').scrollTop = document.getElementById('pvt-flow').scrollHeight;
        });
    }

    function closePvt() { document.getElementById('pvt-window').style.display = 'none'; myTarget = ""; }

    function sendPvt() {
        let i = document.getElementById('pvt-in'); if(!i.value) return;
        let room = [uName, myTarget].sort().join("_");
        db.ref('v114_pvt/' + room).push({ from: uName, t: i.value });
        i.value = "";
    }

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…
    db.ref('v114_gen').on('child_added', s => {
        let d = s.val();
        let div = document.createElement('div');
        div.className = "bubble";
        div.innerHTML = `<b style="color:gold" onclick="openPvt('${d.u}')">${d.u}:</b> <p>${d.t}</p>`;
        document.getElementById('main-chat').appendChild(div);
        document.getElementById('main-chat').scrollTop = document.getElementById('main-chat').scrollHeight;
    });

    // Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†
    db.ref('v114_on/' + uName).set(true).onDisconnect().remove();
    db.ref('v114_on').on('value', s => {
        let l = document.getElementById('on-list'); l.innerHTML = "";
        s.forEach(u => {
            l.innerHTML += `<div onclick="openPvt('${u.key}')" style="padding:15px; border-bottom:1px solid #111; cursor:pointer;">â— ${u.key}</div>`;
        });
    });
</script>
</body>
</html>
