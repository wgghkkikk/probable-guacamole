<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø¹Ù„ÙˆØ´ Ø§Ù„Ù…Ù„ÙƒÙŠØ© ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© */
        .mic-slots { display: flex; justify-content: space-around; background: #111; padding: 10px; border-bottom: 2px solid var(--main); gap: 5px; }
        .slot { flex: 1; background: #1a1a1a; border: 1px dashed var(--main); border-radius: 10px; height: 60px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; position: relative; }
        .slot.active { border-style: solid; box-shadow: 0 0 10px var(--main); }
        .mic-on-btn { position: absolute; bottom: 2px; font-size: 10px; background: var(--main); color: #000; border: none; border-radius: 5px; cursor: pointer; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ù„ */
        #sidebar { width: 220px; border-left: 1px solid var(--main); order: 1; transition: 0.3s; overflow-y: auto; padding: 10px; }
        .main-chat { flex: 1; display: flex; flex-direction: column; order: 2; }

        /* Ø§Ù„Ø¨ÙˆØª */
        .bot-msg { background: linear-gradient(45deg, #444, #111) !important; border-right: 4px solid #00f2ff !important; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #admin-panel { position: fixed; top: 10%; left: 10%; right: 10%; bottom: 10%; background: rgba(0,0,0,0.95); border: 2px solid var(--main); z-index: 9999; border-radius: 20px; padding: 20px; display: none; }
        .control-row { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .btn { background: var(--main); color: #000; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }

        #chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 12px; max-width: 80%; }
        .msg.me { align-self: flex-end; background: #222; border-right: 3px solid var(--main); }
        .msg.other { align-self: flex-start; background: #1a1a1a; }
        .input-area { padding: 15px; background: #111; display: flex; gap: 10px; align-items: center; }
        input[type="text"] { flex: 1; background: #000; color: #fff; border: 1px solid #333; padding: 12px; border-radius: 25px; outline: none; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h3 style="text-align:center; color:var(--main);">Ø§Ù„Ù…Ù„ÙˆÙƒ ğŸ‡®ğŸ‡¶</h3>
        <div id="online-list"></div>
    </div>

    <div class="main-chat">
        <div class="mic-slots">
            <div class="slot" id="slot1">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button class="mic-on-btn" onclick="toggleMic(1)">ØµØ¹ÙˆØ¯</button></div>
            <div class="slot" id="slot2">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button class="mic-on-btn" onclick="toggleMic(2)">ØµØ¹ÙˆØ¯</button></div>
            <div class="slot" id="slot3">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button class="mic-on-btn" onclick="toggleMic(3)">ØµØ¹ÙˆØ¯</button></div>
            <div class="slot" id="slot4">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button class="mic-on-btn" onclick="toggleMic(4)">ØµØ¹ÙˆØ¯</button></div>
        </div>

        <div style="background:#111; padding:10px; display:flex; justify-content:space-between; border-bottom:1px solid #222;">
            <button id="admin-gear" style="background:none; border:none; color:var(--main); font-size:20px; cursor:pointer; display:none;" onclick="togglePanel()">âš™ï¸</button>
            <span style="color:var(--main); font-weight:bold;">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</span>
            <span id="clock" style="color:gray;"></span>
        </div>

        <div id="chat-box"></div>

        <div class="input-area">
            <input type="text" id="mInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
            <button class="btn" onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

    <div id="admin-panel">
        <h2 style="text-align:center; color:var(--main);">ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·Ù„Ù‚Ø©</h2>
        <div class="control-row">
            <button class="btn" onclick="moveLayout('right')">Ù†Ù‚Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„ÙŠÙ…ÙŠÙ†</button>
            <button class="btn" onclick="moveLayout('left')">Ù†Ù‚Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„ÙŠØ³Ø§Ø±</button>
            <button class="btn" onclick="clearChat()">ØªØµÙÙŠØ± Ø§Ù„Ø´Ø§Øª ğŸ§¨</button>
            <button class="btn" onclick="toggleMicsVisibility()">Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª</button>
        </div>
        <button class="btn" style="width:100%; margin-top:20px;" onclick="togglePanel()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

<script>
    const YT_KEY = "AIzaSyC4wFkLrA_BlNzreseXQLeSp_40Gbmu9VU"; 
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    const auth = firebase.auth();

    let myName = "";

    auth.onAuthStateChanged(user => {
        if (user) {
            const isMe = user.email === "rgrghh77@gmail.com";
            if(isMe) document.getElementById('admin-gear').style.display = 'block';
            myName = isMe ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('status/' + user.uid).set({ n: myName });
            db.ref('status/' + user.uid).onDisconnect().remove();
            loadChat(); loadUsers(); syncMics();
        } else { window.location.href = "index.html"; }
    });

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙˆØª ---
    function runBot(msg) {
        if(msg === "Ø¨ÙˆØª") {
            setTimeout(() => {
                sendBotMsg("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´! ÙƒÙŠÙ Ø£Ø®Ø¯Ù…ÙƒØŸ ğŸ¤–");
            }, 1000);
        } else if(msg.includes("Ø¹Ù„ÙˆØ´")) {
            setTimeout(() => {
                sendBotMsg("Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ Ù‡Ùˆ Ø³ÙŠØ¯ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ‘‘ Ø­ÙŠÙ‘ÙˆÙ‡!");
            }, 800);
        }
    }

    function sendBotMsg(text) {
        db.ref('msgs').push({ u: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–", t: text, type: 'bot' });
    }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª ---
    function toggleMic(num) {
        const ref = db.ref('mics/slot' + num);
        ref.once('value', snap => {
            const d = snap.val();
            if(d && d.u === myName) {
                ref.remove(); // Ù†Ø²ÙˆÙ„ Ù…Ù† Ø§Ù„Ù…Ø§ÙŠÙƒ
            } else if(!d) {
                ref.set({ u: myName }); // ØµØ¹ÙˆØ¯ Ù„Ù„Ù…Ø§ÙŠÙƒ
            } else {
                alert("Ø§Ù„Ù…Ø§ÙŠÙƒ Ù…Ø´ØºÙˆÙ„!");
            }
        });
    }

    function syncMics() {
        for(let i=1; i<=4; i++) {
            db.ref('mics/slot' + i).on('value', snap => {
                const d = snap.val();
                const el = document.getElementById('slot' + i);
                if(d) {
                    el.innerHTML = `ğŸ¤ ${d.u} <button class="mic-on-btn" onclick="toggleMic(${i})">Ù†Ø²ÙˆÙ„</button>`;
                    el.classList.add('active');
                } else {
                    el.innerHTML = `ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button class="mic-on-btn" onclick="toggleMic(${i})">ØµØ¹ÙˆØ¯</button>`;
                    el.classList.remove('active');
                }
            });
        }
    }

    // --- Ø§Ù„ØªØ­ÙƒÙ… ÙˆÙ†Ù‚Ù„ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª ---
    function moveLayout(side) {
        const sideEl = document.getElementById('sidebar');
        const chatEl = document.querySelector('.main-chat');
        if(side === 'right') {
            sideEl.style.order = "2";
            chatEl.style.order = "1";
        } else {
            sideEl.style.order = "1";
            chatEl.style.order = "2";
        }
    }

    function toggleMicsVisibility() {
        const m = document.querySelector('.mic-slots');
        m.style.display = m.style.display === 'none' ? 'flex' : 'none';
    }

    // --- Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---
    function send() {
        const i = document.getElementById('mInp');
        if(i.value.trim()) {
            db.ref('msgs').push({ u: myName, t: i.value, m: auth.currentUser.email === "rgrghh77@gmail.com" });
            runBot(i.value); // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
            i.value = '';
        }
    }

    function loadChat() {
        db.ref('msgs').limitToLast(40).on('child_added', snap => {
            const d = snap.val();
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = `msg ${d.m ? 'me' : 'other'} ${d.type === 'bot' ? 'bot-msg' : ''}`;
            div.innerHTML = `<b style="color:var(--main); font-size:11px;">${d.u}</b><br>${d.t}`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
        db.ref('msgs').on('child_removed', () => location.reload());
    }

    function loadUsers() {
        db.ref('status').on('value', snap => {
            const list = document.getElementById('online-list');
            list.innerHTML = '';
            snap.forEach(c => { list.innerHTML += `<div style="padding:5px; border-bottom:1px solid #111;">ğŸŸ¢ ${c.val().n}</div>`; });
        });
    }

    function togglePanel() {
        const p = document.getElementById('admin-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function clearChat() { if(confirm("Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ØŸ")) db.ref('msgs').remove(); }
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>
