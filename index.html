<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­ÙƒÙ… Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main-color: #ffd700; --side-pos: left; }
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø±ÙŠØ¹Ø© (ØªØ¸Ù‡Ø± Ù„Ùƒ ÙÙ‚Ø·) */
        #settings-box { 
            position: fixed; top: 50px; right: 10px; background: #222; border: 1px solid var(--main-color);
            padding: 15px; border-radius: 10px; z-index: 2000; display: none; box-shadow: 0 0 20px #000;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø© Ø§Ù„Ù…ÙƒØ§Ù† */
        #sidebar { 
            width: 200px; background: rgba(10,10,10,0.95); border: 1px solid var(--main-color);
            position: fixed; top: 0; bottom: 0; z-index: 1000; transition: 0.5s;
        }
        .side-left { left: 0; border-radius: 0 15px 15px 0; }
        .side-right { right: 0; border-radius: 15px 0 0 15px; }

        .main-chat { flex: 1; display: flex; flex-direction: column; width: 100%; transition: 0.5s; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        .msg { padding: 12px; border-radius: 15px; max-width: 70%; background: #1a1a1a; border: 1px solid #333; }
        .msg.me { align-self: flex-end; border-color: var(--main-color); }

        .btn-tool { background: var(--main-color); color: #000; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 5px; width: 100%; }
    </style>
</head>
<body>

    <button id="admin-gear" onclick="toggleSettings()" style="position: fixed; top: 10px; left: 10px; z-index: 2001; background:none; border:none; font-size:25px; cursor:pointer;">âš™ï¸</button>

    <div id="settings-box">
        <h4 style="margin:0 0 10px 0; color:var(--main-color)">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ ğŸ› ï¸</h4>
        <button class="btn-tool" onclick="changePos('left')">Ù†Ù‚Ù„ Ù„Ù„ÙŠØ³Ø§Ø± â¬…ï¸</button>
        <button class="btn-tool" onclick="changePos('right')">Ù†Ù‚Ù„ Ù„Ù„ÙŠÙ…Ù† â¡ï¸</button>
        <button class="btn-tool" onclick="changeColor()">ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¨</button>
        <button class="btn-tool" style="background:red; color:white;" onclick="toggleSettings()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div id="sidebar" class="side-left">
        <h3 style="text-align:center; color:var(--main-color);">Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† ğŸ‡®ğŸ‡¶</h3>
        <div id="user-list-items" style="padding:10px;"></div>
    </div>

    <div class="main-chat" id="main-chat">
        <div style="background:#111; padding:15px; text-align:center; border-bottom:1px solid #222;">
            <h2 id="title" style="margin:0; color:var(--main-color);">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</h2>
        </div>
        <div id="chat-box"></div>
        <div style="padding:15px; background:#111; display:flex; gap:10px;">
            <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø«..." style="flex:1; background:#000; color:#fff; border:1px solid #333; padding:10px; border-radius:10px;">
            <button onclick="sendMsg()" style="background:var(--main-color); border:none; padding:10px 20px; border-radius:10px; font-weight:bold;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ", 
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const auth = firebase.auth();
    const db = firebase.database();

    function toggleSettings() {
        const box = document.getElementById('settings-box');
        box.style.display = box.style.display === 'block' ? 'none' : 'block';
    }

    // ÙˆØ¸ÙŠÙØ© ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙƒØ§Ù† Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø§Øª
    function changePos(pos) {
        const side = document.getElementById('sidebar');
        if(pos === 'left') {
            side.className = 'side-left';
        } else {
            side.className = 'side-right';
        }
    }

    function changeColor() {
        const colors = ['#ffd700', '#ff0000', '#00f2ff', '#ff00ff', '#00ff00'];
        const randomColor = colors[Math.floor(Math.random() * colors.length)];
        document.documentElement.style.setProperty('--main-color', randomColor);
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            const myName = user.email === "rgrghh77@gmail.com" ? "Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('online/' + user.uid).set({ n: myName }).onDisconnect().remove();
            loadChat();
            loadUsers();
            if(user.email !== "rgrghh77@gmail.com") document.getElementById('admin-gear').style.display = 'none';
        } else { window.location.href = "index.html"; }
    });

    function sendMsg() {
        const i = document.getElementById('mInp');
        if(i.value.trim()) {
            db.ref('msgs').push({ u: auth.currentUser.email === "rgrghh77@gmail.com" ? "Ø¹Ù„ÙˆØ´ ğŸ‘‘" : auth.currentUser.email.split('@')[0], t: i.value });
            i.value = '';
        }
    }

    function loadChat() {
        db.ref('msgs').limitToLast(20).on('child_added', snap => {
            const d = snap.val();
            const div = document.createElement('div');
            div.className = `msg ${d.u.includes('Ø¹Ù„ÙˆØ´') ? 'me' : 'other'}`;
            div.innerHTML = `<small style="color:var(--main-color)">${d.u}</small><br>${d.t}`;
            document.getElementById('chat-box').appendChild(div);
            document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
        });
    }

    function loadUsers() {
        db.ref('online').on('value', snap => {
            const uBox = document.getElementById('user-list-items');
            uBox.innerHTML = '';
            snap.forEach(c => { uBox.innerHTML += `<div style="margin-bottom:10px;">ğŸŸ¢ ${c.val().n} ğŸ‡®ğŸ‡¶</div>`; });
        });
    }
</script>
</body>
</html>
