<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>MASTER RG - EMPIRE EDITION</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; --bg: #000; --glass: rgba(255, 255, 255, 0.07); }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: #fff; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„ÙØ®Ù… */
        header { height: 65px; background: #0a0a0a; border-bottom: 2px solid var(--neon); display: flex; justify-content: space-between; align-items: center; padding: 0 15px; z-index: 1000; box-shadow: 0 2px 20px rgba(0,242,255,0.2); }
        .logo { font-size: 20px; font-weight: 800; color: var(--gold); letter-spacing: 1px; }
        .on-count { font-size: 11px; background: var(--glass); padding: 5px 12px; border-radius: 20px; border: 1px solid #333; color: var(--neon); }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø±ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹ */
        .rooms-nav { display: flex; overflow-x: auto; background: #050505; padding: 12px; gap: 10px; border-bottom: 1px solid #222; }
        .rooms-nav::-webkit-scrollbar { display: none; }
        .room-btn { background: #151515; color: #888; border: 1px solid #333; padding: 8px 18px; border-radius: 12px; white-space: nowrap; font-size: 14px; cursor: pointer; transition: 0.3s; }
        .room-btn.active { background: var(--neon); color: #000; border-color: var(--neon); font-weight: bold; box-shadow: 0 0 15px var(--neon); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        #chatbox { flex: 1; overflow-y: auto; padding: 15px; background: radial-gradient(circle at top, #0d0d0d, #000); }
        .msg-wrapper { display: flex; margin-bottom: 15px; animation: fadeInUp 0.3s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .avatar { width: 45px; height: 45px; border-radius: 12px; margin-left: 12px; border: 2px solid #222; }
        .bubble { background: var(--glass); backdrop-filter: blur(10px); padding: 12px 15px; border-radius: 18px; border-top-right-radius: 2px; max-width: 80%; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        .u-info { font-size: 12px; font-weight: 800; display: flex; align-items: center; gap: 5px; margin-bottom: 4px; }
        .yt-vid { width: 100%; aspect-ratio: 16/9; margin-top: 10px; border-radius: 10px; border: 1px solid #333; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-box { height: 85px; background: #0a0a0a; display: flex; align-items: center; padding: 0 15px; border-top: 1px solid #222; }
        #mInput { flex: 1; background: #151515; border: 1px solid #333; color: #fff; padding: 14px; border-radius: 15px; outline: none; font-size: 15px; }
        .send-btn { background: var(--neon); border: none; width: 55px; height: 55px; border-radius: 15px; margin-right: 10px; color: #000; font-size: 24px; cursor: pointer; box-shadow: 0 0 10px var(--neon); }

        /* Ø§Ù„Ø¬Ø§Ù†Ø¨ (Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†) */
        .sidebar { position: fixed; top: 0; bottom: 0; right: -280px; width: 270px; background: rgba(10,10,10,0.98); z-index: 2000; transition: 0.4s; border-left: 1px solid var(--neon); padding: 20px; }
        .sidebar.active { right: 0; }
        .user-item { display: flex; align-items: center; padding: 10px; background: var(--glass); border-radius: 10px; margin-bottom: 8px; border: 1px solid #222; }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; z-index: 1500; }
    </style>
</head>
<body>

<header>
    <button onclick="toggleSide()" style="background:none; border:none; color:var(--neon); font-size:25px;">â˜°</button>
    <div class="logo">MASTER <span style="color:var(--neon)">RG</span> ğŸ‘‘</div>
    <div class="on-count" id="count">0 Ù…ØªØµÙ„</div>
</header>

<div class="rooms-nav">
    <button class="room-btn active" onclick="switchRoom('main', this)">ğŸ‘‘ Ø§Ù„Ø¹Ø±Ø´</button>
    <button class="room-btn" onclick="switchRoom('vip', this)">ğŸ’ Ø§Ù„Ø¯ÙŠÙˆØ§Ù†</button>
    <button class="room-btn" onclick="switchRoom('game', this)">ğŸ® Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</button>
    <button class="room-btn" onclick="switchRoom('elite', this)">ğŸ¤ Ø§Ù„Ù†Ø®Ø¨Ø©</button>
    <button class="room-btn" onclick="switchRoom('cafe', this)">â˜• Ø§Ù„Ù…Ù‚Ù‡Ù‰</button>
</div>

<div id="chatbox"></div>

<div class="input-box">
    <input type="text" id="mInput" placeholder="Ø³ÙˆÙ„Ù ÙˆÙŠÙ‡ Ø§Ù„Ø¨ÙˆØª Ø£Ùˆ Ø§Ø³Ø£Ù„...">
    <button onclick="sendMsg()" class="send-btn">â¤</button>
</div>

<div id="overlay" onclick="toggleSide()"></div>
<div id="sidebar" class="sidebar">
    <h3 style="color:var(--neon)">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† Ø§Ù„Ø¢Ù† ğŸŒ</h3>
    <div id="userList"></div>
    <button onclick="localStorage.clear(); location.reload();" style="width:100%; margin-top:20px; background:#ff3b3b; border:none; padding:10px; border-radius:10px; color:#fff; font-weight:bold;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let my = { 
        n: localStorage.getItem('rg_n') || "", 
        f: "ğŸŒ", 
        xp: parseInt(localStorage.getItem('rg_xp')) || 0 
    };

    // Ø¬Ù„Ø¨ Ø¹Ù„Ù… Ø§Ù„Ø¯ÙˆÙ„Ø©
    fetch('https://ipapi.co/json/').then(r => r.json()).then(d => {
        my.f = d.country_code ? String.fromCodePoint(...d.country_code.toUpperCase().split('').map(c => 127397 + c.charCodeAt(0))) : "ğŸŒ";
        if(my.n) updatePresence();
    });

    if(!my.n) {
        let n = prompt("ÙŠØ§ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© MASTER RG.. Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
        if(n) { localStorage.setItem('rg_n', n); location.reload(); }
    }

    // Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ù…ØªÙØ§Ø¹Ù„
    const botBrain = {
        "Ù‡Ù„Ùˆ": ["Ù‡Ù„Ø§ ÙˆØºÙ„Ø§ØŒ Ù†ÙˆØ±Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©! ğŸ‘‘", "ÙŠØ§ Ù…ÙŠØ© Ù‡Ù„Ø§ØŒ Ø´Ù„ÙˆÙ†Ùƒ ÙŠØ§ Ø¨Ø·Ù„ØŸ", "Ù‡Ù„Ø§ Ø¨ÙŠÙƒØŒ Ø§Ù„Ø´Ø§Øª Ù…Ù†ÙˆØ± Ø¨ÙˆØ¬ÙˆØ¯Ùƒ"],
        "Ø´Ù„ÙˆÙ†Ùƒ": ["Ø¨Ø®ÙŠØ± ÙˆØ¹Ø§ÙÙŠØ© Ø¥Ø°Ø§ Ø£Ù†Øª Ø¨Ø®ÙŠØ±ØŒ Ø¨Ø´Ø±Ù†Ø§ Ø¹Ù†ÙƒØŸ", "Ø¨Ø®ÙŠØ± ÙŠØ§ ÙˆØ±Ø¯Ø©ØŒ ØªØ³Ù„Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¤Ø§Ù„"],
        "Ù…Ù†ÙˆØ±": ["Ù†ÙˆØ±Ùƒ Ù‡Ø°Ø§ ÙŠØ§ Ø°Ù‡Ø¨ØŒ Ø§Ù„Ø´Ø§Øª Ø´Ø¹Ø´Ø¹ Ø¨ÙˆØ¬ÙˆØ¯Ùƒ", "Ø£Ù†Øª Ø£ØµÙ„ Ø§Ù„Ù†ÙˆØ± ÙˆØ§Ù„Ø¬Ù…Ø§Ù„ ğŸŒ¹"],
        "Ù‡Ù‡Ù‡Ù‡": ["Ø¯ÙˆÙ… Ù‡Ø§Ù„Ø¶Ø­ÙƒØ©ØŒ Ø¹Ø³Ø§Ù‡Ø§ Ø¶Ø­ÙƒØ© Ø®ÙŠØ± ğŸ˜‚", "ÙØ¯ÙˆØ© Ù„Ù‡Ø§Ù„Ø¶Ø­ÙƒØ©ØŒ Ø§Ù†Ø±ØªÙ†Ø§"],
        "ÙƒÙÙˆ": ["ÙƒÙÙˆ Ù…Ù†Ùƒ ÙˆÙ…Ù† Ø£ØµÙ„Ùƒ Ø§Ù„Ø·ÙŠØ¨ØŒ Ø°ÙŠØ¨!", "Ø£Ù†Øª Ø§Ù„Ø³Ø¨Ø¹ ÙˆØ§Ù„Ù„Ù‡ ÙŠØ§ Ø¨Ø·Ù„"],
        "Ø¶ÙˆØ¬Ø©": ["Ù„ÙŠØ´ Ø§Ù„Ø¶ÙˆØ¬Ø©ØŸ Ø§ÙƒØªØ¨ 'Ø³Ø¤Ø§Ù„' ÙˆØ®Ù„ÙŠÙ†Ø§ Ù†ØªØ³Ù„Ù‰!", "Ø³ÙˆÙ„Ù ÙˆÙŠØ§Ù†Ø§ ÙˆØ§ÙØªØ­ Ù‚Ù„Ø¨ÙƒØŒ Ø§Ù„Ø¶ÙˆØ¬Ø© ØªÙ…ÙˆØª Ù‡Ù†Ø§"],
        "Ù…Ù†Ùˆ Ø§Ù„Ù…Ø§Ø³ØªØ±": ["Ø§Ù„Ù…Ø§Ø³ØªØ± RG Ù‡Ùˆ Ù‚Ø§Ø¦Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ÙˆÙ…Ø¤Ø³Ø³Ù‡Ø§ Ø§Ù„Ø´Ù‡Ù… ğŸ‘‘"]
    };

    const quiz = [{q:"Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø¹Ø±Ø§Ù‚ØŸ", a:"Ø¨ØºØ¯Ø§Ø¯"}, {q:"Ø£ÙƒØ¨Ø± ÙƒÙˆÙƒØ¨ØŸ", a:"Ø§Ù„Ù…Ø´ØªØ±ÙŠ"}, {q:"ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø§Ø±Ø§ØªØŸ", a:"7"}];
    let curRoom = "main", curAns = "";

    function switchRoom(id, btn) {
        curRoom = id;
        document.querySelectorAll('.room-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        loadMsgs();
    }

    function sendMsg() {
        let t = document.getElementById('mInput').value.trim(); if(!t) return;
        
        if(curAns && t === curAns) {
            db.ref('rooms/'+curRoom).push({ u: "ğŸ¤– BOT", t: "ğŸ¯ ØµØ­! Ø£Ø­Ø³Ù†Øª ÙŠØ§ " + my.n, bot: true });
            my.xp += 20; localStorage.setItem('rg_xp', my.xp); curAns = "";
        } else if(t === "Ø³Ø¤Ø§Ù„") {
            let q = quiz[Math.floor(Math.random()*quiz.length)]; curAns = q.a;
            db.ref('rooms/'+curRoom).push({ u: "ğŸ¤– BOT", t: "ğŸ¤” Ø³Ø¤Ø§Ù„: " + q.q, bot: true });
        } else {
            db.ref('rooms/'+curRoom).push({ u: my.n, t: t, f: my.f, lv: Math.floor(my.xp/50)+1 });
            for(let key in botBrain) {
                if(t.toLowerCase().includes(key)) {
                    let r = botBrain[key][Math.floor(Math.random()*botBrain[key].length)];
                    setTimeout(() => db.ref('rooms/'+curRoom).push({ u: "ğŸ¤– BOT", t: r, bot: true }), 800);
                    break;
                }
            }
        }
        document.getElementById('mInput').value = "";
    }

    function loadMsgs() {
        db.ref('rooms/'+curRoom).off();
        let box = document.getElementById('chatbox'); box.innerHTML = "";
        db.ref('rooms/'+curRoom).limitToLast(30).on('child_added', snap => {
            let m = snap.val();
            let yt = m.t.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
            let div = document.createElement('div'); div.className = 'msg-wrapper';
            div.innerHTML = `
                <img class="avatar" src="https://ui-avatars.com/api/?name=${m.u}&background=222&color=fff">
                <div class="bubble">
                    <div class="u-info" style="color:${m.bot?'var(--gold)':'var(--neon)'}">${m.f||''} ${m.u} ${m.lv?`<small style="color:#666">[Lv.${m.lv}]</small>`:''}</div>
                    <div>${m.t}</div>
                    ${yt ? `<iframe class="yt-vid" src="https://www.youtube.com/embed/${yt[1]}" frameborder="0" allowfullscreen></iframe>` : ''}
                </div>`;
            box.appendChild(div); box.scrollTop = box.scrollHeight;
        });
    }

    function updatePresence() {
        db.ref('online/'+my.n).set({ n: my.n, f: my.f }); db.ref('online/'+my.n).onDisconnect().remove();
        db.ref('online').on('value', snap => {
            let box = document.getElementById('userList'); box.innerHTML = "";
            let c = 0; snap.forEach(u => {
                c++; box.innerHTML += `<div class="user-item">ğŸŸ¢ <span style="margin:0 10px">${u.val().f}</span> <b>${u.val().n}</b></div>`;
            });
            document.getElementById('count').innerText = c + " Ù…ØªØµÙ„";
        });
    }

    function toggleSide() {
        let s = document.getElementById('sidebar'); s.classList.toggle('active');
        document.getElementById('overlay').style.display = s.classList.contains('active') ? 'block' : 'none';
    }

    loadMsgs();
</script>
</body>
</html>
