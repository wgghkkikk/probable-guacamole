<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALLOSH CHAMPIONSHIP V50 ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap');
        :root { --gold: #ffd700; --bg: #f0f2f5; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; margin: 0; padding: 0; }
        body { background: #000; color: white; overflow: hidden; height: 100vh; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        #game-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9000; display: none;
            justify-content: center; align-items: flex-start; padding-top: 20px;
            overflow-y: auto;
        }
        .game-window {
            width: 98%; max-width: 800px; background: var(--bg); 
            border-radius: 20px; overflow: hidden; color: #333; padding-bottom: 30px;
            box-shadow: 0 0 30px var(--gold);
        }
        .game-header { background: #e9ecef; padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ddd; }
        .close-btn { background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 900; cursor: pointer; }
        
        .bet-section { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: #fff; margin: 15px; border-radius: 15px; border: 2px dashed var(--gold); }
        .start-btn { background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 30px; font-weight: 900; font-size: 18px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        .players-vs { display: flex; gap: 20px; padding: 20px; justify-content: center; align-items: center; }
        .player-card { flex: 1; background: #fff; border: 2px solid #eee; border-radius: 20px; padding: 25px; text-align: center; position: relative; }
        .player-card.active { border-color: #28a745; background: #fafffa; transform: scale(1.05); }
        .score { font-size: 50px; font-weight: 900; color: #28a745; margin: 10px 0; }
        .vs-badge { background: #333; color: #fff; padding: 15px; border-radius: 50%; font-weight: 900; font-size: 20px; }

        .dice-area { text-align: center; padding: 30px; background: #fff; margin: 0 15px; border-radius: 20px; }
        .dice { width: 100px; height: 100px; background: white; border: 5px solid #ddd; border-radius: 20px; display: inline-flex; justify-content: center; align-items: center; font-size: 50px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .dice.rolling { transform: rotate(360deg) scale(1.2); }
        
        .btn-roll { margin-top: 20px; background: #4a69bd; color: white; border: none; padding: 15px 50px; border-radius: 15px; font-weight: 900; font-size: 20px; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-overlay">
    <div class="game-window">
        <div class="game-header">
            <button class="close-btn" onclick="closeGame()">âœ– Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
            <div id="status-text" style="font-weight: 900; color: #4a69bd;">Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ù†Ø§ÙØ³...</div>
        </div>

        <div class="bet-section">
            <button class="start-btn" id="main-start-btn" onclick="requestStart()">Ø¥Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¢Ù† ğŸ</button>
            <div style="text-align: left;">
                <span style="font-size: 14px; font-weight: bold; color: #555;">Ø±Ù‡Ø§Ù†Ùƒ Ø§Ù„Ø®Ø§Øµ ğŸ’°</span><br>
                <input type="number" id="custom-bet" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" style="width: 120px; border: 2px solid #ddd; border-radius: 10px; text-align: center; padding: 10px; font-weight: 900; font-size: 16px;">
            </div>
        </div>

        <div class="players-vs">
            <div class="player-card" id="card-p1">
                <span style="font-size: 18px; font-weight: bold;">Ø§Ù„Ù„Ø§Ø¹Ø¨ 1 (Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ)</span>
                <div class="score" id="p1-score">0</div>
                <div style="font-size: 12px; color: #999;">Ø§Ù„Ù‡Ø¯Ù: 100</div>
            </div>
            <div class="vs-badge">VS</div>
            <div class="player-card" id="card-p2">
                <span style="font-size: 18px; font-weight: bold;">Ø§Ù„Ù„Ø§Ø¹Ø¨ 2 (Ø§Ù„Ù…ØªØ­Ø¯ÙŠ)</span>
                <div class="score" id="p2-score">0</div>
                <div style="font-size: 12px; color: #999;">Ø§Ù„Ù‡Ø¯Ù: 100</div>
            </div>
        </div>

        <div class="dice-area">
            <div class="dice" id="the-dice">?</div><br>
            <button class="btn-roll" id="roll-action-btn" onclick="playerRoll()" style="display:none;">Ø§Ø±Ù…Ù Ø§Ù„Ø²Ù‡Ø± ğŸ²</button>
            <p id="turn-msg" style="margin-top:15px; font-weight:bold; color:#666;">Ø§Ø¶ØºØ· Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠ</p>
        </div>
    </div>
</div>

<div style="height: 60px; background: #111; display: flex; align-items: center; justify-content: center; border-bottom: 2px solid var(--gold);">
    <button onclick="openGame()" style="background:var(--gold); border:none; padding:10px 30px; border-radius:10px; font-weight:900; cursor:pointer;">ğŸ† Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ ğŸ†</button>
</div>

<div id="chat" style="height: calc(100vh - 145px); overflow-y: auto; padding: 20px;"></div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let myRole = null; // p1 or p2
    let currentTurn = "p1";
    let gameActive = false;
    let roomRef = db.ref('match_v50');

    function openGame() {
        document.getElementById('game-overlay').style.display = 'flex';
        joinRoom();
    }

    function joinRoom() {
        roomRef.once('value', s => {
            if(!s.exists() || !s.val().p1) {
                myRole = "p1";
                roomRef.update({ p1: "Ù…ØªØµÙ„", p1_score: 0, p2_score: 0, turn: "p1", status: "waiting" });
                document.getElementById('status-text').innerText = "Ø£Ù†Øª Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ (P1) - Ø§Ù†ØªØ¸Ø§Ø± ØµØ¯ÙŠÙ‚Ùƒ...";
            } else if(!s.val().p2) {
                myRole = "p2";
                roomRef.update({ p2: "Ù…ØªØµÙ„", status: "ready" });
                document.getElementById('status-text').innerText = "Ø£Ù†Øª Ø§Ù„Ù…ØªØ­Ø¯ÙŠ (P2) - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ø¨!";
            }
        });
    }

    roomRef.on('value', s => {
        let d = s.val(); if(!d) return;
        document.getElementById('p1-score').innerText = d.p1_score || 0;
        document.getElementById('p2-score').innerText = d.p2_score || 0;
        currentTurn = d.turn;

        if(d.status === "playing") {
            gameActive = true;
            document.getElementById('roll-action-btn').style.display = 'inline-block';
            document.getElementById('turn-msg').innerText = (currentTurn === myRole) ? "Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†! Ø§Ø±Ù…Ù Ø§Ù„Ø²Ù‡Ø±" : "Ø§Ù†ØªØ¸Ø± Ø¯ÙˆØ± Ø®ØµÙ…Ùƒ...";
            document.getElementById('card-p1').classList.toggle('active', currentTurn === "p1");
            document.getElementById('card-p2').classList.toggle('active', currentTurn === "p2");
        }

        if(d.last_dice) {
            document.getElementById('the-dice').innerText = d.last_dice;
        }

        if(d.p1_score >= 100 || d.p2_score >= 100) {
            let winner = d.p1_score >= 100 ? "Ù„Ø§Ø¹Ø¨ 1" : "Ù„Ø§Ø¹Ø¨ 2";
            alert("ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©! Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ: " + winner);
            roomRef.remove();
            location.reload();
        }
    });

    function requestStart() {
        let bet = document.getElementById('custom-bet').value;
        if(!bet) return alert("ÙŠØ§ Ù…Ù„ÙƒØŒ Ø­Ø¯Ø¯ Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù† Ø£ÙˆÙ„Ø§Ù‹!");
        roomRef.update({ status: "playing", bet: bet });
    }

    function playerRoll() {
        if(!gameActive || currentTurn !== myRole) return;

        let roll = Math.floor(Math.random() * 6) + 1;
        let scoreKey = myRole + "_score";
        
        roomRef.once('value', s => {
            let newScore = (s.val()[scoreKey] || 0) + roll;
            roomRef.update({
                [scoreKey]: newScore,
                last_dice: roll,
                turn: (myRole === "p1" ? "p2" : "p1")
            });
        });

        document.getElementById('the-dice').classList.add('rolling');
        setTimeout(() => document.getElementById('the-dice').classList.remove('rolling'), 200);
    }

    function closeGame() {
        roomRef.remove();
        document.getElementById('game-overlay').style.display = 'none';
    }
</script>
</body>
</html>
