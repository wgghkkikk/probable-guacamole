<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ | CH-ALLOSH ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --gold: #ffd700; --dark-bg: #0a0a0b; --sidebar-bg: #111113; --msg-bg: #161618; }
        body { margin: 0; background: var(--dark-bg); color: #e0e0e0; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
        #main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† (Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†) */
        #user-list { 
            width: 200px; background: var(--sidebar-bg); border-left: 1px solid #222; 
            padding: 15px; display: flex; flex-direction: column; gap: 10px;
        }
        .list-title { font-size: 12px; color: #666; font-weight: bold; margin-bottom: 5px; border-bottom: 1px solid #222; padding-bottom: 5px; }
        .user-item { padding: 8px 12px; border-radius: 8px; font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .user-master { background: rgba(255, 215, 0, 0.1); border: 1px solid var(--gold); color: var(--gold); font-weight: bold; }
        .user-member { background: #1a1a1a; color: #aaa; }
        .status-dot { width: 8px; height: 8px; background: #4caf50; border-radius: 50%; box-shadow: 0 0 5px #4caf50; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        #chat-section { flex: 1; display: flex; flex-direction: column; }
        #chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ø³ØªØ± */
        #master-panel { display: none; background: #111; padding: 8px; border-bottom: 1px solid var(--gold); text-align: center; }
        .btn { border: 1px solid var(--gold); padding: 5px 12px; border-radius: 15px; background: transparent; color: var(--gold); cursor: pointer; margin: 0 5px; font-size: 12px; }
        
        /* Ø§Ù„ÙÙ‚Ø§Ø¹Ø§Øª */
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 15px 15px 15px 0; position: relative; }
        .msg-master { background: #222; border-right: 3px solid var(--gold); align-self: flex-start; }
        .msg-member { background: #1a1a1a; border-right: 3px solid #444; align-self: flex-start; }
        .sender { font-weight: bold; font-size: 13px; display: block; margin-bottom: 3px; }
        .gold-txt { color: var(--gold); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .footer { padding: 15px; background: #111; display: flex; gap: 10px; border-top: 1px solid #222; }
        input { flex: 1; background: #1e1e1e; border: 1px solid #333; color: white; padding: 12px; border-radius: 20px; outline: none; }
        button#sendBtn { background: var(--gold); border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 20px; }
    </style>
</head>
<body>

<div id="master-panel">
    <button class="btn" onclick="clearChat()">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ</button>
    <button id="lockBtn" class="btn" onclick="toggleLock()">ğŸ”’ Ù‚ÙÙ„</button>
</div>

<div id="main-container">
    <div id="user-list">
        <div class="list-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Øª</div>
        <div id="master-list"></div>
        <div class="list-title" style="margin-top:10px;">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†</div>
        <div id="members-list"></div>
    </div>

    <div id="chat-section">
        <div id="chat-area"></div>
        <div class="footer">
            <input type="text" id="mInput" placeholder="Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ø§Ù‹ ÙŠØ§ Ù…Ù„Ùƒ..." onkeypress="if(event.key==='Enter') send()">
            <button id="sendBtn" onclick="send()">â</button>
        </div>
    </div>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let myName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙŠØ§ Ù…Ù„Ùƒ:"); 
    if (!myName) { location.reload(); }

    let myRank = "Ø¹Ø¶Ùˆ";
    
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚
    if (myName.trim() === "Ø¹Ù„ÙˆØ´") {
        let pass = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØ©:");
        if (pass === "Allosh#King@2025") { 
            myRank = "Ø§Ù„Ù…Ø§Ø³ØªØ±";
            document.getElementById('master-panel').style.display = 'block';
        } else {
            alert("Ø¨Ø§Ø³ÙˆØ±Ø¯ ØºÙ„Ø·!"); myName = "Ø²Ø§Ø¦Ø±_" + Math.floor(Math.random()*99);
        }
    }

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    const userRef = db.ref('online_users/' + myName);
    userRef.set({ name: myName, role: myRank });
    userRef.onDisconnect().remove();

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    db.ref('online_users').on('value', snap => {
        const mList = document.getElementById('master-list');
        const uList = document.getElementById('members-list');
        mList.innerHTML = ""; uList.innerHTML = "";
        
        snap.forEach(child => {
            const user = child.val();
            const div = document.createElement('div');
            div.className = `user-item ${user.role === 'Ø§Ù„Ù…Ø§Ø³ØªØ±' ? 'user-master' : 'user-member'}`;
            div.innerHTML = `<div class="status-dot"></div> ${user.name} ${user.role === 'Ø§Ù„Ù…Ø§Ø³ØªØ±' ? 'ğŸ‘‘' : ''}`;
            
            if(user.role === 'Ø§Ù„Ù…Ø§Ø³ØªØ±') mList.appendChild(div);
            else uList.appendChild(div);
        });
    });

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    function send() {
        let input = document.getElementById('mInput');
        let text = input.value.trim();
        if(!text) return;
        db.ref('messages').push({ sender: myName, content: text, role: myRank });
        input.value = "";
    }

    db.ref('messages').limitToLast(50).on('child_added', snap => {
        let data = snap.val();
        let isM = data.role === "Ø§Ù„Ù…Ø§Ø³ØªØ±";
        let div = document.createElement('div');
        div.className = `msg ${isM ? 'msg-master' : 'msg-member'}`;
        div.innerHTML = `<span class="sender ${isM?'gold-txt':''}">${data.sender}:</span>${data.content}`;
        document.getElementById('chat-area').appendChild(div);
        document.getElementById('chat-area').scrollTop = document.getElementById('chat-area').scrollHeight;
    });

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø§Ø³ØªØ±
    function clearChat() { if(confirm("Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ")) db.ref('messages').remove(); }
    db.ref('messages').on('value', snap => { if(!snap.exists()) document.getElementById('chat-area').innerHTML = ""; });
</script>
</body>
</html>
