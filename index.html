<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ© ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; display: flex; overflow: hidden; }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø«Ø§Ø¨ØªØ© */
        #admin-gear { position: fixed; top: 15px; left: 15px; background: var(--main); color: #000; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; z-index: 2000; box-shadow: 0 0 15px var(--main); border: none; }
        
        #admin-panel { position: fixed; top: 70px; left: 15px; background: rgba(15,15,15,0.95); border: 2px solid var(--main); border-radius: 15px; padding: 15px; display: none; z-index: 2000; min-width: 180px; }
        .admin-btn { width: 100%; background: var(--main); color: #000; border: none; padding: 10px; margin-bottom: 8px; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-container { flex: 1; display: flex; flex-direction: column; position: relative; }

        /* Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª */
        .mics-row { display: flex; gap: 5px; padding: 10px; background: #0a0a0a; border-bottom: 1px solid #222; }
        .mic-slot { flex: 1; background: #111; height: 50px; border: 1px dashed #444; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 11px; }

        /* Ø§Ù„Ø´Ø§Øª */
        #chat-window { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 12px; max-width: 80%; border: 1px solid #222; word-wrap: break-word; }
        .msg.me { align-self: flex-end; border-right: 4px solid var(--main); background: #151515; }
        .img-msg { max-width: 100%; border-radius: 8px; margin-top: 5px; }

        /* Ø®Ø§Ù†Ø© Ø§Ù„Ø³Ù…Ø§ÙŠÙ„Ø§Øª ÙˆØ§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© */
        #emoji-drawer { display: none; background: #111; border-top: 2px solid var(--main); padding: 10px; max-height: 150px; overflow-y: auto; }
        .emoji-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(35px, 1fr)); gap: 10px; }
        .emoji-item { font-size: 25px; cursor: pointer; text-align: center; transition: 0.2s; }
        .emoji-item:hover { transform: scale(1.3); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-bar { padding: 12px; background: #050505; display: flex; gap: 10px; align-items: center; border-top: 1px solid #222; }
        input[type="text"] { flex: 1; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 25px; outline: none; }
        .icon-btn { background: none; border: none; font-size: 22px; cursor: pointer; color: var(--main); }

        /* Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ */
        #yt-box { display: none; background: #000; padding: 10px; border-bottom: 2px solid var(--main); }

        /* Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù† (Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†) */
        #sidebar { width: 200px; background: #0a0a0a; border-left: 2px solid var(--main); transition: 0.3s; }
        #sidebar.hide { margin-right: -200px; }
    </style>
</head>
<body>

    <button id="admin-gear" onclick="toggleAdmin()">âš™ï¸</button>
    
    <div id="admin-panel">
        <button class="admin-btn" onclick="toggleYT()">ğŸ“º Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨</button>
        <button class="admin-btn" onclick="location.reload()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
        <button class="admin-btn" onclick="toggleSide()">ğŸ‘¤ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
        <button class="admin-btn" onclick="clearChat()" style="background:red; color:#fff;">ğŸ§¨ ØªØµÙÙŠØ± Ø§Ù„Ø´Ø§Øª</button>
    </div>

    <div class="main-container">
        <div id="yt-box">
            <div style="display:flex; gap:5px;">
                <input type="text" id="yt-search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ ÙŠÙˆØªÙŠÙˆØ¨..." style="flex:1; background:#111; color:#fff; border:1px solid #444; padding:8px;">
                <button onclick="searchYT()" style="background:var(--main); border:none; padding:8px;">ğŸ”</button>
            </div>
            <div id="video-display" style="height:180px; margin-top:10px; display:none;"></div>
        </div>

        <div class="mics-row">
            <div class="mic-slot" id="mic1">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(1)">ØµØ¹ÙˆØ¯</button></div>
            <div class="mic-slot" id="mic2">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(2)">ØµØ¹ÙˆØ¯</button></div>
            <div class="mic-slot" id="mic3">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(3)">ØµØ¹ÙˆØ¯</button></div>
            <div class="mic-slot" id="mic4">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(4)">ØµØ¹ÙˆØ¯</button></div>
        </div>

        <div id="chat-window"></div>

        <div id="emoji-drawer">
            <div class="emoji-grid">
                <span class="emoji-item" onclick="addE('ğŸ˜‚')">ğŸ˜‚</span><span class="emoji-item" onclick="addE('ğŸ”¥')">ğŸ”¥</span>
                <span class="emoji-item" onclick="addE('ğŸ‘‘')">ğŸ‘‘</span><span class="emoji-item" onclick="addE('âœ¨')">âœ¨</span>
                <span class="emoji-item" onclick="addE('ğŸ’¯')">ğŸ’¯</span><span class="emoji-item" onclick="addE('ğŸ’')">ğŸ’</span>
                <span class="emoji-item" onclick="addE('ğŸ¤')">ğŸ¤</span><span class="emoji-item" onclick="addE('ğŸŒ¹')">ğŸŒ¹</span>
                <span class="emoji-item" onclick="addE('ğŸ’™')">ğŸ’™</span><span class="emoji-item" onclick="addE('ğŸ‘»')">ğŸ‘»</span>
                <span class="emoji-item" onclick="addE('ğŸš€')">ğŸš€</span><span class="emoji-item" onclick="addE('ğŸ§¿')">ğŸ§¿</span>
            </div>
        </div>

        <div class="input-bar">
            <button class="icon-btn" onclick="toggleEmojis()">ğŸ˜Š</button>
            <label class="icon-btn" style="cursor:pointer;">
                ğŸ“· <input type="file" id="img-up" hidden accept="image/*" onchange="upImg(this)">
            </label>
            <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø« ÙŠØ§ Ù…Ù„Ùƒ...">
            <button class="icon-btn" onclick="send()" style="color:var(--main); font-size:30px;">ğŸš€</button>
        </div>
    </div>

    <div id="sidebar">
        <div style="padding:15px; border-bottom:1px solid #222; text-align:center; color:var(--main);">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ†</div>
        <div id="user-list" style="padding:10px;"></div>
    </div>

<script>
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    const auth = firebase.auth();
    let myName = "";

    auth.onAuthStateChanged(user => {
        if (user) {
            myName = user.email === "rgrghh77@gmail.com" ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('status/' + user.uid).set({ n: myName });
            db.ref('status/' + user.uid).onDisconnect().remove();
            loadChat(); loadUsers(); syncMics();
        } else { window.location.href = "index.html"; }
    });

    // Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    function toggleAdmin() { const p = document.getElementById('admin-panel'); p.style.display = p.style.display === 'block' ? 'none' : 'block'; }
    function toggleEmojis() { const d = document.getElementById('emoji-drawer'); d.style.display = d.style.display === 'block' ? 'none' : 'block'; }
    function toggleYT() { const b = document.getElementById('yt-box'); b.style.display = b.style.display === 'block' ? 'none' : 'block'; }
    function toggleSide() { document.getElementById('sidebar').classList.toggle('hide'); }
    function addE(e) { document.getElementById('mInp').value += e; }

    // Ø¥Ø±Ø³Ø§Ù„ ÙˆØµÙˆØ±
    function send() {
        const i = document.getElementById('mInp');
        if(!i.value.trim()) return;
        db.ref('msgs').push({ u: myName, t: i.value, m: myName.includes("ğŸ‘‘") });
        i.value = '';
    }

    function upImg(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                db.ref('msgs').push({ u: myName, img: e.target.result, m: myName.includes("ğŸ‘‘") });
            };
            reader.readAsDataURL(file);
        }
    }

    function loadChat() {
        db.ref('msgs').limitToLast(30).on('child_added', snap => {
            const d = snap.val();
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.className = `msg ${d.m ? 'me' : 'other'}`;
            if(d.img) div.innerHTML = `<small style="color:var(--main)">${d.u}</small><br><img src="${d.img}" class="img-msg">`;
            else div.innerHTML = `<small style="color:var(--main)">${d.u}</small><br>${d.t}`;
            win.appendChild(div);
            win.scrollTop = win.scrollHeight;
        });
        db.ref('msgs').on('child_removed', () => location.reload());
    }

    function clearChat() { if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø´Ø§ØªØŸ")) db.ref('msgs').remove(); }

    function loadUsers() {
        db.ref('status').on('value', snap => {
            const list = document.getElementById('user-list');
            list.innerHTML = `<div style="color:#00f2ff; font-size:12px; margin-bottom:10px;">ğŸ¤– Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ù…ØªØµÙ„</div>`;
            snap.forEach(u => { list.innerHTML += `<div style="font-size:12px; margin-bottom:5px;">ğŸŸ¢ ${u.val().n}</div>`; });
        });
    }

    function joinMic(n) {
        const ref = db.ref('mics/s' + n);
        ref.once('value', s => { if(s.val() && s.val().n === myName) ref.remove(); else if(!s.val()) ref.set({ n: myName }); });
    }

    function syncMics() {
        for(let i=1; i<=4; i++) {
            db.ref('mics/s' + i).on('value', s => {
                const el = document.getElementById('mic' + i);
                el.innerHTML = s.val() ? `ğŸ¤ ${s.val().n} <button onclick="joinMic(${i})" style="font-size:8px;">X</button>` : `ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(${i})" style="font-size:8px;">ØµØ¹ÙˆØ¯</button>`;
            });
        }
    }
</script>
</body>
</html>
