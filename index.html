<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ø¸Ù…Ù‰ ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; --panel: #0d0d0d; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; overflow: hidden; }

        /* Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø°ÙƒÙŠØ© */
        .side { width: 280px; height: 100vh; background: var(--panel); position: fixed; transition: 0.3s; z-index: 2000; top: 0; border: 1px solid #333; }
        #side-right { right: -285px; border-left: 2px solid var(--main); }
        #side-left { left: -285px; border-right: 2px solid var(--main); }
        .side.open { right: 0 !important; left: 0 !important; }

        /* Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ (Ø§Ù„Ø¸Ø§Ù‡Ø± Ù„Ù„ÙƒÙ„) */
        #user-card { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 320px; background: #1a1a1a; border: 2px solid var(--main); border-radius: 20px; display: none; z-index: 3000; overflow: hidden; box-shadow: 0 0 30px #000; }
        .card-header { height: 100px; background: #333; background-size: cover; background-position: center; }
        .card-av { width: 90px; height: 90px; border-radius: 50%; border: 4px solid var(--main); margin: -45px auto 0; display: block; background: #000; object-fit: cover; }

        /* Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        #main-view { height: 100vh; display: flex; flex-direction: column; position: relative; }
        #chat-window { flex: 1; overflow-y: auto; padding: 15px; background: #050505; display: flex; flex-direction: column; gap: 12px; }

        /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .msg-row { display: flex; gap: 10px; align-items: flex-start; }
        .msg-row.me { flex-direction: row-reverse; }
        .u-img { width: 45px; height: 45px; border-radius: 12px; border: 1px solid #444; cursor: pointer; object-fit: cover; }
        .u-name { font-size: 11px; color: var(--main); font-weight: bold; margin-bottom: 3px; display: block; }
        .bubble { background: #161616; padding: 10px 14px; border-radius: 12px; max-width: 70%; border: 1px solid #222; font-size: 15px; }
        .me .bubble { background: #221a00; border-color: var(--main); }

        /* Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ø§Ù„Ø¹Ø§Ø¦Ù… */
        #yt-float { position: absolute; top: 70px; left: 10px; width: 180px; height: 120px; background: #000; border: 2px solid var(--main); z-index: 1000; border-radius: 10px; display: none; overflow: hidden; }
        .yt-ctrl { background: rgba(0,0,0,0.8); display: flex; justify-content: space-around; font-size: 11px; padding: 4px; border-bottom: 1px solid #333; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª Ø§Ù„Ø¶Ø®Ù…Ø© */
        #emoji-box { height: 220px; background: #0a0a0a; border-top: 2px solid var(--main); display: none; overflow-y: auto; padding: 10px; z-index: 1500; }
        .emoji-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 12px; }
        .emoji-item { font-size: 30px; cursor: pointer; text-align: center; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .bar { padding: 10px; background: #000; display: flex; gap: 10px; align-items: center; border-top: 1px solid #222; }
        input { flex: 1; background: #111; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; outline: none; }
        .btn-icon { color: var(--main); font-size: 24px; cursor: pointer; border: none; background: none; }
    </style>
</head>
<body onclick="closeAllPanels()">

    <div id="user-card" onclick="event.stopPropagation()">
        <div class="card-header" id="c-cover"></div>
        <img src="" class="card-av" id="c-av">
        <div style="text-align:center; padding:20px;">
            <h2 id="c-name" style="margin:5px 0; color:var(--main);">ØªØ­Ù…ÙŠÙ„...</h2>
            <p id="c-bio" style="font-size:13px; color:#aaa;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</p>
            <audio id="c-music" controls style="width:100%; height:30px; margin-top:10px; display:none;"></audio>
            <button onclick="document.getElementById('user-card').style.display='none'" style="margin-top:15px; background:var(--main); border:none; padding:8px 20px; border-radius:10px; font-weight:bold;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="side-right" class="side" onclick="event.stopPropagation()">
        <div style="padding:15px; color:var(--main); border-bottom:1px solid #333; text-align:center;">ğŸ‘¥ Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù†</div>
        <div id="user-list" style="padding:10px;"></div>
    </div>

    <div id="side-left" class="side" onclick="event.stopPropagation()">
        <div style="padding:15px; color:var(--main); border-bottom:1px solid #333; text-align:center;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±</div>
        <div style="padding:15px;">
            <button class="btn-icon" style="font-size:16px;" onclick="editMyProfile()">ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</button><br><br>
            <button class="btn-icon" style="font-size:16px;" onclick="askYT()">ğŸ“º ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨</button><br><br>
            <button class="btn-icon" style="font-size:16px; color:red;" onclick="db.ref('main_msgs').remove()">ğŸ§¨ ØªØµÙÙŠØ± Ø§Ù„Ø´Ø§Øª</button>
        </div>
    </div>

    <div id="main-view">
        <div style="padding:12px; background:#111; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333;">
            <button class="btn-icon" onclick="toggleSide('left', event)">â˜°</button>
            <b style="color:var(--main); font-size:18px;">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</b>
            <button class="btn-icon" onclick="toggleSide('right', event)">ğŸ‘¥</button>
        </div>

        <div id="yt-float" onclick="event.stopPropagation()">
            <div class="yt-ctrl">
                <span onclick="ytSet(false)">ğŸ”‡ ØµÙˆØª</span>
                <span onclick="ytSet(true)">ğŸ“º ÙÙŠØ¯ÙŠÙˆ</span>
                <span onclick="document.getElementById('yt-float').style.display='none'">X</span>
            </div>
            <div id="yt-frame" style="width:100%; height:100%;"></div>
        </div>

        <div id="chat-window"></div>

        <div id="emoji-box" onclick="event.stopPropagation()">
            <div class="emoji-grid" id="em-list"></div>
        </div>

        <div class="bar" onclick="event.stopPropagation()">
            <button class="btn-icon" onclick="toggleEmojiBox(event)">ğŸ˜Š</button>
            <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø« ÙŠØ§ Ù…Ù„Ùƒ...">
            <button class="btn-icon" onclick="send()">ğŸš€</button>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let myID, myData = {};

    auth.onAuthStateChanged(u => {
        if(u) {
            myID = u.uid;
            db.ref('users/'+myID).on('value', s => {
                myData = s.val() || { n: u.email.split('@')[0], av: "https://via.placeholder.com/100", cv: "https://via.placeholder.com/400x150", st: "Ù…Ù…Ù„ÙƒØªÙŠ Ø§Ù„Ø®Ø§ØµØ©" };
                db.ref('status/'+myID).set({ n: myData.n, av: myData.av });
            });
            initChat();
        }
    });

    function toggleSide(d, e) { e.stopPropagation(); document.getElementById('side-'+d).classList.add('open'); }
    function closeAllPanels() {
        document.getElementById('side-right').classList.remove('open');
        document.getElementById('side-left').classList.remove('open');
        document.getElementById('emoji-box').style.display = 'none';
        document.getElementById('user-card').style.display = 'none';
    }

    function toggleEmojiBox(e) { e.stopPropagation(); const b = document.getElementById('emoji-box'); b.style.display = b.style.display === 'block' ? 'none' : 'block'; }

    function editMyProfile() {
        const n = prompt("Ø§Ø³Ù…Ùƒ:", myData.n);
        const av = prompt("Ø±Ø§Ø¨Ø· ØµÙˆØ±ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©:", myData.av);
        const cv = prompt("Ø±Ø§Ø¨Ø· ØºÙ„Ø§Ù Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„:", myData.cv);
        const st = prompt("Ø­Ø§Ù„ØªÙƒ (Bio):", myData.st);
        const mu = prompt("Ø±Ø§Ø¨Ø· Ù…ÙˆØ³ÙŠÙ‚Ù‰ MP3 Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„Ùƒ:");
        db.ref('users/'+myID).update({ n, av, cv, st, mu });
    }

    function send() {
        const t = document.getElementById('mInp').value;
        if(!t) return;
        db.ref('main_msgs').push({ uid: myID, n: myData.n, av: myData.av, t: t });
        document.getElementById('mInp').value = '';
    }

    function showUser(uid) {
        event.stopPropagation();
        db.ref('users/'+uid).once('value', s => {
            const d = s.val();
            if(d) {
                document.getElementById('c-name').innerText = d.n;
                document.getElementById('c-av').src = d.av;
                document.getElementById('c-cover').style.backgroundImage = `url('${d.cv}')`;
                document.getElementById('c-bio').innerText = d.st;
                const m = document.getElementById('c-music');
                if(d.mu) { m.src = d.mu; m.style.display = 'block'; m.play(); } else { m.style.display = 'none'; }
                document.getElementById('user-card').style.display = 'block';
            }
        });
    }

    function initChat() {
        db.ref('main_msgs').limitToLast(40).on('child_added', s => {
            const d = s.val();
            const isMe = d.uid === myID;
            const div = document.createElement('div');
            div.className = `msg-row ${isMe ? 'me' : ''}`;
            div.innerHTML = `<img src="${d.av}" class="u-img" onclick="showUser('${d.uid}')">
                <div class="bubble"><span class="u-name">${d.n}</span>${d.t}</div>`;
            document.getElementById('chat-window').appendChild(div);
            document.getElementById('chat-window').scrollTop = document.getElementById('chat-window').scrollHeight;
        });

        const ems = ['ğŸ˜‚','ğŸ”¥','ğŸ‘‘','âœ¨','ğŸ’¯','ğŸ’','ğŸŒ¹','ğŸ’™','ğŸš€','ğŸ§¿','ğŸ‡®ğŸ‡¶','ğŸ¤','â¤ï¸','ğŸ‘Œ','ğŸ˜','ğŸ¤”','âš¡','ğŸ‰','ğŸ’ª','ğŸ¤«','ğŸ¤´','ğŸ¤©','ğŸ¦','ğŸ­','ğŸ·','ğŸ§¨','ğŸ§¿'];
        ems.forEach(e => { document.getElementById('em-list').innerHTML += `<span class="emoji-item" onclick="document.getElementById('mInp').value += '${e}'">${e}</span>`; });

        db.ref('status').on('value', s => {
            const list = document.getElementById('user-list');
            list.innerHTML = '';
            s.forEach(u => {
                list.innerHTML += `<div style="display:flex; align-items:center; gap:10px; margin-bottom:12px; cursor:pointer;" onclick="showUser('${u.key}')">
                    <img src="${u.val().av}" style="width:35px; height:35px; border-radius:50%; border:1px solid var(--main);">
                    <span>${u.val().n}</span><span style="color:#0f0; font-size:10px;">â—</span>
                </div>`;
            });
        });
    }

    function askYT() {
        const id = prompt("ÙƒÙˆØ¯ Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨:");
        if(id) db.ref('global_yt').set({ id, v: true });
    }
    db.ref('global_yt').on('value', s => {
        const y = s.val();
        if(y) {
            document.getElementById('yt-float').style.display = 'block';
            document.getElementById('yt-frame').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${y.id}?autoplay=1&controls=${y.v?1:0}" frameborder="0"></iframe>`;
        }
    });
    function ytSet(v) { db.ref('global_yt/v').set(v); }
</script>
</body>
</html>
