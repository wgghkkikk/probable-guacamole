<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>MASTER RG - ROYAL SYSTEM</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;900&display=swap" rel="stylesheet">
    <style>
        :root { --main: #00f2ff; --gold: #ffd700; --bg: #050505; --card: #111; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: #fff; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { height: 70px; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); display: flex; justify-content: space-between; align-items: center; padding: 0 20px; border-bottom: 1px solid #222; z-index: 1000; }
        .master-brand { font-size: 22px; font-weight: 900; background: linear-gradient(to right, var(--gold), #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ø¹Ø§Ø¦Ù… */
        #profile-card { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 350px; background: #111; border-radius: 25px; border: 1px solid var(--main); z-index: 3000; display: none; overflow: hidden; box-shadow: 0 0 50px rgba(0,242,255,0.3); }
        .cover { width: 100%; height: 120px; background: #222; background-size: cover; background-position: center; }
        .pfp { width: 80px; height: 80px; border-radius: 50%; border: 4px solid #111; margin-top: -40px; margin-right: 20px; object-fit: cover; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ© */
        .rooms-list { display: flex; overflow-x: auto; padding: 15px; gap: 12px; scrollbar-width: none; background: #080808; }
        .room-tab { background: var(--card); padding: 10px 20px; border-radius: 15px; border: 1px solid #222; white-space: nowrap; transition: 0.3s; cursor: pointer; color: #888; }
        .room-tab.active { background: linear-gradient(45deg, var(--main), #0066ff); color: #000; font-weight: bold; border: none; box-shadow: 0 5px 15px rgba(0,242,255,0.4); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        #chat-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; }
        .msg { margin-bottom: 20px; display: flex; flex-direction: column; max-width: 85%; align-self: flex-start; }
        .msg.me { align-self: flex-end; }
        .msg-meta { font-size: 11px; margin-bottom: 4px; display: flex; align-items: center; gap: 5px; color: #aaa; }
        .bubble { background: #1a1a1a; padding: 12px 16px; border-radius: 20px; border-top-right-radius: 2px; position: relative; border: 1px solid #252525; }
        .me .bubble { background: #004455; border-top-right-radius: 20px; border-top-left-radius: 2px; }
        .quote { background: rgba(0,0,0,0.3); padding: 5px 10px; border-right: 3px solid var(--main); font-size: 12px; margin-bottom: 8px; border-radius: 5px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-zone { background: #0a0a0a; padding: 15px; display: flex; align-items: center; gap: 10px; border-top: 1px solid #222; position: relative; }
        #reply-preview { position: absolute; top: -50px; left: 0; right: 0; background: #111; padding: 10px 20px; border-top: 2px solid var(--main); display: none; font-size: 12px; }
        #mInput { flex: 1; background: #181818; border: 1px solid #333; color: #fff; padding: 15px; border-radius: 15px; outline: none; }
        .send-btn { background: var(--main); width: 55px; height: 55px; border-radius: 15px; border: none; font-size: 24px; cursor: pointer; }

        .btn-sm { font-size: 10px; padding: 2px 8px; background: #333; border-radius: 5px; cursor: pointer; margin-right: 5px; }
    </style>
</head>
<body>

<div id="profile-card">
    <div class="cover" id="p-cover"></div>
    <img src="" class="pfp" id="p-img">
    <div style="padding: 20px;">
        <h3 id="p-name" style="margin:0"></h3>
        <p id="p-bio" style="font-size:12px; color:#888;">Ø¹Ø¶Ùˆ Ù…Ù„ÙƒÙŠ ÙÙŠ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© MASTER RG</p>
        <button onclick="editProfile()" style="width:100%; padding:10px; border-radius:10px; border:none; background:var(--main); color:#000; font-weight:bold;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</button>
        <button onclick="closeProfile()" style="width:100%; margin-top:10px; background:none; border:none; color:#fff;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<header>
    <div class="master-brand" onclick="showMyProfile()">MASTER RG ğŸ‘‘</div>
    <div id="online-count" style="font-size:11px; color:var(--main)">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ..</div>
</header>

<div class="rooms-list" id="rooms">
    <div class="room-tab active" onclick="changeRoom('main', this)">ğŸ› Ø§Ù„Ø¹Ø±Ø´</div>
    <div class="room-tab" onclick="changeRoom('vip', this)">ğŸ’ Ø§Ù„Ø¯ÙŠÙˆØ§Ù†</div>
    <div class="room-tab" onclick="changeRoom('game', this)">ğŸ® Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div>
    <div class="room-tab" onclick="changeRoom('elite', this)">ğŸ¤ Ø§Ù„Ù†Ø®Ø¨Ø©</div>
</div>

<div id="chat-area"></div>

<div id="reply-preview">
    <span>Ø±Ø¯ Ø¹Ù„Ù‰: <b id="reply-user"></b></span>
    <button onclick="cancelReply()" style="float:left; background:none; border:none; color:red;">âœ–</button>
</div>

<div class="input-zone">
    <button onclick="showMyProfile()" style="background:none; border:none; font-size:24px;">ğŸ‘¤</button>
    <input type="text" id="mInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ ÙŠØ§ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±...">
    <button onclick="sendMessage()" class="send-btn">â¤</button>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let my = {
        n: localStorage.getItem('rg_n') || "",
        pfp: localStorage.getItem('rg_pfp') || "https://ui-avatars.com/api/?name=User",
        cov: localStorage.getItem('rg_cov') || "https://images.unsplash.com/photo-1614850523296-d8c1af93d400?w=500",
        id: Date.now()
    };

    if(!my.n) { 
        let n = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ù„ÙƒÙŠ:"); 
        if(n) { localStorage.setItem('rg_n', n); my.n = n; location.reload(); }
    }

    let currentRoom = "main";
    let replyTo = null;

    function changeRoom(id, el) {
        currentRoom = id;
        document.querySelectorAll('.room-tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        loadMessages();
    }

    function sendMessage() {
        let t = document.getElementById('mInput').value.trim();
        if(!t) return;

        let msgData = {
            u: my.n,
            t: t,
            p: my.pfp,
            time: Date.now(),
            reply: replyTo
        };

        db.ref('rooms/'+currentRoom).push(msgData);
        checkBot(t);
        cancelReply();
        document.getElementById('mInput').value = "";
    }

    function checkBot(t) {
        const brain = {
            "Ù‡Ù„Ùˆ": "Ù‡Ù„Ø§ ÙˆØºÙ„Ø§ Ø¨Ù†ÙˆØ± Ø¹ÙŠÙˆÙ†ÙŠØŒ Ø§Ù†Ø±Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ğŸ‘‘",
            "Ø´Ù„ÙˆÙ†Ùƒ": "Ø¨Ø®ÙŠØ± ÙŠØ§ Ø°Ù‡Ø¨ØŒ Ø£Ù†Øª Ø´Ù„ÙˆÙ†Ùƒ ÙŠØ§ Ø¨Ø·Ù„ØŸ",
            "Ù‡Ù‡Ù‡Ù‡": "Ø¯ÙˆÙ… Ù‡Ø§Ù„Ø¶Ø­ÙƒØ© Ø§Ù„Ø­Ù„ÙˆØ© ÙŠØ§Ø±Ø¨ ğŸ˜‚",
            "Ù…Ù†ÙˆØ±": "Ù†ÙˆØ±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§ÙƒØ³ ÙŠØ§ Ù…Ù„Ùƒ ğŸŒ¹",
            "ÙƒÙÙˆ": "ÙƒÙÙˆ Ù…Ù†Ùƒ ÙˆÙ…Ù† Ø£ØµÙ„Ùƒ Ø§Ù„Ø·ÙŠØ¨ Ø°ÙŠØ¨!"
        };
        for(let key in brain) {
            if(t.includes(key)) {
                setTimeout(() => {
                    db.ref('rooms/'+currentRoom).push({ u: "ğŸ¤– BOT", t: brain[key], bot: true, p: "https://cdn-icons-png.flaticon.com/512/4712/4712035.png" });
                }, 800);
                break;
            }
        }
    }

    function loadMessages() {
        db.ref('rooms/'+currentRoom).off();
        const box = document.getElementById('chat-area');
        box.innerHTML = "";
        db.ref('rooms/'+currentRoom).limitToLast(40).on('child_added', snap => {
            let m = snap.val();
            let isMe = m.u === my.n;
            let div = document.createElement('div');
            div.className = `msg ${isMe ? 'me' : ''}`;
            div.innerHTML = `
                <div class="msg-meta">
                    <img src="${m.p}" style="width:20px; height:20px; border-radius:50%">
                    <b>${m.u}</b>
                    ${isMe ? `<span class="btn-sm" onclick="deleteMsg('${snap.key}')">Ø­Ø°Ù</span>` : `<span class="btn-sm" onclick="setReply('${m.u}', '${m.t}')">Ø§Ù‚ØªØ¨Ø§Ø³</span>`}
                </div>
                <div class="bubble">
                    ${m.reply ? `<div class="quote"><b>${m.reply.u}:</b> ${m.reply.t}</div>` : ''}
                    ${m.t}
                </div>`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
    }

    function deleteMsg(key) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ")) db.ref('rooms/'+currentRoom+'/'+key).remove(); loadMessages(); }

    function setReply(u, t) {
        replyTo = { u, t };
        document.getElementById('reply-user').innerText = u;
        document.getElementById('reply-preview').style.display = 'block';
    }

    function cancelReply() { replyTo = null; document.getElementById('reply-preview').style.display = 'none'; }

    function showMyProfile() {
        document.getElementById('p-name').innerText = my.n;
        document.getElementById('p-img').src = my.pfp;
        document.getElementById('p-cover').style.backgroundImage = `url(${my.cov})`;
        document.getElementById('profile-card').style.display = 'block';
    }

    function editProfile() {
        let nImg = prompt("Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©:");
        let nCov = prompt("Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù:");
        if(nImg) { my.pfp = nImg; localStorage.setItem('rg_pfp', nImg); }
        if(nCov) { my.cov = nCov; localStorage.setItem('rg_cov', nCov); }
        showMyProfile();
    }

    function closeProfile() { document.getElementById('profile-card').style.display = 'none'; }

    // ØªÙˆØ§Ø¬Ø¯ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
    db.ref('online/'+my.n).set(true); db.ref('online/'+my.n).onDisconnect().remove();
    db.ref('online').on('value', snap => { document.getElementById('online-count').innerText = snap.numChildren() + " Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†"; });

    loadMessages();
</script>
</body>
</html>
