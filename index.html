<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ | Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„ÙƒÙŠØ© ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --gold: #ffd700; --bg: #080808; --panel: #121212; --text: #e0e0e0; --user-color: #ffffff; }
        * { box-sizing: border-box; transition: 0.3s; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif; height: 100vh; overflow: hidden; }

        /* Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
        .top-bar { height: 60px; background: var(--panel); border-bottom: 2px solid var(--gold); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 1000; }
        .main-content { display: flex; height: calc(100vh - 60px); flex-direction: row; }
        
        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (ÙŠÙ…ÙŠÙ† ÙˆÙŠØ³Ø§Ø±) */
        .side { width: 0; background: var(--panel); overflow-y: auto; overflow-x: hidden; position: relative; z-index: 500; }
        .side.open { width: 280px; border-left: 1px solid #333; border-right: 1px solid #333; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø§Øª */
        .chat-area { flex: 1; display: flex; flex-direction: column; background: #000; }
        #messages-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }

        /* Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠØ³Ø±Ù‰ */
        .settings-section { padding: 15px; }
        .settings-section h4 { color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 5px; }
        .control-group { margin-bottom: 20px; }
        .control-group label { display: block; font-size: 13px; margin-bottom: 8px; }
        select, input[type="color"] { width: 100%; padding: 8px; background: #222; border: 1px solid #444; color: white; border-radius: 5px; }

        /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .rainbow-text { background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: rainbow 3s linear infinite; font-weight: bold; }
        @keyframes rainbow { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }

        /* Ø§Ù„ÙÙˆØªØ± */
        .footer { padding: 15px; background: var(--panel); display: flex; gap: 10px; align-items: center; }
        #input-box { flex: 1; background: #222; border: none; padding: 12px 20px; border-radius: 25px; color: white; outline: none; }
        .btn-icon { background: none; border: none; color: var(--gold); cursor: pointer; font-size: 24px; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #login-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .login-card { background: var(--panel); padding: 30px; border: 2px solid var(--gold); border-radius: 20px; text-align: center; }
    </style>
</head>
<body id="main-body">

<div id="login-screen">
    <div class="login-card">
        <h2 style="color:var(--gold)">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©</h2>
        <input type="text" id="login-name" placeholder="Ø§Ø³Ù…Ùƒ" style="padding:10px; margin:10px; width:80%"><br>
        <button onclick="enterChat()" style="background:var(--gold); padding:10px 20px; border:none; border-radius:10px; cursor:pointer">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div class="top-bar">
    <button class="btn-icon" onclick="toggleSide('left')">âš™ï¸</button>
    <div style="color:var(--gold); font-weight:bold;">CH-ALLOSH SUPREME</div>
    <button class="btn-icon" onclick="toggleSide('right')">ğŸ‘¥</button>
</div>

<div class="main-content">
    <div id="side-left" class="side">
        <div class="settings-section">
            <h4>ğŸ› ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©</h4>
            
            <div class="control-group">
                <label>ğŸ¨ Ø«ÙŠÙ…Ø§Øª Ø§Ù„Ø´Ø§Øª</label>
                <select onchange="changeTheme(this.value)">
                    <option value="dark">Ù„ÙŠÙ„ÙŠ Ù…Ù„ÙƒÙŠ</option>
                    <option value="gold">Ø°Ù‡Ø¨ÙŠ ÙØ®Ù…</option>
                    <option value="blue">Ø£Ø²Ø±Ù‚ Ù‡Ø§Ø¯Ø¦</option>
                </select>
            </div>

            <div class="control-group">
                <label>ğŸ–‹ï¸ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·</label>
                <select onchange="changeFont(this.value)">
                    <option value="'Cairo', sans-serif">Ø®Ø· ÙƒØ§ÙŠØ±Ùˆ</option>
                    <option value="'Tajawal', sans-serif">Ø®Ø· ØªØ¬ÙˆÙ„</option>
                    <option value="Arial">Ø®Ø· Ø¨Ø³ÙŠØ·</option>
                </select>
            </div>

            <div class="control-group">
                <label>ğŸŒˆ Ù„ÙˆÙ† Ø§Ø³Ù…Ùƒ (Ø«Ø§Ø¨Øª Ø£Ùˆ Ù…ØªØ­Ø±Ùƒ)</label>
                <input type="color" id="color-picker" onchange="setUserColor(this.value)">
                <button onclick="setAnimatedColor()" class="btn-action" style="margin-top:10px; width:100%; background:linear-gradient(to right, red, blue); color:white; border:none; border-radius:5px; padding:5px; cursor:pointer">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…ØªØ­Ø±Ùƒ</button>
            </div>
        </div>
    </div>

    <div class="chat-area">
        <div id="messages-container"></div>
        <div class="footer">
            <button class="btn-icon" onclick="triggerMedia()">â•</button>
            <input type="text" id="input-box" placeholder="Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ø§Ù‹..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button class="btn-icon" onclick="sendMessage()">ğŸš€</button>
        </div>
    </div>

    <div id="side-right" class="side">
        <div style="padding: 15px;">
            <h4 style="color:var(--gold)">ğŸ‘¥ Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ†</h4>
            <div id="users-list"></div>
        </div>
    </div>
</div>

<script>
    // ØªÙ‡ÙŠØ¦Ø© Firebase (Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§)
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let user = { name: "", role: "Ø¹Ø¶Ùˆ", color: "#ffffff", isAnimated: false };

    function enterChat() {
        let n = document.getElementById('login-name').value;
        if(!n) return;
        user.name = n;
        document.getElementById('login-screen').style.display = 'none';
        initApp();
    }

    function toggleSide(s) { document.getElementById('side-'+s).classList.toggle('open'); }

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ®ØµÙŠØµ
    function changeTheme(theme) {
        if(theme === 'gold') document.body.style.setProperty('--bg', '#1a1600');
        else if(theme === 'blue') document.body.style.setProperty('--bg', '#000b1a');
        else document.body.style.setProperty('--bg', '#080808');
    }

    function changeFont(font) { document.body.style.fontFamily = font; }

    function setUserColor(c) { user.color = c; user.isAnimated = false; }
    function setAnimatedColor() { user.isAnimated = true; }

    function initApp() {
        db.ref('online_v4/' + user.name).set(user);
        db.ref('online_v4/' + user.name).onDisconnect().remove();

        db.ref('online_v4').on('value', s => {
            let h = "";
            s.forEach(u => { h += `<div style="color:${u.val().color}">${u.val().name}</div>`; });
            document.getElementById('users-list').innerHTML = h;
        });

        db.ref('msgs_v4').limitToLast(50).on('child_added', s => {
            let d = s.val();
            let area = document.getElementById('messages-container');
            let div = document.createElement('div');
            let nameClass = d.isAnimated ? "rainbow-text" : "";
            
            let content = d.text;
            if(content.includes('youtube.com/watch?v=')) {
                let id = content.split('v=')[1].split('&')[0];
                content = `<iframe src="https://www.youtube.com/embed/${id}" frameborder="0" style="width:100%; height:200px; border-radius:10px;"></iframe>`;
            } else if(content.startsWith("DATA_IMG:")) {
                content = `<img src="${content.replace('DATA_IMG:','')}" style="max-width:100%; border-radius:10px; border:1px solid var(--gold);">`;
            }

            div.innerHTML = `<b class="${nameClass}" style="color:${d.color}">${d.sender}:</b> <div>${content}</div>`;
            area.appendChild(div);
            area.scrollTop = area.scrollHeight;
        });
    }

    function sendMessage() {
        let box = document.getElementById('input-box');
        if(!box.value) return;
        db.ref('msgs_v4').push({ sender: user.name, text: box.value, color: user.color, isAnimated: user.isAnimated });
        box.value = "";
    }

    function triggerMedia() {
        let p = document.createElement('input');
        p.type = 'file'; p.accept = 'image/*';
        p.onchange = e => {
            let f = e.target.files[0];
            let r = new FileReader();
            r.onload = ev => { db.ref('msgs_v4').push({ sender: user.name, text: "DATA_IMG:" + ev.target.result, color: user.color, isAnimated: user.isAnimated }); };
            r.readAsDataURL(f);
        };
        p.click();
    }
</script>
</body>
</html>
