<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„Ø³Ù…Ø§ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    
    <style>
        :root { --main: #ffd700; --bg: #000; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        #master-layout { display: flex; flex: 1; gap: 10px; padding: 10px; overflow: hidden; }
        .panel { background: #0a0a0a; border: 2px solid #222; border-radius: 15px; display: flex; flex-direction: column; position: relative; }
        .drag-handle { background: #111; padding: 8px; cursor: move; text-align: center; font-size: 11px; color: var(--main); border-radius: 13px 13px 0 0; font-weight: bold; }

        #sidebar { width: 220px; flex-shrink: 0; }
        #chat-area { flex-grow: 1; }

        /* Ø§Ù„Ø³Ù…Ø§ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .emoji-bar { display: flex; gap: 10px; padding: 8px; background: #111; border-top: 1px solid #333; overflow-x: auto; }
        .emoji-item { font-size: 24px; cursor: pointer; transition: 0.3s; animation: bounce 2s infinite; }
        .emoji-item:hover { transform: scale(1.3); }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* Ø§Ù„Ø´Ø§Øª */
        #chat-window { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #050505; }
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 80%; border: 1px solid #222; }
        .msg.me { align-self: flex-end; background: #1a1a1a; border-right: 4px solid var(--main); }
        .msg.bot { align-self: center; border: 1px solid #00f2ff; color: #00f2ff; text-align: center; width: 90%; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-bar { padding: 10px; background: #0a0a0a; display: flex; gap: 8px; border-top: 1px solid #222; align-items: center; }
        input[type="text"] { flex: 1; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 25px; outline: none; }
        
        .btn-action { border: none; padding: 10px; border-radius: 50%; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .refresh-btn { background: #333; color: #fff; width: 40px; height: 40px; }
        .refresh-btn:hover { background: #555; transform: rotate(180deg); }
        .send-btn { background: var(--main); color: #000; padding: 10px 20px; border-radius: 25px; }

        /* Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª */
        .mics-row { display: flex; gap: 5px; padding: 10px; background: #0f0f0f; border-bottom: 1px solid #222; }
        .mic-slot { flex: 1; background: #1a1a1a; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 1px dashed #444; }
    </style>
</head>
<body>

    <div id="master-layout">
        <div id="sidebar" class="panel">
            <div class="drag-handle">âœ¥ Ø§Ù„Ù…Ù„ÙˆÙƒ âœ¥</div>
            <div id="online-list" style="padding: 10px;"></div>
        </div>

        <div id="chat-area" class="panel">
            <div class="drag-handle">âœ¥ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ âœ¥</div>
            
            <div class="mics-row">
                <div class="mic-slot" id="s1">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(1)">ØµØ¹ÙˆØ¯</button></div>
                <div class="mic-slot" id="s2">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(2)">ØµØ¹ÙˆØ¯</button></div>
                <div class="mic-slot" id="s3">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(3)">ØµØ¹ÙˆØ¯</button></div>
                <div class="mic-slot" id="s4">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(4)">ØµØ¹ÙˆØ¯</button></div>
            </div>

            <div id="chat-window"></div>

            <div class="emoji-bar">
                <span class="emoji-item" onclick="addEmoji('ğŸ”¥')">ğŸ”¥</span>
                <span class="emoji-item" onclick="addEmoji('ğŸ‘‘')">ğŸ‘‘</span>
                <span class="emoji-item" onclick="addEmoji('ğŸ˜‚')">ğŸ˜‚</span>
                <span class="emoji-item" onclick="addEmoji('âœ¨')">âœ¨</span>
                <span class="emoji-item" onclick="addEmoji('ğŸ’')">ğŸ’</span>
                <span class="emoji-item" onclick="addEmoji('ğŸš€')">ğŸš€</span>
                <span class="emoji-item" onclick="addEmoji('ğŸ’¯')">ğŸ’¯</span>
                <span class="emoji-item" onclick="addEmoji('ğŸ¤')">ğŸ¤</span>
            </div>

            <div class="input-bar">
                <button class="btn-action refresh-btn" onclick="location.reload()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù…Ù„ÙƒØ©">ğŸ”„</button>
                <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø« ÙŠØ§ Ù…Ù„Ùƒ...">
                <button class="btn-action send-btn" onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
    </div>

<script>
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    const auth = firebase.auth();
    let myName = "";

    new Sortable(document.getElementById('master-layout'), { handle: '.drag-handle', animation: 200 });

    auth.onAuthStateChanged(user => {
        if (user) {
            myName = user.email === "rgrghh77@gmail.com" ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('status/' + user.uid).set({ n: myIdentity = myName });
            db.ref('status/' + user.uid).onDisconnect().remove();
            loadChat(); loadUsers(); syncMics();
        } else { window.location.href = "index.html"; }
    });

    function addEmoji(emoji) {
        document.getElementById('mInp').value += emoji;
        document.getElementById('mInp').focus();
    }

    function sendMsg() {
        const i = document.getElementById('mInp');
        if(!i.value.trim()) return;
        db.ref('msgs').push({ u: myName, t: i.value, m: myName.includes("ğŸ‘‘") });
        if(i.value.includes("ğŸ˜‚")) {
            setTimeout(() => db.ref('msgs').push({ u: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–", t: "Ø¯ÙˆÙ… Ø§Ù„Ø¶Ø­ÙƒØ© ÙŠØ§ Ù…Ù„Ùƒ! ğŸ˜‚", type: 'bot' }), 1000);
        }
        i.value = '';
    }

    function loadChat() {
        db.ref('msgs').limitToLast(30).on('child_added', snap => {
            const d = snap.val();
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.className = `msg ${d.type === 'bot' ? 'bot' : (d.m ? 'me' : 'other')}`;
            div.innerHTML = `<small style="color:var(--main);">${d.u}</small><br>${d.t}`;
            win.appendChild(div);
            win.scrollTop = win.scrollHeight;
        });
    }

    function loadUsers() {
        db.ref('status').on('value', snap => {
            const list = document.getElementById('online-list');
            list.innerHTML = `<div style="color:#00f2ff; font-weight:bold; margin-bottom:10px;">ğŸ¤– Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ©</div>`;
            snap.forEach(u => {
                list.innerHTML += `<div style="font-size:12px; margin-bottom:5px;">ğŸŸ¢ ${u.val().n}</div>`;
            });
        });
    }

    function joinMic(n) {
        const ref = db.ref('mics/s' + n);
        ref.once('value', s => {
            if(s.val() && s.val().n === myName) ref.remove();
            else if(!s.val()) ref.set({ n: myName });
        });
    }

    function syncMics() {
        for(let i=1; i<=4; i++) {
            db.ref('mics/s' + i).on('value', s => {
                const el = document.getElementById('s' + i);
                if(s.val()) el.innerHTML = `ğŸ¤ ${s.val().n} <button onclick="joinMic(${i})" style="font-size:8px;">X</button>`;
                else el.innerHTML = `ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(${i})" style="font-size:8px;">ØµØ¹ÙˆØ¯</button>`;
            });
        }
    }
</script>
</body>
</html>
