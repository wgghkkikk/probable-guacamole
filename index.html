// 1. ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„ØªØ´Ù…Ù„ Ø£Ù…Ø± "Ù…Ø·Ø± Ø§Ù„Ù†Ø§Ø±" Ù„Ù„ÙƒÙ„
function send() {
    const inp = document.getElementById('msg-in');
    const name = document.getElementById('my-name').value;
    if(inp.value.trim()) {
        const msgId = db.ref("messages").push().key;
        db.ref("messages/" + msgId).set({ 
            u: name, 
            t: inp.value, 
            s: {c: myS.c, a: myS.a}, 
            type: 'text', 
            time: new Date().toLocaleTimeString(),
            effect: "fire_rain" // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ£Ø«ÙŠØ± Ù„Ù„Ø±Ø³Ø§Ù„Ø©
        });
        inp.value = "";
    }
}

// 2. ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø·Ø± Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©
db.ref("messages").limitToLast(1).on("child_added", (snap) => {
    const d = snap.val();
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø§Ø±ØŒ ÙŠØ´ØªØºÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙƒÙ„ ÙÙˆØ±Ø§Ù‹
    if(d.effect === "fire_rain") {
        makeItRain(); 
    }
    // Ø¨Ù‚ÙŠØ© ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¹ØªØ§Ø¯ Ù‡Ù†Ø§...
});

// 3. ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª Ù„ØªØ¹Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
function initKingdom() {
    const name = document.getElementById('my-name').value;
    db.ref("activity_log").push().set({ user: name, time: new Date().toLocaleString('ar-EG') });
    
    const eList = document.getElementById('emoji-list');
    eList.innerHTML = ""; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø³Ø±Ø¹Ø©

    // Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ù‚Ù…Ø© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
    const fireStickers = ["ðŸ‘‘", "ðŸ”¥", "ðŸ’Ž", "âœ¨", "ðŸŒŸ", "ðŸš€", "âš”ï¸", "ðŸ›¡ï¸"];
    fireStickers.forEach(stk => {
        let s = document.createElement('span');
        s.className = 'emoji-item';
        s.style.fontSize = "40px"; 
        s.style.animation = "pulse 1.5s infinite"; // Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ø¨Ø¶
        s.style.filter = "drop-shadow(0 0 8px gold)"; 
        s.innerText = stk;
        s.onclick = () => { document.getElementById('msg-in').value += stk; };
        eList.appendChild(s);
    });

    // Ø¥Ø¶Ø§ÙØ© Ø¢Ù„Ø§Ù Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
    const ranges = [[0x1F600, 0x1F64F], [0x1F300, 0x1F5FF], [0x1F680, 0x1F6FF], [0x1F900, 0x1F9FF], [0x1F1E6, 0x1F1FF]];
    ranges.forEach(range => {
        for (let i = range[0]; i <= range[1]; i++) {
            let s = document.createElement('span');
            s.className = 'emoji-item';
            s.innerText = String.fromCodePoint(i);
            s.onclick = () => { document.getElementById('msg-in').value += s.innerText; };
            eList.appendChild(s);
        }
    });
}
