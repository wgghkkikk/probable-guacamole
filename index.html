<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·Ù„Ù‚ ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; --side-w: 220px; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; transition: 0.3s; }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #sidebar { width: var(--side-w); background: #0a0a0a; border-left: 1px solid var(--main); padding: 15px; box-sizing: border-box; flex-shrink: 0; transition: 0.4s; order: 1; }
        .main-chat { flex-grow: 1; display: flex; flex-direction: column; order: 2; transition: 0.3s; }

        /* Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± (Ù…Ø®ÙÙŠØ©) */
        #master-admin { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 500px; background: rgba(10,10,10,0.95); border: 2px solid var(--main); border-radius: 20px; padding: 20px; z-index: 1000; display: none; box-shadow: 0 0 50px var(--main); }
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .admin-btn { background: var(--main); color: #000; border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 12px; }

        /* Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥Ø®ÙØ§Ø¡ */
        #mic-section { display: flex; background: #111; padding: 5px; gap: 5px; border-bottom: 1px solid #222; }
        .slot { flex: 1; background: #1a1a1a; height: 45px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 1px dashed #444; }
        
        #yt-section { background: #111; padding: 10px; border-bottom: 1px solid var(--main); }
        #live-display { display: none; height: 200px; background: #000; border-bottom: 2px solid var(--main); }

        #chat-box { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 12px; max-width: 80%; border: 1px solid #222; }
        .msg.me { align-self: flex-end; border-right: 3px solid var(--main); background: #1a1a1a; }
        
        .input-bar { padding: 10px; background: #0a0a0a; display: flex; gap: 10px; border-top: 1px solid #222; }
        input[type="text"] { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #333; background: #000; color: #fff; outline: none; }
        
        #open-admin { position: fixed; bottom: 80px; left: 10px; background: var(--main); color: #000; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; z-index: 999; display: none; }
    </style>
</head>
<body>

    <button id="open-admin" onclick="toggleAdmin()">âš™ï¸</button>

    <div id="master-admin">
        <h3 style="text-align:center; color:var(--main);">ğŸ› ï¸ ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±</h3>
        <div class="admin-grid">
            <button class="admin-btn" onclick="moveSidebar('left')">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙŠØ³Ø§Ø± â¬…ï¸</button>
            <button class="admin-btn" onclick="moveSidebar('right')">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙŠÙ…ÙŠÙ† â¡ï¸</button>
            <button class="admin-btn" onclick="toggleVisibility('sidebar')">Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ‘¤</button>
            <button class="admin-btn" onclick="toggleVisibility('yt-section')">Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ ğŸ“º</button>
            <button class="admin-btn" onclick="toggleVisibility('mic-section')">Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª ğŸ¤</button>
            <button class="admin-btn" onclick="clearMessages()" style="background:red; color:white;">ØªØµÙÙŠØ± Ø§Ù„Ø´Ø§Øª ğŸ§¨</button>
        </div>
        <button class="admin-btn" style="width:100%; margin-top:15px; background:#fff;" onclick="toggleAdmin()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div id="sidebar">
        <h4 style="text-align:center; color:var(--main);">Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†</h4>
        <div id="user-list"></div>
    </div>

    <div class="main-chat">
        <div id="mic-section">
            <div class="slot" id="s1">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(1)">ØµØ¹ÙˆØ¯</button></div>
            <div class="slot" id="s2">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(2)">ØµØ¹ÙˆØ¯</button></div>
            <div class="slot" id="s3">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(3)">ØµØ¹ÙˆØ¯</button></div>
            <div class="slot" id="s4">ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(4)">ØµØ¹ÙˆØ¯</button></div>
        </div>

        <div id="yt-section">
            <div style="display:flex; gap:5px;">
                <input type="text" id="yt-inp" placeholder="Ø¨Ø­Ø« ÙŠÙˆØªÙŠÙˆØ¨ Ù…Ù„ÙƒÙŠ...">
                <button onclick="searchYT()" style="background:var(--main); border:none; padding:5px; border-radius:5px; cursor:pointer;">ğŸ”</button>
            </div>
            <div id="yt-results" style="display:flex; overflow-x:auto; gap:10px; margin-top:5px;"></div>
        </div>

        <div id="live-display"></div>

        <div id="chat-box"></div>

        <div class="input-bar">
            <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø« ÙŠØ§ Ù…Ù„Ùƒ...">
            <button onclick="send()" style="background:var(--main); border:none; padding:8px 15px; border-radius:20px; font-weight:bold; cursor:pointer;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

<script>
    const YT_KEY = "AIzaSyC4wFkLrA_BlNzreseXQLeSp_40Gbmu9VU"; 
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const db = firebase.database();
    const auth = firebase.auth();
    let myName = "";

    auth.onAuthStateChanged(user => {
        if (user) {
            const isMe = user.email === "rgrghh77@gmail.com";
            if(isMe) document.getElementById('open-admin').style.display = 'block';
            myName = isMe ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('status/' + user.uid).set({ n: myName });
            db.ref('status/' + user.uid).onDisconnect().remove();
            loadChat(); loadUsers(); syncMics(); watchYT();
        } else { window.location.href = "index.html"; }
    });

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù„ÙƒÙŠØ© ---
    function toggleAdmin() {
        const ad = document.getElementById('master-admin');
        ad.style.display = ad.style.display === 'block' ? 'none' : 'block';
    }

    function moveSidebar(dir) {
        const side = document.getElementById('sidebar');
        const chat = document.querySelector('.main-chat');
        if(dir === 'left') { side.style.order = "2"; chat.style.order = "1"; side.style.borderLeft = "none"; side.style.borderRight = "1px solid var(--main)"; }
        else { side.style.order = "1"; chat.style.order = "2"; side.style.borderRight = "none"; side.style.borderLeft = "1px solid var(--main)"; }
    }

    function toggleVisibility(id) {
        const el = document.getElementById(id);
        el.style.display = el.style.display === 'none' ? (id==='mic-section'?'flex':'block') : 'none';
    }

    function clearMessages() { if(confirm("ØªØµÙÙŠØ± Ø§Ù„Ù…Ù…Ù„ÙƒØ©ØŸ")) db.ref('msgs').remove(); }

    // --- ÙŠÙˆØªÙŠÙˆØ¨ ---
    async function searchYT() {
        const q = document.getElementById('yt-inp').value;
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${q}&type=video&maxResults=5&key=${YT_KEY}`);
        const data = await res.json();
        const resDiv = document.getElementById('yt-results');
        resDiv.innerHTML = '';
        data.items.forEach(v => {
            resDiv.innerHTML += `<div onclick="playVideo('${v.id.videoId}')" style="cursor:pointer; min-width:80px;"><img src="${v.snippet.thumbnails.default.url}" width="80"><p style="font-size:8px;">${v.snippet.title.substring(0,10)}</p></div>`;
        });
    }

    function playVideo(id) { db.ref('live').set({ id: id, active: true }); }
    function watchYT() {
        db.ref('live').on('value', snap => {
            const v = snap.val();
            const disp = document.getElementById('live-display');
            if(v && v.active) { disp.style.display = 'block'; disp.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${v.id}?autoplay=1" frameborder="0" allowfullscreen></iframe>`; }
            else { disp.style.display = 'none'; }
        });
    }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª ÙˆØ§Ù„Ø´Ø§Øª ---
    function joinMic(n) {
        const ref = db.ref('mics/s' + n);
        ref.once('value', s => { if(s.val() && s.val().n === myName) ref.remove(); else if(!s.val()) ref.set({ n: myName }); });
    }

    function syncMics() {
        for(let i=1; i<=4; i++) {
            db.ref('mics/s' + i).on('value', s => {
                const el = document.getElementById('s' + i);
                if(s.val()) el.innerHTML = `ğŸ¤ ${s.val().n} <button onclick="joinMic(${i})" style="font-size:8px;">Ù†Ø²ÙˆÙ„</button>`;
                else el.innerHTML = `ğŸ™ï¸ Ø®Ø§Ù„ÙŠ <button onclick="joinMic(${i})" style="font-size:8px;">ØµØ¹ÙˆØ¯</button>`;
            });
        }
    }

    function send() {
        const i = document.getElementById('mInp');
        if(!i.value.trim()) return;
        db.ref('msgs').push({ u: myName, t: i.value, m: auth.currentUser.email === "rgrghh77@gmail.com" });
        i.value = '';
    }

    function loadChat() {
        db.ref('msgs').limitToLast(30).on('child_added', snap => {
            const d = snap.val();
            const div = document.createElement('div');
            div.className = `msg ${d.m ? 'me' : 'other'}`;
            div.innerHTML = `<b style="font-size:10px; color:var(--main)">${d.u}</b><br>${d.t}`;
            document.getElementById('chat-box').appendChild(div);
            document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
        });
        db.ref('msgs').on('child_removed', () => location.reload());
    }

    function loadUsers() {
        db.ref('status').on('value', snap => {
            const list = document.getElementById('user-list');
            list.innerHTML = '';
            snap.forEach(c => { list.innerHTML += `<div style="padding:5px; border-bottom:1px solid #111; font-size:12px;">ğŸŸ¢ ${c.val().n}</div>`; });
        });
    }
</script>
</body>
</html>
