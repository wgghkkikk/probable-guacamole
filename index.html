<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Ù…Ù„ ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; --dark: #111; --bubble: #1a1a1a; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; overflow: hidden; display: flex; }

        /* Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ (ÙŠÙ…ÙŠÙ† ÙˆÙŠØ³Ø§Ø±) */
        .side { width: 280px; height: 100vh; background: var(--dark); position: fixed; transition: 0.4s; z-index: 2000; border-left: 2px solid var(--main); }
        #side-right { right: -285px; }
        #side-left { left: -285px; border-right: 2px solid var(--main); border-left: none; }
        .side.open { right: 0 !important; left: 0 !important; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        #main-view { flex: 1; height: 100vh; display: flex; flex-direction: column; position: relative; width: 100%; transition: 0.3s; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª ÙˆØ§Ù„ØºØ±Ù */
        .top-bar { background: #0a0a0a; border-bottom: 1px solid #333; padding: 10px; }
        .rooms-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; border-bottom: 1px solid #222; }
        .room-btn { background: #222; border: 1px solid #444; color: #fff; padding: 5px 15px; border-radius: 15px; cursor: pointer; white-space: nowrap; font-size: 12px; }
        .room-btn.active { background: var(--main); color: #000; font-weight: bold; }

        /* Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª */
        .mics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 10px; }
        .mic-box { background: #151515; border: 1px dashed #444; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #888; cursor: pointer; }
        .mic-box.active { border-style: solid; border-color: var(--main); color: var(--main); box-shadow: 0 0 10px var(--main); }

        /* Ø§Ù„Ø´Ø§Øª ÙˆØ§Ù„ÙÙ‚Ø§Ø¹Ø§Øª */
        #chat-window { flex: 1; overflow-y: auto; padding: 15px; background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png'); }
        .msg-row { display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end; }
        .msg-row.me { flex-direction: row-reverse; }
        .u-avatar { width: 42px; height: 42px; border-radius: 10px; border: 1px solid var(--main); object-fit: cover; cursor: pointer; }
        .bubble-wrap { max-width: 75%; }
        .u-name { font-size: 11px; color: var(--main); font-weight: bold; margin: 0 5px 3px; display: block; }
        .bubble { background: var(--bubble); padding: 10px 15px; border-radius: 15px; border: 1px solid #333; line-height: 1.5; font-size: 14px; position: relative; }
        .me .bubble { border-color: var(--main); background: #221a00; }

        /* Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ø§Ù„Ø¹Ø§Ø¦Ù… */
        #yt-float { position: absolute; top: 130px; left: 15px; width: 170px; height: 110px; background: #000; border: 2px solid var(--main); z-index: 1000; border-radius: 12px; display: none; overflow: hidden; }
        .yt-ctrl { background: rgba(0,0,0,0.85); display: flex; justify-content: space-around; font-size: 10px; padding: 4px; color: var(--main); }

        /* Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù…Ù†Ø¨Ø«Ù‚ */
        #user-card { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 320px; background: #161616; border: 2px solid var(--main); border-radius: 20px; display: none; z-index: 3000; overflow: hidden; box-shadow: 0 0 40px #000; }
        .card-cover { height: 110px; background: #222; background-size: cover; }
        .card-av { width: 90px; height: 90px; border-radius: 50%; border: 4px solid var(--main); margin: -45px auto 0; display: block; background: #000; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        #emoji-shelf { height: 200px; background: #0a0a0a; border-top: 2px solid var(--main); display: none; grid-template-columns: repeat(8, 1fr); gap: 10px; padding: 10px; overflow-y: auto; }
        .input-bar { padding: 12px; background: #000; display: flex; gap: 8px; align-items: center; border-top: 1px solid #333; }
        input[type="text"] { flex: 1; background: #151515; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 8px; outline: none; }
        .icon-btn { color: var(--main); font-size: 24px; cursor: pointer; border: none; background: none; }
    </style>
</head>
<body onclick="closeAll()">

    <div id="user-card" onclick="event.stopPropagation()">
        <div class="card-cover" id="c-cover"></div>
        <img src="" class="card-av" id="c-av">
        <div style="text-align:center; padding:20px;">
            <h2 id="c-name" style="margin:5px 0; color:var(--main);">ØªØ­Ù…ÙŠÙ„...</h2>
            <p id="c-bio" style="font-size:13px; color:#888;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ù…Ù„ÙƒØªÙŠ</p>
            <div style="display:flex; justify-content:center; gap:10px; margin-top:15px;">
                <button onclick="alert('Ø®Ø§Øµ')" style="background:#222; border:1px solid var(--main); color:#fff; padding:5px 15px; border-radius:10px;">ğŸ’¬ Ø®Ø§Øµ</button>
                <button onclick="document.getElementById('user-card').style.display='none'" style="background:var(--main); border:none; color:#000; padding:5px 15px; border-radius:10px; font-weight:bold;">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <div id="side-right" class="side" onclick="event.stopPropagation()">
        <div style="padding:15px; text-align:center; color:var(--main); font-weight:bold; border-bottom:1px solid #333;">ğŸ‘¥ Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† Ø§Ù„Ø¢Ù†</div>
        <div id="user-list" style="padding:10px;"></div>
    </div>

    <div id="side-left" class="side" onclick="event.stopPropagation()">
        <div style="padding:20px; text-align:center;">
            <div style="color:var(--main); font-weight:bold; margin-bottom:20px;">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</div>
            <button class="icon-btn" style="font-size:16px;" onclick="editMyProfile()">ğŸ‘¤ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„ÙÙŠ</button><br><br>
            <button class="icon-btn" style="font-size:16px;" onclick="askYT()">ğŸ“º ÙŠÙˆØªÙŠÙˆØ¨</button><br><br>
            <button class="icon-btn" style="font-size:16px; color:red;" onclick="db.ref('msgs').remove()">ğŸ§¨ ØªØµÙÙŠØ± Ø§Ù„ØºØ±ÙØ©</button>
        </div>
    </div>

    <div id="main-view">
        <div class="top-bar">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <button class="icon-btn" onclick="openS('left', event)">â˜°</button>
                <b style="color:var(--main); font-size:20px;">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</b>
                <button class="icon-btn" onclick="openS('right', event)">ğŸ‘¥</button>
            </div>
            
            <div class="rooms-row">
                <div class="room-btn active" onclick="switchRoom('main')">ğŸ° Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                <div class="room-btn" onclick="switchRoom('music')">ğŸµ Ø£ØºØ§Ù†ÙŠ ÙˆØ´Ø¹Ø±</div>
                <div class="room-btn" onclick="switchRoom('private')">ğŸ”¥ ØºØ±ÙØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div>
            </div>

            <div class="mics-grid">
                <div class="mic-box" id="mic1" onclick="joinMic(1)">ğŸ™ï¸ Ù…ØªØ§Ø­</div>
                <div class="mic-box" id="mic2" onclick="joinMic(2)">ğŸ™ï¸ Ù…ØªØ§Ø­</div>
                <div class="mic-box" id="mic3" onclick="joinMic(3)">ğŸ™ï¸ Ù…ØªØ§Ø­</div>
                <div class="mic-box" id="mic4" onclick="joinMic(4)">ğŸ™ï¸ Ù…ØªØ§Ø­</div>
            </div>
        </div>

        <div id="yt-float" onclick="event.stopPropagation()">
            <div class="yt-ctrl">
                <span onclick="setYT(false)">ğŸ”‡ ØµÙˆØª</span>
                <span onclick="setYT(true)">ğŸ“º ÙÙŠØ¯ÙŠÙˆ</span>
                <span onclick="document.getElementById('yt-float').style.display='none'">âœ–</span>
            </div>
            <div id="yt-frame" style="width:100%; height:100%;"></div>
        </div>

        <div id="chat-window" onclick="closeAll()"></div>

        <div id="emoji-shelf" onclick="event.stopPropagation()"></div>

        <div class="input-bar" onclick="event.stopPropagation()">
            <button class="icon-btn" onclick="toggleEmoji(event)">ğŸ˜Š</button>
            <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø« ÙŠØ§ Ù…Ù„Ùƒ Ø§Ù„Ù…Ù„ÙˆÙƒ...">
            <button class="icon-btn" onclick="send()">ğŸš€</button>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let myID, myData = {}, currentRoom = 'main';

    auth.onAuthStateChanged(u => {
        if(u) {
            myID = u.uid;
            db.ref('users/'+myID).on('value', s => {
                myData = s.val() || { n: u.email.split('@')[0], av: "https://via.placeholder.com/100", cv: "https://via.placeholder.com/400x150", st: "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø§Ù„Ù…Ù…Ù„ÙƒØ©" };
                db.ref('status/'+myID).set({ n: myData.n, av: myData.av });
            });
            initSystem();
        }
    });

    function openS(d, e) { e.stopPropagation(); document.getElementById('side-'+d).classList.add('open'); }
    function closeAll() {
        document.getElementById('side-right').classList.remove('open');
        document.getElementById('side-left').classList.remove('open');
        document.getElementById('emoji-shelf').style.display = 'none';
        document.getElementById('user-card').style.display = 'none';
    }

    function switchRoom(room) {
        currentRoom = room;
        document.getElementById('chat-window').innerHTML = `<div style="text-align:center; color:var(--main); padding:20px;">Ø§Ù†ØªÙ‚Ù„Øª Ø¥Ù„Ù‰ ${room}...</div>`;
        document.querySelectorAll('.room-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Firebase Ù„ÙØµÙ„ ØºØ±Ù Ø§Ù„Ø´Ø§Øª
    }

    function editMyProfile() {
        const n = prompt("Ø§Ø³Ù…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯:", myData.n);
        const av = prompt("Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©:", myData.av);
        const cv = prompt("Ø±Ø§Ø¨Ø· ØºÙ„Ø§Ù Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„:", myData.cv);
        const st = prompt("Ø­Ø§Ù„ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©:", myData.st);
        db.ref('users/'+myID).update({ n: n||myData.n, av: av||myData.av, cv: cv||myData.cv, st: st||myData.st });
    }

    function send() {
        const t = document.getElementById('mInp').value;
        if(!t) return;
        db.ref('msgs/'+currentRoom).push({ uid: myID, n: myData.n, av: myData.av, t: t });
        document.getElementById('mInp').value = '';
    }

    function showUser(uid) {
        event.stopPropagation();
        db.ref('users/'+uid).once('value', s => {
            const d = s.val();
            if(d) {
                document.getElementById('c-name').innerText = d.n;
                document.getElementById('c-av').src = d.av;
                document.getElementById('c-cover').style.backgroundImage = `url('${d.cv}')`;
                document.getElementById('c-bio').innerText = d.st;
                document.getElementById('user-card').style.display = 'block';
            }
        });
    }

    function initSystem() {
        // Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        db.ref('msgs/'+currentRoom).limitToLast(40).on('child_added', s => {
            const d = s.val();
            const isMe = d.uid === myID;
            const div = document.createElement('div');
            div.className = `msg-row ${isMe ? 'me' : ''}`;
            div.innerHTML = `<img src="${d.av}" class="u-avatar" onclick="showUser('${d.uid}')">
                <div class="bubble-wrap"><span class="u-name">${d.n}</span><div class="bubble">${d.t}</div></div>`;
            document.getElementById('chat-window').appendChild(div);
            document.getElementById('chat-window').scrollTop = document.getElementById('chat-window').scrollHeight;
        });

        // Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª Ø¶Ø®Ù…Ø©
        const ems = ['ğŸ˜‚','ğŸ”¥','ğŸ‘‘','âœ¨','ğŸ’¯','ğŸ’','ğŸŒ¹','ğŸ’™','ğŸš€','ğŸ§¿','ğŸ‡®ğŸ‡¶','ğŸ¤','â¤ï¸','ğŸ‘Œ','ğŸ˜','ğŸ¤”','âš¡','ğŸ‰','ğŸ’ª','ğŸ¤«','ğŸ‘¸','ğŸ¤©','ğŸ¦','ğŸ·','ğŸ§¨','ğŸ§¿','ğŸ”¥','ğŸ’'];
        ems.forEach(e => { document.getElementById('emoji-shelf').innerHTML += `<span style="font-size:30px; cursor:pointer; text-align:center;" onclick="document.getElementById('mInp').value += '${e}'">${e}</span>`; });

        // Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†
        db.ref('status').on('value', s => {
            const list = document.getElementById('user-list');
            list.innerHTML = '';
            s.forEach(u => {
                list.innerHTML += `<div style="display:flex; align-items:center; gap:10px; margin-bottom:12px; cursor:pointer;" onclick="showUser('${u.key}')">
                    <img src="${u.val().av}" style="width:35px; height:35px; border-radius:50%; border:1px solid var(--main);">
                    <span>${u.val().n}</span><span style="color:#0f0; font-size:8px; margin-right:auto;">Online</span>
                </div>`;
            });
        });

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª
        for(let i=1; i<=4; i++){
            db.ref('mics/m'+i).on('value', s => {
                const el = document.getElementById('mic'+i);
                if(s.val()){ el.innerText = 'ğŸ™ï¸ ' + s.val().n; el.classList.add('active'); }
                else { el.innerText = 'ğŸ™ï¸ Ù…ØªØ§Ø­'; el.classList.remove('active'); }
            });
        }
    }

    function joinMic(i) {
        const ref = db.ref('mics/m'+i);
        ref.once('value', s => { if(s.val() && s.val().uid === myID) ref.remove(); else if(!s.val()) ref.set({uid: myID, n: myData.n}); });
    }

    function toggleEmoji(e) { e.stopPropagation(); const s = document.getElementById('emoji-shelf'); s.style.display = s.style.display === 'grid' ? 'none' : 'grid'; }
    function askYT() { const id = prompt("ÙƒÙˆØ¯ ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨:"); if(id) db.ref('global_yt').set({ id, v: true }); }
    db.ref('global_yt').on('value', s => {
        const y = s.val();
        if(y) {
            document.getElementById('yt-float').style.display = 'block';
            document.getElementById('yt-frame').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${y.id}?autoplay=1&controls=${y.v?1:0}" frameborder="0"></iframe>`;
        }
    });
    function setYT(v) { db.ref('global_yt/v').set(v); }
</script>
</body>
</html>
