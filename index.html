<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„Ø¨Ø« Ø§Ù„Ø¹Ø§Ù… ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; --side-w: 250px; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        #sidebar { width: var(--side-w); background: rgba(10, 10, 10, 0.98); border-left: 1px solid var(--main); padding: 20px; box-sizing: border-box; flex-shrink: 0; transition: 0.4s; }
        .user-card { padding: 10px; border-radius: 12px; background: #1a1a1a; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; border: 1px solid #333; }
        .online-dot { width: 10px; height: 10px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 8px #00ff00; }
        .name-glow { color: var(--main); font-weight: bold; text-shadow: 0 0 5px var(--main); font-size: 13px; }

        .main-chat { flex-grow: 1; display: flex; flex-direction: column; position: relative; }
        .header { background: #111; padding: 10px 15px; border-bottom: 1px solid var(--main); display: flex; justify-content: space-between; align-items: center; }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙØªÙˆØ­ Ù„Ù„Ø¬Ù…ÙŠØ¹ */
        .search-bar { background: #111; padding: 10px; display: flex; gap: 8px; border-bottom: 1px solid #222; }
        .search-bar input { flex: 1; padding: 8px 15px; border-radius: 20px; border: 1px solid #444; background: #000; color: #fff; outline: none; font-size: 13px; }
        .search-bar button { background: var(--main); border: none; padding: 5px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }

        #live-area { display: none; height: 230px; background: #000; border-bottom: 2px solid var(--main); }
        #chat-box { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        
        .msg { padding: 10px 14px; border-radius: 15px; max-width: 80%; position: relative; animation: fadeIn 0.3s; }
        .msg.me { align-self: flex-end; background: #222; border-right: 4px solid var(--main); border-bottom-right-radius: 4px; }
        .msg.other { align-self: flex-start; background: #1a1a1a; border-left: 4px solid #fff; border-bottom-left-radius: 4px; }
        .u-info { font-size: 0.8em; color: var(--main); font-weight: bold; margin-bottom: 4px; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ù„Ùƒ ÙÙ‚Ø· */
        #admin-panel { position: fixed; top: 15%; left: 15%; right: 15%; bottom: 15%; background: rgba(10,10,10,0.98); border: 2px solid var(--main); z-index: 9999; border-radius: 20px; padding: 20px; display: none; text-align: center; }
        
        #yt-results { display: flex; overflow-x: auto; gap: 10px; padding: 10px; background: #0a0a0a; border-bottom: 1px solid #333; }
        .yt-card { min-width: 120px; cursor: pointer; text-align: center; }
        .yt-card img { width: 100px; border-radius: 8px; }
        .yt-card p { font-size: 10px; height: 25px; overflow: hidden; margin: 5px 0; }

        .input-bar { padding: 10px 15px; background: #111; border-top: 1px solid #222; display: flex; gap: 10px; }
        .input-bar input { flex: 1; padding: 10px 18px; border-radius: 25px; border: 1px solid #333; background: #000; color: #fff; outline: none; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="admin-panel">
        <h2 style="color:var(--main);">ğŸ‘‘ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±</h2>
        <button onclick="clearChat()" style="background:red; color:white; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; margin:10px;">Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Øª ğŸ§¨</button>
        <button onclick="toggleSide()" style="background:var(--main); padding:10px 20px; border:none; border-radius:8px; cursor:pointer; margin:10px;">Ù†Ù‚Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â†”ï¸</button>
        <button onclick="stopLive()" style="background:#555; color:white; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; margin:10px;">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø« âŒ</button>
        <br><br>
        <button onclick="closePanel()" style="padding:10px 30px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div id="sidebar">
        <h3 style="text-align:center; color:var(--main); margin:0 0 15px 0;">Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† ğŸ‡®ğŸ‡¶</h3>
        <div id="online-users"></div>
    </div>

    <div class="main-chat">
        <div class="header">
            <button id="gear-btn" onclick="openPanel()" style="background:none; border:none; font-size:22px; cursor:pointer; display:none;">âš™ï¸</button>
            <h2 style="margin:0; font-size:18px;">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</h2>
            <div id="timer" style="font-size:12px; color:#666;"></div>
        </div>

        <div class="search-bar">
            <input type="text" id="yt-query" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ ÙÙŠ ÙŠÙˆØªÙŠÙˆØ¨...">
            <button onclick="searchYT()">Ø¨Ø­Ø« ğŸ”</button>
        </div>
        <div id="yt-results"></div>

        <div id="live-area"><div id="yt-player" style="width:100%; height:100%;"></div></div>
        
        <div id="chat-box"></div>

        <div class="input-bar">
            <button onclick="document.getElementById('fInp').click()" style="background:none; border:none; font-size:22px;">ğŸ“</button>
            <input type="file" id="fInp" style="display:none" onchange="upImg(this)">
            <input type="text" id="mInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
            <button onclick="send()" style="background:var(--main); border:none; padding:8px 20px; border-radius:20px; font-weight:bold;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

<script>
    const YT_KEY = "AIzaSyC4wFkLrA_BlNzreseXQLeSp_40Gbmu9VU"; 
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
        if (user) {
            const isMe = user.email === "rgrghh77@gmail.com";
            if(isMe) document.getElementById('gear-btn').style.display = 'block';
            const name = isMe ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('status/' + user.uid).set({ n: name });
            db.ref('status/' + user.uid).onDisconnect().remove();
            loadChat(); loadUsers(); watchLive();
        } else { window.location.href = "index.html"; }
    });

    function send() {
        const i = document.getElementById('mInp');
        if(i.value.trim()) {
            db.ref('msgs').push({
                u: auth.currentUser.email === "rgrghh77@gmail.com" ? "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : auth.currentUser.email.split('@')[0],
                t: i.value,
                m: auth.currentUser.email === "rgrghh77@gmail.com"
            });
            i.value = '';
        }
    }

    function loadChat() {
        db.ref('msgs').limitToLast(50).on('child_added', snap => {
            const d = snap.val();
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = `msg ${d.m ? 'me' : 'other'}`;
            div.innerHTML = `<div class="u-info">${d.u}</div>${d.t}`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
        db.ref('msgs').on('child_removed', () => location.reload());
    }

    async function searchYT() {
        const q = document.getElementById('yt-query').value;
        if(!q) return;
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${q}&type=video&maxResults=5&key=${YT_KEY}`);
        const data = await res.json();
        const container = document.getElementById('yt-results');
        container.innerHTML = '';
        data.items.forEach(v => {
            container.innerHTML += `
                <div class="yt-card" onclick="playVideo('${v.id.videoId}')">
                    <img src="${v.snippet.thumbnails.default.url}">
                    <p style="color:white; font-size:9px;">${v.snippet.title}</p>
                </div>`;
        });
    }

    function playVideo(id) { db.ref('live').set({ id: id, active: true }); document.getElementById('yt-results').innerHTML = ''; }
    function stopLive() { db.ref('live').set({ active: false }); }
    function watchLive() {
        db.ref('live').on('value', snap => {
            const v = snap.val();
            const area = document.getElementById('live-area');
            if(v && v.active) {
                area.style.display = 'block';
                document.getElementById('yt-player').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${v.id}?autoplay=1" frameborder="0" allowfullscreen></iframe>`;
            } else { area.style.display = 'none'; }
        });
    }

    function openPanel() { document.getElementById('admin-panel').style.display = 'block'; }
    function closePanel() { document.getElementById('admin-panel').style.display = 'none'; }
    function clearChat() { if(confirm("Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ")) db.ref('msgs').remove(); }
    function toggleSide() { 
        const body = document.body;
        body.style.flexDirection = body.style.flexDirection === 'row-reverse' ? 'row' : 'row-reverse';
    }
    function loadUsers() {
        db.ref('status').on('value', snap => {
            const list = document.getElementById('online-users');
            list.innerHTML = '';
            snap.forEach(c => { list.innerHTML += `<div class="user-card"><div class="online-dot"></div><span class="name-glow">${c.val().n}</span></div>`; });
        });
    }
    setInterval(() => { document.getElementById('timer').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>
