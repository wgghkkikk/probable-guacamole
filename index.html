<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø§Øª Ø¹Ù„ÙˆØ´ - MASTER</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: sans-serif; background: #121212; color: white; overflow: hidden; }
        
        #app { display: flex; height: 100vh; flex-direction: row; }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
        #side { width: 200px; background: #1e1e1e; border-left: 1px solid #333; display: flex; flex-direction: column; }
        .user-item { padding: 10px; border-bottom: 1px solid #222; cursor: pointer; transition: 0.3s; }
        .user-item:hover { background: #333; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        #main { flex: 1; display: flex; flex-direction: column; position: relative; }
        #msgs { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø¹Ù„ÙˆØ´ ÙˆØ±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ */
        .msg { background: #333; padding: 8px 15px; border-radius: 10px; max-width: 80%; width: fit-content; }
        .rank { color: #d4af37; font-weight: bold; font-size: 12px; display: block; }

        /* Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© - Ø¬Ø¹Ù„ØªÙ‡Ø§ Ø«Ø§Ø¨ØªØ© Ø¬Ø¯Ø§Ù‹ Ø¨Ø§Ù„Ø£Ø³ÙÙ„ */
        .input-bar { 
            padding: 15px; background: #1e1e1e; border-top: 1px solid #333; 
            display: flex; gap: 10px; position: sticky; bottom: 0;
        }
        #mInput { flex: 1; padding: 12px; border-radius: 5px; border: 1px solid #444; background: #222; color: white; outline: none; }
        #sendBtn { background: #d4af37; color: black; border: none; padding: 0 20px; border-radius: 5px; font-weight: bold; cursor: pointer; }

        /* Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¹Ù„ÙˆØ´ */
        #master-panel {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #222; border: 2px solid #d4af37; padding: 20px; border-radius: 15px;
            display: none; z-index: 9999; text-align: center;
        }
    </style>
</head>
<body>

<div id="app">
    <div id="side">
        <div style="padding:15px; background:#d4af37; color:black; font-weight:bold;">Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† ğŸ‘¥</div>
        <div id="uList"></div>
    </div>

    <div id="main">
        <div id="msgs"></div>

        <div class="input-bar">
            <input type="text" id="mInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§ ÙŠØ§ Ù…Ù„Ùƒ..." onkeypress="if(event.key==='Enter') send()">
            <button id="sendBtn" onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>
</div>

<div id="master-panel">
    <h3 id="target-name">Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ</h3>
    <button onclick="kickNow()" style="background:red; color:white; padding:10px; border:none; width:100%; cursor:pointer; font-weight:bold;">Ø·Ø±Ø¯ â›”</button>
    <button onclick="document.getElementById('master-panel').style.display='none'" style="margin-top:10px; background:none; color:grey; border:none; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
</div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let myName = "Ø¹Ù„ÙˆØ´"; // ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
    let isOwner = false;
    let target = "";

    // 1. ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ÙÙˆØ±Ø§Ù‹
    db.ref('master').on('value', snap => {
        if(snap.val() === myName) {
            isOwner = true;
            console.log("ØªÙ… ØªÙØ¹ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„ÙˆØ´ ğŸ‘‘");
        }
    });

    // 2. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¯ÙˆÙ† ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
    function send() {
        let input = document.getElementById('mInput');
        let text = input.value.trim();
        if(!text) return;

        db.ref('messages').push({
            u: myName,
            t: text,
            r: isOwner ? "ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª" : "Ø¹Ø¶Ùˆ"
        });
        input.value = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ø®Ø§Ù†Ø© ÙˆØ¨Ù‚Ø§Ø¡Ù‡Ø§ Ù…ÙƒØ§Ù†Ù‡Ø§
    }

    // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙˆØ± ÙˆØµÙˆÙ„Ù‡Ø§
    db.ref('messages').limitToLast(50).on('child_added', snap => {
        let m = snap.val();
        let div = document.createElement('div');
        div.className = "msg";
        div.innerHTML = `<span class="rank">${m.r}</span> <b>${m.u}:</b> ${m.t}`;
        document.getElementById('msgs').appendChild(div);
        document.getElementById('msgs').scrollTop = document.getElementById('msgs').scrollHeight;
    });

    // 4. Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø·Ø±Ø¯ Ù„Ø¹Ù„ÙˆØ´
    db.ref('online').on('value', snap => {
        let list = document.getElementById('uList');
        list.innerHTML = "";
        snap.forEach(u => {
            let user = u.val();
            let d = document.createElement('div');
            d.className = "user-item";
            d.innerText = "â— " + user.name;
            d.onclick = () => {
                if(isOwner && user.name !== myName) {
                    target = user.name;
                    document.getElementById('target-name').innerText = target;
                    document.getElementById('master-panel').style.display = 'block';
                }
            };
            list.appendChild(d);
        });
    });

    function kickNow() {
        db.ref('actions/' + target).set({ type: 'KICK' });
        alert("ØªÙ… Ø§Ù„Ø·Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­!");
        document.getElementById('master-panel').style.display = 'none';
    }
</script>
</body>
</html>
