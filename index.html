<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #ffd700; --vip: #00d4ff; --bg: #050505; --neon: 0 0 10px var(--gold); }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: #fff; height: 100vh; overflow: hidden; }

        /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ù…Ø®ØµØµØ© */
        #custom-overlay { position: fixed; inset: 0; z-index: -1; background-size: cover; background-position: center; opacity: 0.3; filter: blur(2px); }

        .app { display: flex; flex-direction: column; height: 100%; position: relative; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ */
        .header { height: 65px; background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--gold); display: flex; justify-content: space-between; align-items: center; padding: 0 15px; box-shadow: var(--neon); z-index: 1000; }
        .status-dot { width: 8px; height: 8px; background: #0f0; border-radius: 50%; display: inline-block; margin-left: 5px; box-shadow: 0 0 5px #0f0; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ±ÙŠÙ†Ø¯ ÙˆØ§Ù„Ù‡Ø§Ø´ØªØ§Ù‚ */
        .trend-zone { height: 35px; background: #111; display: flex; align-items: center; overflow: hidden; border-bottom: 1px solid #222; font-size: 11px; }
        .marquee { white-space: nowrap; animation: scroll 20s linear infinite; color: var(--gold); width: 100%; }
        @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        #chat-win { flex: 1; overflow-y: auto; padding: 15px 15px 230px 15px; display: flex; flex-direction: column; gap: 15px; }
        
        /* ÙÙ‚Ø§Ø¹Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© - Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø¯Ù…Ø¬ */
        .msg { max-width: 85%; padding: 12px; border-radius: 18px; position: relative; border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px); animation: fadeIn 0.4s ease; }
        .msg-me { align-self: flex-end; background: linear-gradient(135deg, #1a1a1a, #000); border-right: 4px solid var(--gold); }
        .msg-other { align-self: flex-start; background: linear-gradient(135deg, #0d0d0d, #1a1a1a); border-left: 4px solid var(--vip); }
        .bot-msg { align-self: center; background: rgba(255,215,0,0.05); border: 1px dashed var(--gold); width: 90%; text-align: center; }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø±ØªØ¨ */
        .rank-badge { font-size: 9px; padding: 2px 6px; border-radius: 5px; margin-left: 5px; color: #000; font-weight: bold; }
        .legendary { box-shadow: 0 0 15px var(--gold); border: 1px solid var(--gold) !important; }
        
        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø®Ø§Øµ */
        .input-area { position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.95); border-top: 1px solid #333; padding: 15px; z-index: 1100; }
        .reply-tag { background: #111; padding: 5px; font-size: 10px; border-radius: 5px; display: none; color: var(--gold); border-right: 2px solid var(--gold); margin-bottom: 5px; }
        .input-row { display: flex; align-items: center; gap: 10px; }
        #mInp { flex: 1; background: #1a1a1a; border: 1px solid #333; color: #fff; border-radius: 25px; padding: 12px 20px; }
        .btn-circle { width: 45px; height: 45px; border-radius: 50%; border: none; background: var(--gold); color: #000; font-size: 20px; cursor: pointer; }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
        .menu { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 5000; display: none; padding: 30px 20px; overflow-y: auto; }
        .show { display: block; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .card { width: 100%; padding: 15px; background: #111; border: 1px solid #333; border-radius: 15px; margin-bottom: 10px; color: #fff; text-align: right; cursor: pointer; }
        
        /* ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ÙˆØ§Ù„Ù…ÙØ§Ø¬Ø¢Øª */
        .lucky-gift { background: linear-gradient(45deg, #ff0055, #ffcc00); padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    </style>
</head>
<body>

<div id="custom-overlay"></div>

<div class="app">
    <div class="header">
        <button onclick="openM('m-profile')" style="background:none; border:none; font-size:24px;">ğŸ‘¤</button>
        <div style="text-align:center;">
            <b style="color:var(--gold)">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</b><br>
            <span style="font-size:9px;" id="room-name"><span class="status-dot"></span> Ø§Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¹Ø§Ù…</span>
        </div>
        <button onclick="openM('m-settings')" style="background:none; border:none; font-size:24px;">âš™ï¸</button>
    </div>

    <div class="trend-zone">
        <div class="marquee" id="marquee-text">ğŸ¥‡ Ù…Ù„Ùƒ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¢Ù†: Ø¬Ø§Ø±Ù Ø§Ù„Ø­Ø³Ø§Ø¨... | Ø§Ø³ØªØ®Ø¯Ù… #Ù‡Ø§Ø´ØªØ§Ù‚ Ù„Ù„Ø¨Ø­Ø« | Ø§ØªØ¨Ø¹ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ›¡ï¸</div>
    </div>

    <div id="chat-win"></div>

    <div class="input-area">
        <div id="reply-preview" class="reply-tag"><span></span> <b onclick="cancelReply()" style="color:red; margin-right:10px;">X</b></div>
        <div class="input-row">
            <button onclick="openM('m-extra')" style="background:none; border:none; font-size:24px;">ğŸ</button>
            <input type="text" id="mInp" placeholder="Ø§Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø£Ùˆ @Ù…Ù†Ø´Ù†..." onkeydown="if(event.key==='Enter') doSend()">
            <button class="btn-circle" onclick="doSend()">ğŸš€</button>
        </div>
    </div>
</div>

<div id="m-extra" class="menu">
    <h2 style="color:var(--gold); text-align:center;">ğŸ® Ù…Ø±ÙƒØ² Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª ÙˆØ§Ù„Ø¬ÙˆØ§Ø¦Ø²</h2>
    <div class="card" onclick="spawnLucky()">ğŸ Ø±Ù…ÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ù‡Ø¯Ø§ÙŠØ§ (Ù„Ù„Ù…Ø§Ù„Ùƒ)</div>
    <div class="card" onclick="startQuiz()">â“ Ø¥Ø·Ù„Ø§Ù‚ Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</div>
    <hr border="0.1">
    <div class="card" onclick="buyItem('verify', 100)">âœ… Ø´Ø±Ø§Ø¡ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø³Ø§Ø¨ (100 XP)</div>
    <div class="card" onclick="buyItem('gold', 50)">âœ¨ Ø§Ø³Ù… Ø°Ù‡Ø¨ÙŠ Ù…Ø´Ø¹ (50 XP)</div>
    <button onclick="closeAll()" class="card" style="background:#333; text-align:center;">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="m-profile" class="menu">
    <center>
        <div id="p-img-container">
            <img id="my-avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=alosh" style="width:110px; height:110px; border-radius:50%; border:3px solid var(--gold);">
        </div>
        <h2 id="p-name">Ù…Ø­Ø§Ø±Ø¨ Ø¹Ù„ÙˆØ´</h2>
        <div style="color:var(--gold); margin-bottom:20px;">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="p-xp">0</span> XP</div>
        <input type="text" id="nameChange" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯..." style="width:100%; padding:15px; background:#111; color:#fff; border:1px solid #333; border-radius:10px;">
        <div class="card" style="margin-top:10px; position:relative;">
            ğŸ–¼ï¸ ØªØºÙŠÙŠØ± Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
            <input type="file" onchange="setBg(this)" style="position:absolute; inset:0; opacity:0; cursor:pointer;">
        </div>
        <button onclick="saveProfile()" class="card" style="background:var(--gold); color:#000; text-align:center; font-weight:bold;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
        <div id="admin-panel" style="display:none; margin-top:20px; border:1px solid red; padding:10px;">
            <p style="color:red">ğŸ›  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·Ù„Ù‚Ø©</p>
            <button onclick="db.ref('msgs').remove()" class="card" style="background:red;">ğŸ—‘ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</button>
        </div>
        <button onclick="closeAll()" class="card" style="background:#333; text-align:center;">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
    </center>
</div>

<script>
    // --- Ø§Ù„Ø±Ø¨Ø· Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
    const firebaseConfig = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ù…Ø­Ù„ÙŠØ© ---
    let uID = localStorage.getItem('uID') || "U" + Date.now();
    localStorage.setItem('uID', uID);
    let myData = JSON.parse(localStorage.getItem('myData')) || { n: "Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯", xp: 0, r: "user", color: "#fff", bg: "", v: false };
    let replyTo = null;

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ---
    function getRank(xp) {
        if(xp >= 1000) return {n: "Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± ğŸ”¥", c: "legendary", b: "#ffd700"};
        if(xp >= 500) return {n: "Ø£Ø³Ø·ÙˆØ±Ø© ğŸ†", c: "legendary", b: "#00d4ff"};
        if(xp >= 100) return {n: "ÙØ§Ø±Ø³ âš”ï¸", c: "", b: "#fff"};
        return {n: "Ù…Ø­Ø§Ø±Ø¨ ğŸ›¡ï¸", c: "", b: "#888"};
    }

    // --- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ---
    function doSend() {
        let inp = document.getElementById('mInp');
        let txt = inp.value.trim();
        if(!txt) return;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø¨ÙˆØª
        db.ref('active_quiz').once('value', s => {
            if(s.val() && txt === s.val()) {
                myData.xp += 100;
                db.ref('msgs').push({ n: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–", t: `ğŸ‘‘ ÙƒÙÙˆ! ${myData.n} Ø£Ø¬Ø§Ø¨ ØµØ­ ÙˆØ±Ø¨Ø­ 100 Ù†Ù‚Ø·Ø©!`, r: "bot" });
                db.ref('active_quiz').remove();
            } else {
                myData.xp += 2;
                db.ref('msgs').push({
                    uid: uID, n: myData.n, t: txt, xp: myData.xp,
                    color: myData.color, v: myData.v, reply: replyTo,
                    time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
                });
            }
            saveLocal();
            cancelReply();
            inp.value = "";
        });
    }

    // --- Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø­ÙŠØ© ---
    db.ref('msgs').limitToLast(40).on('value', s => {
        let win = document.getElementById('chat-win');
        win.innerHTML = "";
        let counts = {};
        s.forEach(child => {
            let d = child.val();
            if(d.uid) counts[d.n] = (counts[d.n] || 0) + 1;

            let div = document.createElement('div');
            if(d.type === 'gift') {
                div.className = "lucky-gift";
                div.innerHTML = "ğŸ ØµÙ†Ø¯ÙˆÙ‚ Ù‡Ø¯Ø§ÙŠØ§ Ø³Ù‚Ø·! Ø§Ø¶ØºØ· Ù„Ø³Ø±Ù‚Ø© Ø§Ù„Ù†Ù‚Ø§Ø·!";
                div.onclick = () => { myData.xp += 50; db.ref('msgs/'+child.key).remove(); saveLocal(); };
            } else {
                let rank = getRank(d.xp || 0);
                div.className = `msg ${d.r === 'bot' ? 'bot-msg' : (d.uid === uID ? 'msg-me' : 'msg-other')} ${rank.c}`;
                div.onclick = () => setReply(d.n, d.t);
                
                // Ù…ÙŠØ²Ø© Ø§Ù„Ù…Ù†Ø´Ù†
                let textShow = d.t;
                if(textShow.includes("@" + myData.n)) textShow = `<span style="background:yellow;color:000">${textShow}</span>`;

                div.innerHTML = `
                    <div style="font-size:10px; margin-bottom:5px;">
                        <span class="rank-badge" style="background:${rank.b}">${rank.n}</span>
                        <b style="color:${d.color}">${d.n} ${d.v ? 'âœ…' : ''}</b>
                    </div>
                    ${d.reply ? `<div class="reply-box">â†©ï¸ ${d.reply.substring(0,20)}...</div>` : ''}
                    <div>${textShow}</div>
                `;
            }
            win.appendChild(div);
        });
        win.scrollTop = win.scrollHeight;
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ÙŠÙ†Ø¯
        let top = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b, "...");
        document.getElementById('marquee-text').innerText = `ğŸ¥‡ Ù…Ù„Ùƒ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¢Ù†: ${top} | ØªÙØ§Ø¹Ù„ Ù„ØªØµØ¨Ø­ Ù…ÙƒØ§Ù†Ù‡!`;
    });

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ø£Ù„Ø¹Ø§Ø¨ ---
    function spawnLucky() { db.ref('msgs').push({ type: 'gift' }); closeAll(); }
    function startQuiz() {
        const q = [{q:"Ù…Ø§ Ù‡Ùˆ Ø§Ø³Ù… Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ù…Ù„ÙƒØ©ØŸ", a:"Ø¹Ù„ÙˆØ´"}, {q:"10+10?", a:"20"}];
        let p = q[Math.floor(Math.random()*q.length)];
        db.ref('msgs').push({ n: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–", t: "ğŸ”¥ Ø³Ø¤Ø§Ù„ Ø³Ø±ÙŠØ¹: " + p.q, r: "bot" });
        db.ref('active_quiz').set(p.a);
        closeAll();
    }
    function buyItem(type, cost) {
        if(myData.xp >= cost) {
            myData.xp -= cost;
            if(type === 'verify') myData.v = true;
            if(type === 'gold') myData.color = "#ffd700";
            saveLocal();
            alert("Ù…Ø¨Ø±ÙˆÙƒ Ø§Ù„Ø´Ø±Ø§Ø¡!");
        } else alert("Ù†Ù‚Ø§Ø·Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠØ©!");
    }

    // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ---
    function setBg(input) {
        let r = new FileReader();
        r.onload = (e) => { myData.bg = e.target.result; saveLocal(); };
        r.readAsDataURL(input.files[0]);
    }
    function saveProfile() {
        let n = document.getElementById('nameChange').value.trim();
        if(n) myData.n = n;
        saveLocal();
        closeAll();
    }
    function saveLocal() {
        localStorage.setItem('myData', JSON.stringify(myData));
        document.getElementById('p-name').innerText = myData.n;
        document.getElementById('p-xp').innerText = myData.xp;
        if(myData.bg) document.getElementById('custom-overlay').style.backgroundImage = `url(${myData.bg})`;
        if(myData.r === 'admin') document.getElementById('admin-panel').style.display = "block";
    }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø±ÙŠ (Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ ØµÙˆØ±ØªÙƒ) ---
    let timer;
    document.getElementById('my-avatar').onmousedown = () => {
        timer = setTimeout(() => {
            if(prompt("Ø§Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±:") === "1234") {
                myData.r = "admin"; myData.v = true; saveLocal(); alert("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ù„Ùƒ!");
            }
        }, 3000);
    };

    // --- ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© ---
    function setReply(n, t) { replyTo = n+": "+t; document.getElementById('reply-preview').style.display="block"; document.getElementById('reply-preview').querySelector('span').innerText = "Ø±Ø¯ Ø¹Ù„Ù‰: " + n; }
    function cancelReply() { replyTo = null; document.getElementById('reply-preview').style.display="none"; }
    function openM(id) { closeAll(); document.getElementById(id).classList.add('show'); }
    function closeAll() { document.querySelectorAll('.menu').forEach(m => m.classList.remove('show')); }

    saveLocal();
</script>
</body>
</html>
