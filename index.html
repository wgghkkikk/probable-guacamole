<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>MASTER RG - NOTEBOOK</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Reem+Kufi&display=swap" rel="stylesheet">
    <style>
        :root { --ink: #1a2a6c; --paper: #fdfcf0; --margin: #ff6b6b; --pencil: #555; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; 
            background: #d4d0c8; /* Ù„ÙˆÙ† Ø§Ù„Ø®Ø´Ø¨ Ø£Ùˆ Ø§Ù„Ù…ÙƒØªØ¨ */
            display: flex; 
            justify-content: center; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¯ÙØªØ± */
        .notebook { 
            width: 95%; 
            max-width: 500px; 
            background: var(--paper); 
            height: 98vh; 
            margin-top: 1vh;
            position: relative; 
            box-shadow: 10px 10px 30px rgba(0,0,0,0.3);
            border-left: 40px solid #eee; /* Ù…ÙƒØ§Ù† Ø§Ù„Ø³ÙŠÙ… */
            display: flex;
            flex-direction: column;
            border-radius: 5px;
        }

        /* Ø§Ù„Ø³ÙŠÙ… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .notebook::before {
            content: "";
            position: absolute;
            left: -30px; top: 0; bottom: 0; width: 20px;
            background-image: radial-gradient(circle, #333 5px, transparent 6px);
            background-size: 100% 40px;
            z-index: 10;
        }

        header { 
            padding: 15px 20px; 
            border-bottom: 2px solid var(--margin); 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }

        .notebook-title { font-family: 'Reem Kufi', sans-serif; font-size: 22px; color: var(--ink); font-weight: bold; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙˆÙ…Ø§Øª */
        .rooms { 
            display: flex; overflow-x: auto; padding: 10px; gap: 8px; 
            border-bottom: 1px solid #ddd; background: rgba(0,0,0,0.02);
        }
        .r-tag { 
            padding: 5px 12px; border: 1px solid var(--pencil); 
            border-radius: 20px; font-size: 12px; white-space: nowrap; 
            color: var(--pencil); cursor: pointer;
        }
        .r-tag.active { background: var(--ink); color: #fff; }

        /* Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ù…Ø®Ø·Ø·Ø© */
        #chatBox { 
            flex: 1; overflow-y: auto; padding: 20px;
            background-image: linear-gradient(#e1e1e1 1px, transparent 1px);
            background-size: 100% 30px; /* ØªØ®Ø·ÙŠØ· Ø§Ù„ÙˆØ±Ù‚ */
            line-height: 30px;
        }

        .msg-line { margin-bottom: 15px; position: relative; }
        .u-name { font-weight: bold; color: var(--margin); font-size: 13px; margin-left: 5px; }
        .bubble { color: var(--ink); font-size: 15px; display: inline; border-bottom: 1px dashed #ccc; }
        
        /* Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³ */
        .quote { 
            background: #fff59d; padding: 5px 10px; border-radius: 4px; 
            font-size: 11px; margin-bottom: 5px; border-right: 3px solid #fbc02d;
            display: block; line-height: 1.4;
        }

        /* Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .footer { 
            padding: 15px; background: #fff; border-top: 1px solid #ddd;
            display: flex; align-items: center; gap: 10px;
        }
        #mInp { 
            flex: 1; border: none; border-bottom: 2px solid var(--pencil); 
            padding: 10px; outline: none; background: transparent; color: var(--ink);
        }
        .btn-write { 
            background: var(--ink); color: #fff; border: none; 
            padding: 10px 18px; border-radius: 5px; cursor: pointer;
        }

        /* Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */
        #profile {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7);
            z-index: 1000; display: none; align-items: center; justify-content: center;
        }
        .p-card {
            background: #fff; width: 300px; padding: 20px; border-radius: 10px;
            text-align: center; border: 5px solid var(--paper);
        }
    </style>
</head>
<body>

<div class="notebook">
    <header>
        <div class="notebook-title" onclick="openP()">Ø¯ÙØªØ± MASTER RG ğŸ“–</div>
        <div id="on-val" style="font-size:10px; color:var(--pencil)">...</div>
    </header>

    <div class="rooms">
        <div class="r-tag active" onclick="join('main', this)">ğŸ‘‘ Ø§Ù„Ø¹Ø±Ø´</div>
        <div class="r-tag" onclick="join('vip', this)">ğŸ’ Ø§Ù„Ø¯ÙŠÙˆØ§Ù†</div>
        <div class="r-tag" onclick="join('game', this)">ğŸ® Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div>
        <div class="r-tag" onclick="join('elite', this)">ğŸ¤ Ø§Ù„Ù†Ø®Ø¨Ø©</div>
    </div>

    <div id="chatBox"></div>

    <div id="rep-preview" style="display:none; padding:5px 15px; font-size:11px; color:var(--margin)">
        Ø±Ø¯ Ø¹Ù„Ù‰: <span id="rep-u"></span> <button onclick="cancelRep()" style="border:none; background:none; color:red">âœ–</button>
    </div>

    <div class="footer">
        <button onclick="openP()" style="background:none; border:none; font-size:20px;">ğŸ‘¤</button>
        <input type="text" id="mInp" placeholder="Ø§ÙƒØªØ¨ Ø¨Ù‚Ù„Ù…Ùƒ Ù‡Ù†Ø§...">
        <button onclick="send()" class="btn-write">Ø§Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<div id="profile">
    <div class="p-card">
        <img id="p-img" src="" style="width:80px; height:80px; border-radius:50%; border:2px solid var(--ink)">
        <h3 id="p-name"></h3>
        <button onclick="editP()" style="width:100%; padding:8px; margin-bottom:10px; background:var(--ink); color:#fff; border:none; border-radius:5px;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±</button>
        <button onclick="closeP()" style="border:none; background:none; color:var(--pencil)">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let my = {
        n: localStorage.getItem('rg_n') || "",
        p: localStorage.getItem('rg_p') || "https://ui-avatars.com/api/?name=User",
        xp: 0
    };

    if(!my.n) {
        let n = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ø¯ÙØªØ±:");
        if(n) { localStorage.setItem('rg_n', n); location.reload(); }
    }

    let curRoom = "main", replyData = null;

    function join(id, el) {
        curRoom = id;
        document.querySelectorAll('.r-tag').forEach(t=>t.classList.remove('active'));
        el.classList.add('active');
        load();
    }

    function send() {
        let t = document.getElementById('mInp').value.trim();
        if(!t) return;
        
        db.ref('rooms/'+curRoom).push({ u: my.n, t: t, p: my.p, rep: replyData });
        
        // Ø¨ÙˆØª Ø§Ù„ÙØ²Ø¹Ø© Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ
        const brain = {
            "Ù‡Ù„Ùˆ": "Ù‡Ù„Ø§ ÙˆØºÙ„Ø§ØŒ Ù†ÙˆØ±Øª Ø§Ù„Ø¯ÙØªØ± ÙŠØ§ ÙˆØ±Ø¯Ø© ğŸŒ¹",
            "Ø´Ù„ÙˆÙ†Ùƒ": "Ø¨Ø®ÙŠØ± ÙŠØ§ Ø¨Ø¹Ø¯ Ø±ÙˆØ­ÙŠØŒ Ø£Ù†Øª Ø´Ù„ÙˆÙ†ÙƒØŸ",
            "Ù‡Ù‡Ù‡Ù‡": "Ø¯ÙˆÙ… Ø§Ù„Ø¶Ø­ÙƒØ© ÙŠØ§Ø±Ø¨ ğŸ˜‚",
            "Ù…Ù†ÙˆØ±": "Ù†ÙˆØ±Ùƒ Ø§Ù„Ø¹Ø§ÙƒØ³ ÙŠØ§ Ù…Ù„Ùƒ",
            "ÙƒÙÙˆ": "ÙƒÙÙˆ Ù…Ù† Ø´Ø§Ø±Ø¨Ùƒ Ø§Ù„Ø·ÙŠØ¨"
        };
        for(let key in brain) {
            if(t.includes(key)) {
                setTimeout(()=> db.ref('rooms/'+curRoom).push({ u: "ğŸ¤– BOT", t: brain[key], bot: true, p: "https://cdn-icons-png.flaticon.com/512/4712/4712035.png" }), 700);
                break;
            }
        }
        
        cancelRep();
        document.getElementById('mInp').value = "";
    }

    function load() {
        db.ref('rooms/'+curRoom).off();
        const box = document.getElementById('chatBox');
        box.innerHTML = "";
        db.ref('rooms/'+curRoom).limitToLast(40).on('child_added', snap => {
            let m = snap.val();
            let isMe = m.u === my.n;
            let div = document.createElement('div');
            div.className = "msg-line";
            div.innerHTML = `
                <span class="u-name" onclick="setRep('${m.u}','${m.t}')">${m.u}:</span>
                <div class="bubble" onclick="setRep('${m.u}','${m.t}')">
                    ${m.rep ? `<span class="quote">Ø±Ø¯ Ø¹Ù„Ù‰ ${m.rep.u}: ${m.rep.t}</span>` : ''}
                    ${m.t}
                </div>
                ${isMe ? `<span style="color:red; font-size:10px; cursor:pointer;" onclick="db.ref('rooms/${curRoom}/${snap.key}').remove()"> [Ø­Ø°Ù]</span>` : ''}
            `;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
    }

    function setRep(u, t) {
        replyData = { u, t };
        document.getElementById('rep-u').innerText = u;
        document.getElementById('rep-preview').style.display = 'block';
    }

    function cancelRep() { replyData = null; document.getElementById('rep-preview').style.display = 'none'; }

    function openP() {
        document.getElementById('p-name').innerText = my.n;
        document.getElementById('p-img').src = my.p;
        document.getElementById('profile').style.display = 'flex';
    }
    function closeP() { document.getElementById('profile').style.display = 'none'; }
    function editP() {
        let n = prompt("Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©:");
        if(n) { my.p = n; localStorage.setItem('rg_p', n); openP(); }
    }

    db.ref('on/'+my.n).set(true); db.ref('on/'+my.n).onDisconnect().remove();
    db.ref('on').on('value', snap => { document.getElementById('on-val').innerText = snap.numChildren() + " Ø­Ø¶ÙˆØ±"; });

    load();
</script>
</body>
</html>
