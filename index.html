<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ - Ø³ØªØ§ÙŠÙ„ Ø´Ø°Ø± ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; --panel: #161616; }
        body { background: var(--bg); color: #fff; font-family: 'Tahoma', sans-serif; margin: 0; overflow: hidden; }

        /* Ø³ØªØ§ÙŠÙ„ Ø´Ø°Ø±: Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .side { width: 280px; height: 100vh; background: var(--panel); position: fixed; transition: 0.3s; z-index: 2000; border-left: 2px solid #333; }
        #side-right { right: -282px; }
        #side-left { left: -282px; border-right: 2px solid #333; }
        .side.open { right: 0 !important; left: 0 !important; }

        /* Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ (Ù…Ø«Ù„ Ø´Ø°Ø±) */
        #user-card { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; background: #1a1a1a; border: 2px solid var(--main); border-radius: 15px; display: none; z-index: 3000; box-shadow: 0 0 20px #000; }
        .card-cover { width: 100%; height: 100px; border-radius: 13px 13px 0 0; object-fit: cover; }
        .card-av { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--main); margin: -40px auto 0; display: block; background: #000; }

        /* Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        #wrapper { height: 100vh; display: flex; flex-direction: column; position: relative; }
        #chat-area { flex: 1; overflow-y: auto; padding: 10px; background: url('https://www.transparenttextures.com/patterns/dark-matter.png'); }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø´Ø°Ø± Ø§Ù„ÙƒÙ„Ø§Ù… */
        .msg-box { display: flex; gap: 8px; margin-bottom: 12px; }
        .msg-box.me { flex-direction: row-reverse; }
        .u-img { width: 45px; height: 45px; border-radius: 8px; border: 1px solid #444; cursor: pointer; }
        .msg-content { max-width: 70%; }
        .u-name { font-size: 11px; color: var(--main); font-weight: bold; margin-bottom: 2px; display: block; }
        .text { background: #1a1a1a; padding: 8px 12px; border-radius: 10px; border: 1px solid #333; font-size: 14px; word-wrap: break-word; }
        .me .text { background: #222; border-color: var(--main); }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª Ø§Ù„Ø¶Ø®Ù…Ø© */
        #emoji-panel { height: 250px; background: #111; border-top: 2px solid var(--main); display: none; overflow-y: auto; padding: 10px; z-index: 1500; }
        .emoji-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; }
        .emoji-btn { font-size: 28px; cursor: pointer; text-align: center; }

        /* Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ø§Ù„Ø¹Ø§Ø¦Ù… */
        #yt-box { position: absolute; top: 60px; left: 10px; width: 150px; height: 100px; border: 2px solid var(--main); z-index: 1000; border-radius: 8px; overflow: hidden; display: none; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-bar { background: #0a0a0a; padding: 10px; display: flex; gap: 8px; align-items: center; border-top: 1px solid #333; }
        .input-bar input { flex: 1; background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 5px; outline: none; }
        .btn-shather { color: var(--main); font-size: 22px; cursor: pointer; border: none; background: none; }
    </style>
</head>
<body onclick="closeEverything()">

    <div id="user-card" onclick="event.stopPropagation()">
        <img src="https://via.placeholder.com/300x100" class="card-cover" id="c-cover">
        <img src="" class="card-av" id="c-av">
        <div style="text-align:center; padding:15px;">
            <h3 id="c-name" style="margin:5px 0;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
            <p id="c-status" style="color:#888; font-size:12px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù…Ù„ÙƒØªÙŠ</p>
            <div style="display:flex; justify-content:space-around; margin-top:15px;">
                <button onclick="alert('Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø©')" style="background:var(--main); border:none; padding:5px 10px; border-radius:5px;">Ø¥Ø¶Ø§ÙØ©</button>
                <button onclick="document.getElementById('user-card').style.display='none'" style="background:#444; color:#fff; border:none; padding:5px 10px; border-radius:5px;">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <div id="side-right" class="side" onclick="event.stopPropagation()">
        <div style="padding:15px; background:#222; color:var(--main); font-weight:bold;">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† Ø§Ù„Ø¢Ù†</div>
        <div id="user-list" style="padding:10px;"></div>
    </div>

    <div id="side-left" class="side" onclick="event.stopPropagation()">
        <div style="padding:15px; background:#222; color:var(--main); font-weight:bold;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</div>
        <div style="padding:20px;">
            <button class="btn-shather" style="font-size:16px;" onclick="editMyProf()">âš™ï¸ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</button>
            <br><br>
            <button class="btn-shather" style="font-size:16px;" onclick="toggleYT()">ğŸ“º ØªØ´ØºÙŠÙ„ ÙŠÙˆØªÙŠÙˆØ¨</button>
        </div>
    </div>

    <div id="wrapper">
        <div style="padding:10px; background:#111; display:flex; justify-content:space-between; border-bottom:1px solid #333;">
            <button class="btn-shather" onclick="openS('left', event)">â˜°</button>
            <span style="color:var(--main); font-weight:bold;">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</span>
            <button class="btn-shather" onclick="openS('right', event)">ğŸ‘¥</button>
        </div>

        <div id="yt-box" onclick="event.stopPropagation()">
            <div id="player" style="width:100%; height:100%;"></div>
        </div>

        <div id="chat-area" onclick="closeEverything()"></div>

        <div id="emoji-panel" onclick="event.stopPropagation()">
            <div class="emoji-grid" id="em-list"></div>
        </div>

        <div class="input-bar" onclick="event.stopPropagation()">
            <button class="btn-shather" onclick="toggleEmojiPanel(event)">ğŸ˜Š</button>
            <input type="text" id="mInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
            <button class="btn-shather" onclick="sendMsg()">ğŸš€</button>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let myID, myD = {};

    auth.onAuthStateChanged(u => {
        if(u) {
            myID = u.uid;
            db.ref('users/'+myID).on('value', s => {
                myD = s.val() || { n: u.email.split('@')[0], av: "https://via.placeholder.com/100", cv: "https://via.placeholder.com/300x100", st: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ" };
                db.ref('status/'+myID).set({ n: myD.n, av: myD.av });
            });
            init();
        }
    });

    function openS(d, e) { e.stopPropagation(); document.getElementById('side-'+d).classList.add('open'); }
    function closeEverything() {
        document.getElementById('side-right').classList.remove('open');
        document.getElementById('side-left').classList.remove('open');
        document.getElementById('emoji-panel').style.display = 'none';
        document.getElementById('user-card').style.display = 'none';
    }

    function toggleEmojiPanel(e) { e.stopPropagation(); const p = document.getElementById('emoji-panel'); p.style.display = p.style.display === 'block' ? 'none' : 'block'; }

    function editMyProf() {
        const n = prompt("Ø§Ù„Ø§Ø³Ù…:", myD.n);
        const av = prompt("Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©:", myD.av);
        const st = prompt("Ø§Ù„Ø­Ø§Ù„Ø© (Status):", myD.st);
        db.ref('users/'+myID).update({ n, av, st });
    }

    function sendMsg() {
        const t = document.getElementById('mInp').value;
        if(!t) return;
        db.ref('main_msgs').push({ uid: myID, n: myD.n, av: myD.av, t: t });
        document.getElementById('mInp').value = '';
    }

    function viewUser(uid) {
        event.stopPropagation();
        db.ref('users/'+uid).once('value', s => {
            const d = s.val();
            if(d) {
                document.getElementById('c-name').innerText = d.n;
                document.getElementById('c-av').src = d.av;
                document.getElementById('c-status').innerText = d.st || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø©";
                document.getElementById('user-card').style.display = 'block';
            }
        });
    }

    function init() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ)
        db.ref('main_msgs').limitToLast(30).on('child_added', s => {
            const d = s.val();
            const isMe = d.uid === myID;
            const div = document.createElement('div');
            div.className = `msg-box ${isMe ? 'me' : ''}`;
            div.innerHTML = `
                <img src="${d.av}" class="u-img" onclick="viewUser('${d.uid}')">
                <div class="msg-content">
                    <span class="u-name">${d.n}</span>
                    <div class="text">${d.t}</div>
                </div>`;
            document.getElementById('chat-area').appendChild(div);
            document.getElementById('chat-area').scrollTop = document.getElementById('chat-area').scrollHeight;
        });

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª
        const ems = ['ğŸ˜‚','ğŸ”¥','ğŸ‘‘','âœ¨','ğŸ’¯','ğŸ’','ğŸŒ¹','ğŸ’™','ğŸš€','ğŸ§¿','ğŸ‡®ğŸ‡¶','ğŸ¤','â¤ï¸','ğŸ‘Œ','ğŸ˜','ğŸ¤”','âš¡','ğŸ‰','ğŸ’ª','ğŸ¤«','ğŸ”¥','ğŸ’','ğŸ‘‘','âœ¨','ğŸ’¯','ğŸ’','ğŸŒ¹','ğŸ’™'];
        ems.forEach(e => {
            document.getElementById('em-list').innerHTML += `<span class="emoji-btn" onclick="document.getElementById('mInp').value += '${e}'">${e}</span>`;
        });

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
        db.ref('status').on('value', s => {
            const list = document.getElementById('user-list');
            list.innerHTML = '';
            s.forEach(u => {
                list.innerHTML += `<div style="display:flex; align-items:center; gap:10px; margin-bottom:10px; cursor:pointer;" onclick="viewUser('${u.key}')">
                    <img src="${u.val().av || 'https://via.placeholder.com/30'}" style="width:30px; height:30px; border-radius:50%;">
                    <span>${u.val().n}</span>
                </div>`;
            });
        });
    }

    function toggleYT() {
        const id = prompt("ÙƒÙˆØ¯ ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨:");
        if(id) {
            document.getElementById('yt-box').style.display = 'block';
            document.getElementById('player').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1" frameborder="0"></iframe>`;
        }
    }
</script>
</body>
</html>
