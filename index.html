// --- Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (ØªÙ‚Ø¯Ø± ØªØ¶ÙŠÙ Ù‚Ø¯ Ù…Ø§ ØªØ±ÙŠØ¯) ---
const quizBank = [
    { q: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ØŸ", a: "Ø·ÙˆÙƒÙŠÙˆ" },
    { q: "Ù…Ø§ Ù‡Ùˆ Ø£Ø·ÙˆÙ„ Ù†Ù‡Ø± ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", a: "Ø§Ù„Ù†ÙŠÙ„" },
    { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø³Ø¬Ø¯Ø§Øª Ø§Ù„ØªÙ„Ø§ÙˆØ© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…ØŸ", a: "15" },
    { q: "Ù…Ø§ Ù‡Ùˆ ÙƒÙˆÙƒØ¨ Ø§Ù„Ø£Ø­Ù…Ø±ØŸ", a: "Ø§Ù„Ù…Ø±ÙŠØ®" },
    { q: "Ù…Ù† Ù‡Ùˆ Ù…Ø®ØªØ±Ø¹ Ø§Ù„Ù…ØµØ¨Ø§Ø­ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØŸ", a: "Ø§Ø¯ÙŠØ³ÙˆÙ†" },
    { q: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© ÙØ±Ù†Ø³Ø§ØŸ", a: "Ø¨Ø§Ø±ÙŠØ³" },
    { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠÙ„Ù‚Ø¨ Ø¨Ø³ÙÙŠÙ†Ø© Ø§Ù„ØµØ­Ø±Ø§Ø¡ØŸ", a: "Ø§Ù„Ø¬Ù…Ù„" },
    { q: "Ø£ÙƒØ¨Ø± Ø¯ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ù…Ù† Ø­ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø­Ø©ØŸ", a: "Ø±ÙˆØ³ÙŠØ§" },
    { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ù„ÙˆØ§Ù† Ù‚ÙˆØ³ Ù‚Ø²Ø­ØŸ", a: "7" },
    { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø¹Ø¯Ù† Ø§Ù„Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ­ÙŠØ¯ØŸ", a: "Ø§Ù„Ø²Ø¦Ø¨Ù‚" }
];

let usedQuestions = []; // Ù…ØµÙÙˆÙØ© Ù„Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ù…Ù†Ø¹Ø§Ù‹ Ù„Ù„ØªÙƒØ±Ø§Ø±
let currentAnswer = ""; // Ù„Ø­ÙØ¸ Ø¬ÙˆØ§Ø¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ

// --- ÙˆØ¸ÙŠÙØ© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© "Ø§Ø³Ø¦Ù„Ø©" ---
function checkBotCommand(msgText, userName) {
    if (msgText === "Ø§Ø³Ø¦Ù„Ø©" || msgText === "Ø£Ø³Ø¦Ù„Ø©") {
        startSmartQuiz();
        return true;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬ÙˆØ§Ø¨
    if (currentAnswer !== "" && msgText.trim() === currentAnswer) {
        db.ref('main_msgs').push({
            uid: "system_bot",
            n: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–",
            av: "https://cdn-icons-png.flaticon.com/512/4712/4712035.png",
            t: `ğŸ‰ ÙƒÙÙˆÙˆÙˆ ÙŠØ§ ${userName}.. Ø¬ÙˆØ§Ø¨Ùƒ ØµØ­! Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù‡Ùˆ [ ${currentAnswer} ]`,
            type: "system"
        });
        currentAnswer = ""; // ØªØµÙÙŠØ± Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù‚Ø§Ø¯Ù…
        return true;
    }
    return false;
}

function startSmartQuiz() {
    // ØªØµÙÙŠØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¥Ø°Ø§ Ø®Ù„ØµØª ÙƒÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø­ØªÙ‰ ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯
    if (usedQuestions.length === quizBank.length) {
        usedQuestions = [];
    }

    // Ø§Ø®ØªÙŠØ§Ø± Ø³Ø¤Ø§Ù„ Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡
    let availableQuestions = quizBank.filter(q => !usedQuestions.includes(q.q));
    let randomQ = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];

    usedQuestions.push(randomQ.q);
    currentAnswer = randomQ.a;

    db.ref('main_msgs').push({
        uid: "system_bot",
        n: "Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–",
        av: "https://cdn-icons-png.flaticon.com/512/4712/4712035.png",
        t: `â“ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯: ${randomQ.q} \n (Ø£Ø³Ø±Ø¹ ÙˆØ§Ø­Ø¯ ÙŠØ¬Ø§ÙˆØ¨!)`,
        type: "quiz_question"
    });
}

// --- ØªØ­Ø¯ÙŠØ« ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ send() Ù„ØªØ´Ù…Ù„ ÙØ­Øµ Ø§Ù„Ø¨ÙˆØª ---
function send() {
    const t = document.getElementById('mInp').value.trim();
    if(!t) return;

    // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙ„Ø§Ù… Ù…ÙˆØ¬Ù‡ Ù„Ù„Ø¨ÙˆØª
    const isBotAction = checkBotCommand(t, myD.n);

    if (!isBotAction) {
        db.ref('main_msgs').push({
            uid: myID,
            n: myD.n,
            av: myD.av,
            t: t,
            time: Date.now()
        });
    }
    document.getElementById('mInp').value = '';
}
