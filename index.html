<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER RG - ROYAL WHITE EDITION</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --royal-bg: #ffffff; /* Ø¨ÙŠØ§Ø¶ Ù…Ù„ÙƒÙŠ */
            --owner-theme: linear-gradient(45deg, #ff0000, #990000, #ff0000);
            --gold-accent: #d4af37;
            --text-main: #2c3e50;
        }

        body { 
            margin: 0; background: var(--royal-bg); color: var(--text-main); 
            font-family: 'Cairo', sans-serif; overflow: hidden; height: 100vh; display: flex; 
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†) */
        #sidebar {
            width: 260px; background: #fdfdfd; border-left: 1px solid #eee;
            display: flex; flex-direction: column; transition: 0.3s;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„Ù†Ø¸ÙŠÙ */
        header { 
            padding: 12px 20px; border-bottom: 1px solid #f0f0f0; background: #fff;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
        .refresh-btn { 
            cursor: pointer; display: flex; flex-direction: column; align-items: center;
            color: var(--gold-accent); transition: 0.3s;
        }
        .refresh-btn:hover { transform: rotate(90deg); }

        /* Ø¨Ø§Ø± Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ù…ØªØ­Ø±Ùƒ (Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù„ÙŠ Ø·Ù„Ø¨ØªÙ‡) */
        .rank-bar {
            position: relative; width: 200px; height: 32px; 
            margin: 10px auto; border-radius: 8px; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            color: #fff; font-weight: 900; font-size: 13px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        /* Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…ØªØ­Ø±Ùƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø§Ø± */
        .rank-bar::after {
            content: ""; position: absolute; inset: 0;
            background: var(--owner-theme); background-size: 200% 200%;
            animation: move-theme 3s linear infinite; z-index: -1;
        }
        @keyframes move-theme { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }

        /* Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        #chat-content { flex: 1; display: flex; flex-direction: column; background: #fff; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 25px; }
        
        .msg-box { width: 100%; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .msg-text { 
            max-width: 80%; padding: 12px 20px; border-radius: 15px; 
            background: #f8f9fa; border: 1px solid #ececec; font-size: 16px; 
            color: #333; line-height: 1.6;
        }
        .owner-style { border: 2px solid #ff0000; background: #fff5f5; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-area { padding: 15px 25px; border-top: 1px solid #eee; display: flex; gap: 12px; background: #fff; }
        #mInput { flex: 1; border: 1px solid #ddd; padding: 12px; border-radius: 12px; outline: none; background: #fbfbfb; }
        .send-btn { background: var(--text-main); color: #fff; border: none; padding: 0 25px; border-radius: 12px; cursor: pointer; font-weight: bold; }

    </style>
</head>
<body>

<div id="sidebar">
    <div style="padding:20px; border-bottom:1px solid #eee; font-weight:900; color:var(--gold-accent);">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† ğŸŒ</div>
    <div id="uList" style="flex:1; overflow-y:auto;"></div>
</div>

<div id="chat-content">
    <header>
        <div style="font-size: 22px; font-weight: 900; color: var(--text-main);">MASTER RG ğŸ‘‘</div>
        <div class="refresh-btn" onclick="location.reload()">
            <span style="font-size:22px;">ğŸ”„</span>
            <span style="font-size:9px; font-weight:bold;">ØªØ­Ø¯ÙŠØ«</span>
        </div>
    </header>

    <div id="messages"></div>

    <div class="input-area">
        <input type="text" id="mInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù‡Ù†Ø§...">
        <button onclick="send()" class="send-btn">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let myName = localStorage.getItem('rg_name') || "";
    if(!myName) {
        myName = prompt("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ù…Ù„ÙƒÙŠØŒ Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
        if(myName) localStorage.setItem('rg_name', myName); else location.reload();
    }

    let myRank = (myName === "Ù…Ø§Ø³ØªØ±" || myName === "MASTER RG") ? "ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª" : "Ø¹Ø¶Ùˆ Ù…Ù„ÙƒÙŠ";

    function send() {
        let t = document.getElementById('mInput').value.trim();
        if(!t) return;
        db.ref('royal_rooms/main').push({
            u: myName, t: t, r: myRank, time: Date.now()
        });
        document.getElementById('mInput').value = "";
    }

    function load() {
        db.ref('royal_rooms/main').limitToLast(40).on('child_added', snap => {
            let m = snap.val();
            let isOwner = m.r === "ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª";
            let div = document.createElement('div');
            div.className = "msg-box";
            div.innerHTML = `
                <div class="rank-bar" style="${isOwner ? '' : 'background:#2c3e50; border:none;'}">
                    ${isOwner ? 'ğŸ‘‘ ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª ğŸ‘‘' : m.r}
                </div>
                <div style="font-weight:bold; font-size:13px; margin-bottom:5px; color:#888;">${m.u}</div>
                <div class="msg-text ${isOwner ? 'owner-style' : ''}">
                    ${m.t}
                </div>
            `;
            document.getElementById('messages').appendChild(div);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        });
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    db.ref('online_users/'+myName).set({ n: myName, r: myRank });
    db.ref('online_users/'+myName).onDisconnect().remove();
    db.ref('online_users').on('value', snap => {
        let list = document.getElementById('uList');
        list.innerHTML = "";
        snap.forEach(u => {
            let user = u.val();
            list.innerHTML += `<div style="padding:12px 20px; border-bottom:1px solid #f9f9f9; font-size:14px;">
                <span style="color:green;">â—</span> ${user.n} 
                <small style="display:block; font-size:10px; color:#aaa;">${user.r}</small>
            </div>`;
        });
    });

    load();
</script>
</body>
</html>
