<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    // 1. Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…
    let myName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙŠØ§ Ù…Ù„Ùƒ:"); 
    if (!myName) { location.reload(); }

    let myRank = "Ø¹Ø¶Ùˆ";
    let isChatLocked = false;

    // --- Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø³ØªØ± ---
    if (myName.trim() === "Ø¹Ù„ÙˆØ´") {
        let password = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø§Ø³ØªØ± Ù„ÙØªØ­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:");
        
        if (password === "123456") { // ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± 123456 Ù„Ø£ÙŠ Ø±Ù‚Ù… ØªØ±ÙŠØ¯Ù‡
            myRank = "Ø§Ù„Ù…Ø§Ø³ØªØ±";
            alert("ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚.. Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± ðŸ‘‘");
            document.getElementById('master-panel').style.display = 'block';
        } else {
            alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·! Ø³ØªØ¯Ø®Ù„ ÙƒØ¹Ø¶Ùˆ Ø¹Ø§Ø¯ÙŠ.");
            myName = "Ø¹Ù„ÙˆØ´ (Ù…Ø²ÙŠÙ)"; // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù„ÙŠ ÙŠØ­Ø§ÙˆÙ„ ÙŠÙ‚Ù„Ø¯ Ø§Ø³Ù…Ùƒ
        }
    }

    // Ø¨Ù‚ÙŠØ© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù (Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ Ø§Ù„Ù‚ÙÙ„ØŒ Ø§Ù„Ø¹Ø±Ø¶)
    db.ref('chat_status').on('value', snap => {
        isChatLocked = snap.val()?.locked || false;
        let lockBtn = document.getElementById('lockBtn');
        if(isChatLocked) {
            lockBtn.innerText = "Ø§Ù„Ø´Ø§Øª Ù…Ù‚ÙÙ„ ðŸ”“";
            lockBtn.classList.add('is-locked');
            if(myRank !== "Ø§Ù„Ù…Ø§Ø³ØªØ±") {
                document.getElementById('mInput').placeholder = "Ø§Ù„Ø´Ø§Øª Ù…Ù‚ÙÙ„ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø§Ø³ØªØ±...";
                document.getElementById('mInput').disabled = true;
            }
        } else {
            lockBtn.innerText = "Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Øª ðŸ”’";
            lockBtn.classList.remove('is-locked');
            document.getElementById('mInput').disabled = false;
        }
    });

    function send() {
        if(isChatLocked && myRank !== "Ø§Ù„Ù…Ø§Ø³ØªØ±") return;
        let input = document.getElementById('mInput');
        let text = input.value.trim();
        if(!text) return;
        db.ref('messages').push({ sender: myName, content: text, role: myRank });
        input.value = "";
    }

    function clearChat() {
        if(confirm("Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ")) { db.ref('messages').remove(); }
    }

    function toggleLock() {
        db.ref('chat_status').set({ locked: !isChatLocked });
    }

    db.ref('messages').limitToLast(50).on('child_added', snap => {
        let data = snap.val();
        if(!data.sender || !data.content) return;
        let isMaster = (data.role === "Ø§Ù„Ù…Ø§Ø³ØªØ±");
        let div = document.createElement('div');
        div.className = isMaster ? "msg-master" : "msg-member";
        div.innerHTML = `
            <span class="badge ${isMaster ? 'badge-master' : 'badge-member'}">${isMaster ? 'Ø§Ù„Ù…Ø§Ø³ØªØ±' : 'Ø¹Ø¶Ùˆ'}</span>
            <b style="color:${isMaster ? '#ffd700' : '#00c8ff'}">${data.sender}:</b> 
            <span>${data.content}</span>
        `;
        document.getElementById('chat-area').appendChild(div);
        document.getElementById('chat-area').scrollTop = document.getElementById('chat-area').scrollHeight;
    });

    db.ref('messages').on('value', snap => {
        if(!snap.exists()) document.getElementById('chat-area').innerHTML = "";
    });
</script>
