<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; --bot: #00f2ff; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; display: flex; }

        /* Ø§Ù„Ø£Ø¬Ù†Ø­Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .side { width: 280px; height: 100vh; background: #0d0d0d; position: fixed; transition: 0.4s; z-index: 2000; border-left: 2px solid var(--main); }
        #side-right { right: -285px; }
        #side-left { left: -285px; border-right: 2px solid var(--main); border-left: none; }
        .side.open { right: 0 !important; left: 0 !important; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        #main-view { flex: 1; height: 100vh; display: flex; flex-direction: column; position: relative; }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª ÙˆØ§Ù„ØºØ±Ù */
        .top-section { background: #050505; border-bottom: 1px solid #333; padding: 10px; }
        .mics-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 5px; }
        .mic { background: #111; border: 1px dashed #444; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #666; cursor: pointer; }
        .mic.active { border: 1px solid var(--main); color: var(--main); font-weight: bold; box-shadow: 0 0 8px var(--main); }

        /* Ø§Ù„Ø´Ø§Øª */
        #chat-window { flex: 1; overflow-y: auto; padding: 15px; background: #000; }
        .msg { display: flex; gap: 10px; margin-bottom: 15px; }
        .msg.me { flex-direction: row-reverse; }
        .u-img { width: 45px; height: 45px; border-radius: 12px; border: 1px solid #333; cursor: pointer; object-fit: cover; }
        .bubble { max-width: 70%; position: relative; }
        .u-info { font-size: 11px; margin-bottom: 3px; display: block; font-weight: bold; }
        .text { background: #161616; padding: 10px 14px; border-radius: 12px; border: 1px solid #222; font-size: 14px; }
        
        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø±ØªØ¨ */
        .rank-owner { color: var(--main) !important; text-shadow: 0 0 5px var(--main); }
        .rank-bot { color: var(--bot) !important; }
        .me .text { border-color: var(--main); background: #1a1600; }

        /* Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ */
        #p-card { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; background: #111; border: 2px solid var(--main); border-radius: 20px; display: none; z-index: 3000; overflow: hidden; }
        .p-cover { height: 90px; background: #222; background-size: cover; }
        .p-av { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--main); margin: -40px auto 0; display: block; background: #000; }

        /* Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙˆØ§Ù„ÙŠÙˆØªÙŠÙˆØ¨ */
        #emoji-shelf { height: 180px; background: #050505; border-top: 1px solid var(--main); display: none; grid-template-columns: repeat(8, 1fr); gap: 10px; padding: 10px; overflow-y: auto; }
        #yt-float { position: absolute; top: 120px; left: 10px; width: 150px; height: 100px; border: 1px solid var(--main); display: none; z-index: 1000; border-radius: 8px; overflow: hidden; background: #000; }

        /* Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .bar { padding: 10px; background: #000; display: flex; gap: 8px; align-items: center; border-top: 1px solid #222; }
        input { flex: 1; background: #111; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 10px; outline: none; }
        .btn { color: var(--main); font-size: 24px; cursor: pointer; border: none; background: none; }
    </style>
</head>
<body onclick="closeAll()">

    <div id="p-card" onclick="event.stopPropagation()">
        <div class="p-cover" id="pc-cover"></div>
        <img src="" class="p-av" id="pc-av">
        <div style="text-align:center; padding:15px;">
            <h3 id="pc-name" style="margin:5px 0;">ØªØ­Ù…ÙŠÙ„...</h3>
            <p id="pc-st" style="font-size:12px; color:#888;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            <button onclick="document.getElementById('p-card').style.display='none'" style="background:var(--main); border:none; padding:5px 15px; border-radius:10px; margin-top:10px; font-weight:bold; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="side-right" class="side" onclick="event.stopPropagation()">
        <div style="padding:15px; text-align:center; color:var(--main); border-bottom:1px solid #333;">ğŸ‘¥ Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†</div>
        <div id="user-list" style="padding:10px;"></div>
    </div>

    <div id="side-left" class="side" onclick="event.stopPropagation()">
        <div style="padding:20px;">
            <div style="color:var(--main); margin-bottom:20px; font-weight:bold;">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
            <button class="btn" style="font-size:15px;" onclick="editProf()">ğŸ‘¤ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø±ÙˆÙØ§ÙŠÙ„ÙŠ</button><br><br>
            <button class="btn" style="font-size:15px;" onclick="toggleYT()">ğŸ“º ØªØ´ØºÙŠÙ„ ÙŠÙˆØªÙŠÙˆØ¨</button><br><br>
            <button class="btn" style="font-size:15px; color:red;" onclick="db.ref('msgs').remove()">ğŸ§¨ ØªØµÙÙŠØ± Ø§Ù„Ø´Ø§Øª</button>
        </div>
    </div>

    <div id="main-view">
        <div class="top-section">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <button class="btn" onclick="openS('left', event)">â˜°</button>
                <b id="owner-tag" style="color:var(--main); font-size:18px;">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</b>
                <button class="btn" onclick="openS('right', event)">ğŸ‘¥</button>
            </div>
            <div class="mics-row">
                <div class="mic" id="m1" onclick="joinM(1)">ğŸ™ï¸ Ù…ØªØ§Ø­</div>
                <div class="mic" id="m2" onclick="joinM(2)">ğŸ™ï¸ Ù…ØªØ§Ø­</div>
                <div class="mic" id="m3" onclick="joinM(3)">ğŸ™ï¸ Ù…ØªØ§Ø­</div>
                <div class="mic" id="m4" onclick="joinM(4)">ğŸ™ï¸ Ù…ØªØ§Ø­</div>
            </div>
        </div>

        <div id="yt-float" onclick="event.stopPropagation()">
            <div id="player" style="width:100%; height:100%;"></div>
        </div>

        <div id="chat-window" onclick="closeAll()"></div>

        <div id="emoji-shelf" onclick="event.stopPropagation()"></div>

        <div class="bar" onclick="event.stopPropagation()">
            <button class="btn" onclick="toggleE(event)">ğŸ˜Š</button>
            <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø« ÙŠØ§ Ù…Ù„Ùƒ...">
            <button class="btn" onclick="send()">ğŸš€</button>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ",
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let myID, myD = {}, isOwner = false;

    auth.onAuthStateChanged(u => {
        if(u) {
            myID = u.uid;
            isOwner = (u.email === "rgrghh77@gmail.com");
            db.ref('users/'+myID).on('value', s => {
                myD = s.val() || { n: isOwner ? "Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø¹Ù„ÙˆØ´ ğŸ‘‘" : u.email.split('@')[0], av: "https://via.placeholder.com/100", st: "ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ©" };
                db.ref('status/'+myID).set({ n: myD.n, av: myD.av, role: isOwner ? 'owner' : 'user' });
            });
            init();
            if(isOwner) botMsg("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ù„Ùƒ Ø§Ù„Ù…Ù„ÙˆÙƒØŒ Ø§Ù„Ù…Ù…Ù„ÙƒØ© ØªØ­Øª ØªØµØ±ÙÙƒ! ğŸ‘‘");
        }
    });

    function openS(d, e) { e.stopPropagation(); document.getElementById('side-'+d).classList.add('open'); }
    function closeAll() {
        document.getElementById('side-right').classList.remove('open');
        document.getElementById('side-left').classList.remove('open');
        document.getElementById('emoji-shelf').style.display = 'none';
        document.getElementById('p-card').style.display = 'none';
    }

    function editProf() {
        const n = prompt("Ø§Ø³Ù…Ùƒ:", myD.n);
        const av = prompt("Ø±Ø§Ø¨Ø· ØµÙˆØ±ØªÙƒ:", myD.av);
        const st = prompt("Ø­Ø§Ù„ØªÙƒ:", myD.st);
        db.ref('users/'+myID).update({ n, av, st });
    }

    function send() {
        const t = document.getElementById('mInp').value;
        if(!t) return;
        db.ref('msgs').push({ uid: myID, n: myD.n, av: myD.av, t: t, role: isOwner ? 'owner' : 'user' });
        document.getElementById('mInp').value = '';
    }

    function botMsg(t) { db.ref('msgs').push({ uid: 'bot', n: 'Ø¨ÙˆØª Ø§Ù„Ù…Ù…Ù„ÙƒØ© ğŸ¤–', av: 'https://cdn-icons-png.flaticon.com/512/4712/4712035.png', t: t, role: 'bot' }); }

    function init() {
        db.ref('msgs').limitToLast(30).on('child_added', s => {
            const d = s.val();
            const isMe = d.uid === myID;
            const div = document.createElement('div');
            div.className = `msg ${isMe ? 'me' : ''}`;
            div.innerHTML = `<img src="${d.av}" class="u-img" onclick="showU('${d.uid}')">
                <div class="bubble">
                    <span class="u-info ${d.role==='owner'?'rank-owner':(d.role==='bot'?'rank-bot':'')}">${d.n}</span>
                    <div class="text">${d.t}</div>
                </div>`;
            document.getElementById('chat-window').appendChild(div);
            document.getElementById('chat-window').scrollTop = document.getElementById('chat-window').scrollHeight;
        });

        // Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª Ù…Ø±ØªØ¨Ø©
        const list = ['ğŸ˜‚','ğŸ”¥','ğŸ‘‘','âœ¨','ğŸ’¯','ğŸ’','ğŸŒ¹','ğŸ’™','ğŸš€','ğŸ§¿','ğŸ‡®ğŸ‡¶','ğŸ¤','â¤ï¸','ğŸ‘Œ','ğŸ˜','ğŸ¤”','âš¡','ğŸ‰','ğŸ’ª','ğŸ¤´','ğŸ¦','ğŸ§¨'];
        list.forEach(e => { document.getElementById('emoji-shelf').innerHTML += `<span style="font-size:28px; cursor:pointer;" onclick="document.getElementById('mInp').value += '${e}'">${e}</span>`; });

        // Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†
        db.ref('status').on('value', s => {
            const l = document.getElementById('user-list'); l.innerHTML = '';
            s.forEach(u => {
                l.innerHTML += `<div style="display:flex; align-items:center; gap:8px; margin-bottom:10px; cursor:pointer;" onclick="showU('${u.key}')">
                    <img src="${u.val().av}" style="width:30px; height:30px; border-radius:50%; border:1px solid ${u.val().role==='owner'?'gold':'#444'};">
                    <span class="${u.val().role==='owner'?'rank-owner':''}">${u.val().n}</span>
                </div>`;
            });
        });

        // Ø§Ù„Ù…Ø§ÙŠÙƒØ§Øª
        for(let i=1; i<=4; i++) {
            db.ref('mics/m'+i).on('value', s => {
                const el = document.getElementById('m'+i);
                if(s.val()) { el.innerText = 'ğŸ¤ ' + s.val().n; el.classList.add('active'); }
                else { el.innerText = 'ğŸ™ï¸ Ù…ØªØ§Ø­'; el.classList.remove('active'); }
            });
        }
    }

    function joinM(i) {
        const ref = db.ref('mics/m'+i);
        ref.once('value', s => { if(s.val() && s.val().uid === myID) ref.remove(); else if(!s.val()) ref.set({uid: myID, n: myD.n}); });
    }

    function showU(uid) {
        event.stopPropagation();
        db.ref('users/'+uid).once('value', s => {
            const d = s.val(); if(!d) return;
            document.getElementById('pc-name').innerText = d.n;
            document.getElementById('pc-av').src = d.av;
            document.getElementById('pc-st').innerText = d.st;
            document.getElementById('p-card').style.display = 'block';
        });
    }

    function toggleE(e) { e.stopPropagation(); const s = document.getElementById('emoji-shelf'); s.style.display = s.style.display === 'grid' ? 'none' : 'grid'; }
    function toggleYT() { const id = prompt("ÙƒÙˆØ¯ ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨:"); if(id) { document.getElementById('yt-float').style.display = 'block'; document.getElementById('player').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1" frameborder="0"></iframe>`; } }
</script>
</body>
</html>
