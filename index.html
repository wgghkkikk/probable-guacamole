<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>MASTER RG - SUPREME EMPIRE</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; --royal: #7000ff; --bg: #030303; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ */
        header { height: 75px; background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--neon); display: flex; justify-content: space-between; align-items: center; padding: 0 20px; box-shadow: 0 0 25px rgba(0,242,255,0.2); z-index: 1000; }
        .logo-text { font-size: 24px; font-weight: 900; background: linear-gradient(45deg, var(--gold), #fff, var(--neon)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 10px rgba(255,215,0,0.3); }

        /* Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚ */
        #profile-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 5000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .profile-card { width: 90%; max-width: 400px; background: #111; border-radius: 30px; border: 2px solid var(--neon); overflow: hidden; position: relative; }
        .p-cover { width: 100%; height: 140px; background: linear-gradient(to bottom, var(--royal), #000); position: relative; background-size: cover; }
        .p-avatar { width: 100px; height: 100px; border-radius: 50%; border: 5px solid #111; position: absolute; bottom: -50px; right: 20px; object-fit: cover; box-shadow: 0 0 20px var(--neon); }
        .p-info { padding: 60px 20px 20px; }
        .p-rank { display: inline-block; padding: 4px 12px; border-radius: 20px; background: var(--gold); color: #000; font-weight: bold; font-size: 12px; margin-top: 10px; }

        /* Ø§Ù„Ø±ÙˆÙ…Ø§Øª */
        .nav-rooms { display: flex; overflow-x: auto; padding: 15px; gap: 12px; background: #080808; scrollbar-width: none; }
        .nav-rooms::-webkit-scrollbar { display: none; }
        .btn-room { background: #151515; color: #fff; padding: 10px 25px; border-radius: 50px; border: 1px solid #333; cursor: pointer; transition: 0.4s; font-weight: bold; white-space: nowrap; }
        .btn-room.active { background: var(--neon); color: #000; border-color: var(--neon); box-shadow: 0 0 15px var(--neon); }

        /* Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; background: url('https://www.transparenttextures.com/patterns/dark-matter.png'); }
        .msg-block { max-width: 85%; align-self: flex-start; animation: pop 0.3s ease; }
        .msg-block.me { align-self: flex-end; }
        @keyframes pop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        
        .bubble { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 12px 18px; border-radius: 20px; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; }
        .me .bubble { background: linear-gradient(135deg, #004455, #002233); border-color: var(--neon); }
        .user-tag { font-size: 13px; font-weight: bold; color: var(--neon); margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .quote-box { background: rgba(0,0,0,0.4); padding: 8px; border-right: 4px solid var(--gold); border-radius: 8px; margin-bottom: 8px; font-size: 12px; }

        /* Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-bar { background: #0a0a0a; padding: 15px 20px; display: flex; align-items: center; gap: 15px; border-top: 1px solid #222; }
        #reply-bar { background: var(--royal); padding: 10px 20px; display: none; justify-content: space-between; font-size: 12px; }
        #mainInput { flex: 1; background: #151515; border: 1px solid #333; color: #fff; padding: 15px; border-radius: 20px; }
        .btn-act { background: var(--neon); border: none; width: 55px; height: 55px; border-radius: 20px; color: #000; font-size: 22px; cursor: pointer; transition: 0.3s; }
        .btn-act:hover { transform: rotate(15deg) scale(1.1); }
    </style>
</head>
<body>

<div id="profile-modal">
    <div class="profile-card">
        <div class="p-cover" id="myCover"></div>
        <img src="" class="p-avatar" id="myAvatar">
        <div class="p-info">
            <h2 id="myName" style="margin:0"></h2>
            <div class="p-rank" id="myRank">MASTER ğŸ‘‘</div>
            <div style="margin-top:20px; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button onclick="editP('avatar')" class="btn-room">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</button>
                <button onclick="editP('cover')" class="btn-room">ØªØºÙŠÙŠØ± Ø§Ù„ØºÙ„Ø§Ù</button>
            </div>
            <button onclick="closeP()" style="width:100%; margin-top:15px; background:none; border:none; color:#777;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø§Ø´Ø©</button>
        </div>
    </div>
</div>

<header>
    <div class="logo-text" onclick="openP()">MASTER RG</div>
    <div id="status-tag" style="font-size:12px; color:var(--neon)">1 Ù…ØªØµÙ„</div>
</header>

<div class="nav-rooms" id="roomsMenu">
    <button class="btn-room active" onclick="join('main', this)">ğŸ‘‘ Ø§Ù„Ø¹Ø±Ø´</button>
    <button class="btn-room" onclick="join('vip', this)">ğŸ’ Ø§Ù„Ø¯ÙŠÙˆØ§Ù†</button>
    <button class="btn-room" onclick="join('game', this)">ğŸ® Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</button>
    <button class="btn-room" onclick="join('elite', this)">ğŸ¤ Ø§Ù„Ù†Ø®Ø¨Ø©</button>
</div>

<div id="reply-bar">
    <span id="replyTxt"></span>
    <button onclick="noReply()" style="background:none; border:none; color:#fff;">âœ•</button>
</div>

<div id="chat-window"></div>

<div class="input-bar">
    <button onclick="openP()" style="background:none; border:none; font-size:28px;">ğŸ‘‘</button>
    <input type="text" id="mainInput" placeholder="Ø³ÙˆÙ„Ù ÙˆÙŠÙ‡ Ø§Ù„Ø¨ÙˆØª Ø£Ùˆ Ø§ÙƒØªØ¨ 'Ø³Ø¤Ø§Ù„'..">
    <button onclick="fire()" class="btn-act">â¤</button>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let my = {
        n: localStorage.getItem('rg_n') || "",
        p: localStorage.getItem('rg_p') || "https://ui-avatars.com/api/?name=User&background=random",
        c: localStorage.getItem('rg_c') || "https://images.unsplash.com/photo-1511447333015-45b65e60f6d5?w=500",
        xp: parseInt(localStorage.getItem('rg_xp')) || 0
    };

    if(!my.n) {
        let n = prompt("ÙŠØ§ Ù…Ù„ÙƒØŒ Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
        if(n) { localStorage.setItem('rg_n', n); location.reload(); }
    }

    let curRoom = "main", replyData = null;

    function join(id, btn) {
        curRoom = id;
        document.querySelectorAll('.btn-room').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        load();
    }

    function fire() {
        let t = document.getElementById('mainInput').value.trim();
        if(!t) return;
        
        let data = { u: my.n, t: t, p: my.p, xp: my.xp, reply: replyData, time: Date.now() };
        db.ref('rooms/'+curRoom).push(data);
        
        // Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¨ÙˆØª Ø§Ù„ÙØ²Ø¹Ø©
        const brain = {
            "Ù‡Ù„Ùˆ": "ÙŠØ§ Ù…ÙŠØ© Ù‡Ù„Ø§ Ø¨Ù†ÙˆØ± Ø¹ÙŠÙˆÙ†ÙŠØŒ Ø§Ù†Ø±Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ğŸ‘‘",
            "Ø´Ù„ÙˆÙ†Ùƒ": "Ø¨Ø®ÙŠØ± ÙŠØ§ Ø°Ù‡Ø¨ØŒ Ø£Ù†Øª Ø´Ù„ÙˆÙ†Ùƒ Ø¨Ø´Ø±Ù†ÙŠØŸ",
            "Ù‡Ù‡Ù‡Ù‡": "Ø¯ÙˆÙ… Ù‡Ø§Ù„Ø¶Ø­ÙƒØ© ÙŠØ§ Ø±Ø¨ ğŸ˜‚",
            "ÙƒÙÙˆ": "ÙƒÙÙˆ Ù…Ù†Ùƒ ÙˆÙ…Ù† Ø´Ø§Ø±Ø¨ÙƒØŒ Ø£Ù†Øª Ø§Ù„Ø³Ø¨Ø¹ ÙˆØ§Ù„Ù„Ù‡",
            "Ù…Ù†ÙˆØ±": "Ù†ÙˆØ±Ùƒ Ø¹Ø§ÙƒØ³ ÙŠØ§ ØºØ§Ù„ÙŠ ğŸŒ¹",
            "Ø¶ÙˆØ¬Ø©": "Ø§ÙØ§ØŒ Ù„ÙŠØ´ Ø§Ù„Ø¶ÙˆØ¬Ø©ØŸ Ø§ÙƒØªØ¨ 'Ø³Ø¤Ø§Ù„' ÙˆØ®Ù„ÙŠÙ†Ø§ Ù†ØªØ³Ù„Ù‰!"
        };
        for(let key in brain) {
            if(t.includes(key)) {
                setTimeout(()=> db.ref('rooms/'+curRoom).push({ u: "ğŸ¤– BOT", t: brain[key], bot: true, p: "https://cdn-icons-png.flaticon.com/512/4712/4712035.png" }), 800);
                break;
            }
        }
        
        noReply();
        document.getElementById('mainInput').value = "";
    }

    function load() {
        db.ref('rooms/'+curRoom).off();
        const box = document.getElementById('chat-window');
        box.innerHTML = "";
        db.ref('rooms/'+curRoom).limitToLast(40).on('child_added', snap => {
            let m = snap.val();
            let isMe = m.u === my.n;
            let rank = m.xp > 500 ? "Ø§Ù„Ù…Ù„Ùƒ ğŸ‘‘" : (m.xp > 200 ? "VIP ğŸ’" : "Ø¹Ø¶Ùˆ ğŸ¤");
            let div = document.createElement('div');
            div.className = `msg-block ${isMe ? 'me' : ''}`;
            div.innerHTML = `
                <div class="user-tag" onclick="setRep('${m.u}','${m.t}')">
                    <img src="${m.p}" style="width:25px; height:25px; border-radius:50%">
                    ${m.u} <small style="color:var(--gold); font-size:10px;">${m.bot?'':'['+rank+']'}</small>
                </div>
                <div class="bubble" onclick="setRep('${m.u}','${m.t}')">
                    ${m.reply ? `<div class="quote-box"><b>${m.reply.u}:</b> ${m.reply.t}</div>` : ''}
                    ${m.t}
                    ${isMe ? `<br><span style="font-size:10px; color:red;" onclick="db.ref('rooms/${curRoom}/${snap.key}').remove()">Ø­Ø°Ù</span>` : ''}
                </div>`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
    }

    function setRep(u, t) {
        replyData = { u, t };
        document.getElementById('replyTxt').innerText = "Ø±Ø¯ Ø¹Ù„Ù‰ " + u;
        document.getElementById('reply-bar').style.display = 'flex';
    }

    function noReply() { replyData = null; document.getElementById('reply-bar').style.display = 'none'; }

    function openP() {
        document.getElementById('myName').innerText = my.n;
        document.getElementById('myAvatar').src = my.p;
        document.getElementById('myCover').style.backgroundImage = `url(${my.c})`;
        document.getElementById('myRank').innerText = my.xp > 500 ? "Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø§Ù„Ù…Ø§Ø³ØªØ± ğŸ‘‘" : "Ø¹Ø¶Ùˆ Ù…Ù„ÙƒÙŠ ğŸ’";
        document.getElementById('profile-modal').style.display = 'flex';
    }

    function editP(type) {
        let val = prompt(type === 'avatar' ? "Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©:" : "Ø±Ø§Ø¨Ø· Ø§Ù„ØºÙ„Ø§Ù:");
        if(val) {
            if(type==='avatar') { my.p = val; localStorage.setItem('rg_p', val); }
            else { my.c = val; localStorage.setItem('rg_c', val); }
            openP();
        }
    }

    function closeP() { document.getElementById('profile-modal').style.display = 'none'; }

    db.ref('on/'+my.n).set(true); db.ref('on/'+my.n).onDisconnect().remove();
    db.ref('on').on('value', snap => { document.getElementById('status-tag').innerText = snap.numChildren() + " Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†"; });

    load();
</script>
</body>
</html>
