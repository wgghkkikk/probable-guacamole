<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>MASTER RG - FINAL REPAIR</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; --bg: #000; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Cairo', sans-serif; }
        body { margin: 0; background: #000; color: #fff; overflow: hidden; position: fixed; width: 100%; height: 100%; }
        
        header { height: 60px; background: #111; border-bottom: 2px solid var(--neon); display: flex; justify-content: space-between; align-items: center; padding: 0 15px; z-index: 1000; position: relative; }
        
        /* Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ - Ø£Ø¶Ù…Ù† ÙˆØ£Ø³Ø±Ø¹ */
        .view { position: absolute; top: 60px; bottom: 0; left: 0; right: 0; background: #000; display: none; }
        .view.active { display: block; }

        .lobby-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .room-box { background: linear-gradient(145deg, #111, #080808); padding: 35px 10px; border-radius: 20px; border: 1px solid #333; text-align: center; color: var(--neon); cursor: pointer; font-size: 18px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .room-box:active { transform: scale(0.9); border-color: var(--neon); }

        .chat-window { position: absolute; top: 0; bottom: 85px; width: 100%; overflow-y: auto; padding: 15px; background: #050505; }
        .msg-row { display: flex; margin-bottom: 15px; animation: pop 0.2s ease; }
        @keyframes pop { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .bubble { background: #1a1a1a; padding: 12px 18px; border-radius: 18px; max-width: 85%; border-top-right-radius: 2px; border: 0.5px solid #333; }
        
        .footer { position: absolute; bottom: 0; width: 100%; height: 85px; background: #111; display: flex; align-items: center; padding: 0 15px; border-top: 1px solid #222; }
        #msgInput { flex: 1; background: #000; border: 1px solid #444; color: #fff; padding: 15px; border-radius: 15px; font-size: 14px; outline: none; }
        .btn-send { background: var(--neon); border: none; width: 55px; height: 55px; border-radius: 15px; margin-right: 10px; color: #000; font-size: 22px; cursor: pointer; }
        
        .on-dot { width: 8px; height: 8px; background: #0f0; border-radius: 50%; display: inline-block; margin-left: 5px; box-shadow: 0 0 8px #0f0; }
    </style>
</head>
<body>

<header>
    <b style="color:var(--gold); font-size: 20px;">MASTER RG ğŸ‘‘</b>
    <div style="font-size: 11px; color: var(--neon);"><span class="on-dot"></span> <span id="userCount">1</span> Ù…ØªØµÙ„</div>
</header>

<div id="lobby" class="view active">
    <div class="lobby-grid">
        <div class="room-box" onclick="goToRoom('main')">ğŸ› Ø§Ù„Ø¹Ø±Ø´</div>
        <div class="room-box" onclick="goToRoom('game')">ğŸ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</div>
        <div class="room-box" onclick="goToRoom('vip')">ğŸ’ Ø§Ù„Ø¯ÙŠÙˆØ§Ù†</div>
        <div class="room-box" onclick="goToRoom('elite')">ğŸ¤ Ø§Ù„Ù†Ø®Ø¨Ø©</div>
    </div>
</div>

<div id="chat" class="view">
    <div id="chatBox" class="chat-window"></div>
    <div class="footer">
        <input type="text" id="msgInput" placeholder="Ø³ÙˆÙ„Ù ÙˆÙŠÙ‡ Ø§Ù„Ø¨ÙˆØª Ø§Ù„ÙØ²Ø¹Ø©...">
        <button onclick="doSend()" class="btn-send">â¤</button>
        <button onclick="goBack()" style="background:#333; border:none; color:#fff; padding:10px 15px; border-radius:15px; margin-right:5px;">ğŸ </button>
    </div>
</div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ø³Ù…
    let userN = localStorage.getItem('rg_name') || "";
    if(!userN) {
        userN = prompt("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ØŒ Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
        if(userN) localStorage.setItem('rg_name', userN);
        else location.reload();
    }

    // Ø¨ÙˆØª Ø§Ù„Ø³ÙˆØ§Ù„Ù Ø§Ù„Ù…Ø·ÙˆØ±
    const brain = {
        "Ù‡Ù„Ùˆ": ["Ù‡Ù„Ø§ ÙˆØºÙ„Ø§ØŒ Ù†ÙˆØ±Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©! ğŸ‘‘", "ÙŠØ§ Ù…ÙŠØ© Ù‡Ù„Ø§ØŒ Ø´Ù„ÙˆÙ†Ùƒ ÙŠØ§ Ø¨Ø·Ù„ØŸ"],
        "Ø´Ù„ÙˆÙ†Ùƒ": ["Ø¨Ø®ÙŠØ± Ù…Ø§ Ø¯Ø§Ù… Ø§Ù„Ù…Ø§Ø³ØªØ± Ø¨Ø®ÙŠØ±.. Ø£Ù†Øª Ø¨Ø´Ø±Ù†Ø§ØŸ", "ØªÙ…Ø§Ù… Ø§Ù„ØªÙ…Ø§Ù…ØŒ Ù…Ù†ÙˆØ±Ù†Ø§ ÙˆØ§Ù„Ù„Ù‡"],
        "Ù…Ù†ÙˆØ±": ["Ù†ÙˆØ±Ùƒ Ù‡Ø°Ø§ ÙŠØ§ Ø°Ù‡Ø¨ØŒ Ø§Ù„Ø´Ø§Øª Ø´Ø¹Ø´Ø¹ Ø¨ÙˆØ¬ÙˆØ¯Ùƒ", "Ø£Ù†Øª Ø£ØµÙ„ Ø§Ù„Ù†ÙˆØ± ÙƒÙ„Ù‡ ğŸŒ¹"],
        "Ù‡Ù‡Ù‡Ù‡": ["Ø¯ÙˆÙ… Ù‡Ø§Ù„Ø¶Ø­ÙƒØ©ØŒ Ø¹Ø³Ø§Ù‡Ø§ Ø¶Ø­ÙƒØ© Ø®ÙŠØ± ğŸ˜‚", "ÙØ¯ÙˆØ© Ù„Ù‡Ø§Ù„Ø¶Ø­ÙƒØ©ØŒ Ø§Ù†Ø±ØªÙ†Ø§"],
        "ÙƒÙÙˆ": ["ÙƒÙÙˆ Ù…Ù†Ùƒ ÙˆÙ…Ù† Ø£ØµÙ„Ùƒ Ø§Ù„Ø·ÙŠØ¨ØŒ Ø°ÙŠØ¨!", "Ø£Ù†Øª Ø§Ù„Ø³Ø¨Ø¹ ÙˆØ§Ù„Ù„Ù‡ ÙŠØ§ Ø¨Ø·Ù„"],
        "Ø¶ÙˆØ¬Ø©": ["Ù„ÙŠØ´ Ø§Ù„Ø¶ÙˆØ¬Ø©ØŸ Ø§ÙƒØªØ¨ 'Ø³Ø¤Ø§Ù„' ÙˆØ®Ù„ÙŠÙ†Ø§ Ù†ØªØ³Ù„Ù‰!", "Ø³ÙˆÙ„Ù ÙˆÙŠØ§Ù†Ø§ ÙˆØ§ÙØªØ­ Ù‚Ù„Ø¨ÙƒØŒ Ø§Ù„Ø¶ÙˆØ¬Ø© ØªÙ…ÙˆØª Ù‡Ù†Ø§"],
        "Ù…Ù†Ùˆ Ø£Ù†Øª": ["Ø£Ù†Ø§ Ø¨ÙˆØª Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© MASTER RGØŒ Ø­Ø§Ø±Ø³ÙƒÙ… ÙˆØµØ¯ÙŠÙ‚ÙƒÙ… Ø§Ù„ÙˆÙÙŠ"]
    };

    let activeRoom = "";

    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø±ÙˆÙ…Ø§Øª
    function goToRoom(id) {
        activeRoom = id;
        document.getElementById('lobby').classList.remove('active');
        document.getElementById('chat').classList.add('active');
        loadMessages();
    }

    function goBack() {
        document.getElementById('chat').classList.remove('active');
        document.getElementById('lobby').classList.add('active');
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    function doSend() {
        let t = document.getElementById('msgInput').value.trim();
        if(!t) return;

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ø¶Ùˆ
        db.ref('rooms/'+activeRoom).push({ u: userN, t: t });

        // ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¨ÙˆØª
        for(let key in brain) {
            if(t.toLowerCase().includes(key)) {
                let r = brain[key][Math.floor(Math.random()*brain[key].length)];
                setTimeout(() => {
                    db.ref('rooms/'+activeRoom).push({ u: "ğŸ¤– BOT", t: r, isBot: true });
                }, 800);
                break;
            }
        }
        document.getElementById('msgInput').value = "";
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    function loadMessages() {
        db.ref('rooms/'+activeRoom).off();
        let box = document.getElementById('chatBox');
        box.innerHTML = "";
        db.ref('rooms/'+activeRoom).limitToLast(30).on('child_added', snap => {
            let m = snap.val();
            let div = document.createElement('div');
            div.className = 'msg-row';
            div.innerHTML = `<div class="bubble"><b style="color:${m.isBot?'var(--gold)':'var(--neon)'}">${m.u}</b><br>${m.t}</div>`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        });
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    db.ref('online/'+userN).set(true);
    db.ref('online/'+userN).onDisconnect().remove();
    db.ref('online').on('value', snap => {
        document.getElementById('userCount').innerText = snap.numChildren();
    });

</script>
</body>
</html>
