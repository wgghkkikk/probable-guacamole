<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­ÙƒÙ… Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main: #ffd700; --bg: #000; --side-w: 200px; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø®ÙÙŠØ© */
        #master-panel { 
            position: fixed; top: 10%; left: 10%; right: 10%; bottom: 10%; 
            background: rgba(15,15,15,0.95); border: 2px solid var(--main); 
            z-index: 9999; border-radius: 20px; padding: 20px; display: none; overflow-y: auto;
            box-shadow: 0 0 50px var(--main);
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ù…Ø±Ù†Ø© */
        #sidebar { 
            width: var(--side-w); background: #0a0a0a; border: 1px solid var(--main);
            position: relative; transition: 0.5s; display: flex; flex-direction: column;
        }

        .main-chat { flex: 1; display: flex; flex-direction: column; background: #000; }
        #chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        
        /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .msg { padding: 10px; border-radius: 12px; max-width: 80%; background: #111; border: 1px solid #222; position: relative; }
        .msg.me { align-self: flex-end; border-color: var(--main); }
        .del-msg { color: red; cursor: pointer; float: left; font-weight: bold; display: none; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        .admin-only { display: none; }
        .control-btn { background: var(--main); color: #000; border: none; padding: 10px; margin: 5px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 150px; }
        .toggle-gear { font-size: 24px; cursor: pointer; background: none; border: none; color: var(--main); padding: 10px; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h3 style="text-align:center; color:var(--main);">Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† ğŸ‡®ğŸ‡¶</h3>
        <div id="online-list" style="padding:10px;"></div>
    </div>

    <div class="main-chat">
        <div style="background:#111; display:flex; justify-content:space-between; align-items:center; padding:5px 15px; border-bottom:1px solid #222;">
            <button class="admin-only toggle-gear" onclick="togglePanel()">âš™ï¸</button>
            <h2 style="margin:0; color:var(--main); font-size:18px;">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</h2>
            <div id="clock" style="font-size:12px; color:gray;"></div>
        </div>

        <div id="chat-box"></div>

        <div style="padding:15px; background:#111; display:flex; gap:10px;">
            <button onclick="document.getElementById('fInp').click()" style="background:none; border:none; font-size:20px; cursor:pointer;">ğŸ“</button>
            <input type="file" id="fInp" accept="image/*" style="display:none" onchange="uploadFile(this)">
            <input type="text" id="mInp" placeholder="ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±..." style="flex:1; background:#000; color:#fff; border:1px solid #333; padding:10px; border-radius:20px; outline:none;">
            <button onclick="send()" style="background:var(--main); border:none; padding:10px 20px; border-radius:20px; font-weight:bold; cursor:pointer;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

    <div id="master-panel">
        <h2 style="color:var(--main); text-align:center;">ğŸ› ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±</h2>
        <hr border="1" color="#333">
        <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:20px;">
            <button class="control-btn" onclick="setSide('right')">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙŠÙ…ÙŠÙ† â¡ï¸</button>
            <button class="control-btn" onclick="setSide('left')">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙŠØ³Ø§Ø± â¬…ï¸</button>
            <button class="control-btn" onclick="hideElement('sidebar')">Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ—‘ï¸</button>
            <button class="control-btn" onclick="location.reload()">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ”„</button>
            <button class="control-btn" onclick="changeTheme('#ff0000')">Ø«ÙŠÙ… Ø£Ø­Ù…Ø± ğŸ”´</button>
            <button class="control-btn" onclick="changeTheme('#ffd700')">Ø«ÙŠÙ… Ø°Ù‡Ø¨ÙŠ ğŸŸ¡</button>
            <button class="control-btn" onclick="changeTheme('#00f2ff')">Ø«ÙŠÙ… Ù†ÙŠÙˆÙ† ğŸ”µ</button>
            <button class="control-btn" style="background:red; color:white;" onclick="clearAll()">Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Øª ğŸ§¨</button>
        </div>
        <button onclick="togglePanel()" style="display:block; margin:30px auto; padding:10px 40px; border-radius:10px; background:#fff; font-weight:bold;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø©</button>
    </div>

<script>
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ", 
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const auth = firebase.auth();
    const db = firebase.database();

    function togglePanel() {
        const p = document.getElementById('master-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function setSide(dir) {
        document.body.style.flexDirection = dir === 'right' ? 'row-reverse' : 'row';
    }

    function hideElement(id) { document.getElementById(id).style.display = 'none'; }

    function changeTheme(color) { document.documentElement.style.setProperty('--main', color); }

    function clearAll() { if(confirm("Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ")) db.ref('msgs').remove(); }

    auth.onAuthStateChanged(user => {
        if (user) {
            const isMe = user.email === "rgrghh77@gmail.com";
            if(isMe) document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
            const name = isMe ? "Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            db.ref('online/' + user.uid).set({ n: name }).onDisconnect().remove();
            loadChat(isMe);
            loadUsers();
        } else { window.location.href = "index.html"; }
    });

    function send() {
        const i = document.getElementById('mInp');
        if(i.value.trim()) {
            db.ref('msgs').push({
                u: auth.currentUser.email === "rgrghh77@gmail.com" ? "Ø¹Ù„ÙˆØ´ ğŸ‘‘" : auth.currentUser.email.split('@')[0],
                t: i.value,
                a: auth.currentUser.email === "rgrghh77@gmail.com",
                type: 'text'
            });
            i.value = '';
        }
    }

    function uploadFile(input) {
        if (input.files && input.files[0]) {
            const r = new FileReader();
            r.onload = e => {
                db.ref('msgs').push({
                    u: auth.currentUser.email === "rgrghh77@gmail.com" ? "Ø¹Ù„ÙˆØ´ ğŸ‘‘" : auth.currentUser.email.split('@')[0],
                    t: e.target.result,
                    type: 'image'
                });
            };
            r.readAsDataURL(input.files[0]);
        }
    }

    function loadChat(isMe) {
        db.ref('msgs').on('child_added', snap => {
            const d = snap.val();
            const id = snap.key;
            const div = document.createElement('div');
            div.className = `msg ${d.a ? 'me' : 'other'}`;
            const delBtn = isMe ? `<span class="del-msg" style="display:inline" onclick="deleteMsg('${id}')">Ã—</span>` : '';
            const content = d.type === 'image' ? `<img src="${d.t}" style="width:100%; border-radius:8px;">` : d.t;
            div.innerHTML = `${delBtn}<b style="color:var(--main); font-size:11px; display:block;">${d.u}</b>${content}`;
            document.getElementById('chat-box').appendChild(div);
            document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
        });
        db.ref('msgs').on('child_removed', () => location.reload());
    }

    function deleteMsg(id) { if(confirm("Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ")) db.ref('msgs').child(id).remove(); }

    function loadUsers() {
        db.ref('online').on('value', snap => {
            const uBox = document.getElementById('online-list');
            uBox.innerHTML = '';
            snap.forEach(c => { uBox.innerHTML += `<div style="margin-bottom:8px; font-size:13px;">ğŸŸ¢ ${c.val().n} ğŸ‡®ğŸ‡¶</div>`; });
        });
    }

    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>
