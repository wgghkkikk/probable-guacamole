<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER RG - FINAL EDITION</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --royal-bg: #ffffff; --theme-owner: linear-gradient(90deg, #ff0000, #330000, #ff0000); --gold: #d4af37; }
        body { margin: 0; background: var(--royal-bg); color: #333; font-family: 'Cairo', sans-serif; height: 100vh; display: flex; overflow: hidden; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
        #side { width: 240px; background: #fafafa; border-left: 1px solid #eee; display: flex; flex-direction: column; }
        .u-row { padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px; font-weight: bold; display: flex; align-items: center; gap: 8px; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        #main { flex: 1; display: flex; flex-direction: column; position: relative; }
        header { padding: 10px 20px; border-bottom: 2px solid #f5f5f5; display: flex; justify-content: space-between; align-items: center; background: #fff; }

        /* Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« - Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© */
        .refresh { cursor: pointer; text-align: center; color: #555; transition: 0.3s; }
        .refresh:active { transform: rotate(180deg); }

        /* Ø¨Ø§Ø± Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
        .rank-bar {
            position: relative; width: 180px; height: 30px; margin: 10px auto;
            border-radius: 5px; overflow: hidden; display: flex; align-items: center; justify-content: center;
            color: #fff; font-weight: 900; font-size: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .rank-bar::before {
            content: ""; position: absolute; inset: 0;
            background: var(--theme-owner); background-size: 200% 200%;
            animation: move-bg 3s linear infinite; z-index: -1;
        }
        @keyframes move-bg { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }

        /* Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„ÙˆØ³Ø· */
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; background: #fff; }
        .msg-wrap { width: 100%; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .msg-txt { max-width: 80%; padding: 10px 20px; border-radius: 12px; background: #f1f1f1; color: #000; font-size: 16px; border: 1px solid #e0e0e0; }
        .owner-box { border: 2px solid #ff0000; background: #fffcfc; }

        /* Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-box { padding: 15px; border-top: 1px solid #eee; display: flex; gap: 10px; background: #fff; }
        #mInp { flex: 1; border: 1px solid #ddd; padding: 10px; border-radius: 8px; outline: none; }
        .btn-send { background: #333; color: #fff; border: none; padding: 0 20px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<div id="side">
    <div style="padding:15px; background:#f0f0f0; font-weight:900; color:var(--gold);">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† ğŸŒ</div>
    <div id="uList"></div>
</div>

<div id="main">
    <header>
        <div style="font-weight:900; font-size:20px;">MASTER RG ğŸ‘‘</div>
        <div class="refresh" onclick="location.reload()">
            <span style="font-size:20px;">ğŸ”„</span><br><span style="font-size:8px; font-weight:bold;">ØªØ­Ø¯ÙŠØ«</span>
        </div>
    </header>

    <div id="chat"></div>

    <div class="input-box">
        <input type="text" id="mInp" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...">
        <button onclick="send()" class="btn-send">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<script>
    const config = { databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let myName = localStorage.getItem('rg_name') || "";
    if(!myName) {
        myName = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:");
        if(myName) localStorage.setItem('rg_name', myName); else location.reload();
    }

    // Ø±ØªØ¨Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª Ù„Ù„Ù…Ø§Ø³ØªØ±
    let myRank = (myName === "Ù…Ø§Ø³ØªØ±" || myName === "MASTER RG") ? "ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª" : "Ø¹Ø¶Ùˆ Ù…Ù„ÙƒÙŠ";

    function send() {
        let t = document.getElementById('mInp').value.trim();
        if(!t) return;
        db.ref('last_ver/main').push({ u: myName, t: t, r: myRank });
        document.getElementById('mInp').value = "";
    }

    function load() {
        db.ref('last_ver/main').limitToLast(40).on('child_added', snap => {
            let m = snap.val();
            let isOwner = m.r === "ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª";
            let div = document.createElement('div');
            div.className = "msg-wrap";
            div.innerHTML = `
                <div class="rank-bar" style="${isOwner ? '' : 'background:#555; border:none;'}">
                    ${isOwner ? 'ğŸ‘‘ ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø§Øª ğŸ‘‘' : m.r}
                </div>
                <div style="font-weight:bold; font-size:12px; margin-bottom:4px; color:#999;">${m.u}</div>
                <div class="msg-txt ${isOwner ? 'owner-box' : ''}">${m.t}</div>
            `;
            document.getElementById('chat').appendChild(div);
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        });
    }

    db.ref('online_final/'+myName).set({ n: myName, r: myRank });
    db.ref('online_final/'+myName).onDisconnect().remove();
    db.ref('online_final').on('value', snap => {
        let list = document.getElementById('uList'); list.innerHTML = "";
        snap.forEach(u => {
            let user = u.val();
            list.innerHTML += `<div class="u-row">ğŸŸ¢ ${user.n} <small style="color:#aaa;">(${user.r})</small></div>`;
        });
    });

    load();
</script>
</body>
</html>
