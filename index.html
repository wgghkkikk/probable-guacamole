<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --gold: #ffd700; --dark: #000; }
        body { background: var(--dark); color: #fff; font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠØ³Ø±Ù‰ (Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†) */
        #users-sidebar { 
            width: 200px; 
            background: rgba(10,10,10,0.98); 
            border-right: 1px solid var(--gold); 
            padding: 15px; 
            position: fixed;
            left: -235px; /* Ù…Ø®ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
            top: 0;
            bottom: 0;
            z-index: 1000;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 5px 0 15px rgba(255, 215, 0, 0.1);
        }
        #users-sidebar.open { left: 0; }

        /* Ø²Ø± ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø¬Ù‡Ø© Ø§Ù„ÙŠØ³Ø§Ø±) */
        .toggle-users {
            position: fixed;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gold);
            color: #000;
            border: none;
            width: 35px;
            height: 60px;
            border-radius: 0 10px 10px 0;
            cursor: pointer;
            z-index: 1001;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px var(--gold);
        }

        .user-card { 
            padding: 12px; 
            border-radius: 10px; 
            background: #1a1a1a; 
            margin-bottom: 10px; 
            border: 1px solid #333;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .online-dot { width: 10px; height: 10px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 8px #00ff00; }
        .name-glow { color: var(--gold); font-weight: bold; text-shadow: 0 0 5px var(--gold); flex: 1; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-content { flex: 1; display: flex; flex-direction: column; width: 100%; }
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; background: radial-gradient(circle, #111, #000); }

        .msg { padding: 12px; border-radius: 15px; max-width: 80%; word-wrap: break-word; animation: slideIn 0.3s ease; }
        .msg.me { align-self: flex-end; background: #222; border-right: 4px solid var(--gold); }
        .msg.other { align-self: flex-start; background: #111; border-left: 4px solid #fff; }

        .input-area { background: #111; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #222; }
        input[type="text"] { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #333; background: #000; color: #fff; outline: none; }
        .send-btn { background: var(--gold); border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }

        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

    <button class="toggle-users" onclick="toggleSidebar()">â—€</button>

    <div id="users-sidebar">
        <h3 style="color:var(--gold); text-align:center; margin-top:0;">Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† ğŸ‡®ğŸ‡¶</h3>
        <hr style="border: 0.5px solid #222;">
        <div id="online-users"></div>
    </div>

    <div class="main-content">
        <div style="background:#111; padding:15px; text-align:center; border-bottom:1px solid #222;">
            <h2 style="margin:0; color:var(--gold); font-size:18px;">Ù…Ù…Ù„ÙƒØ© Ø¹Ù„ÙˆØ´ ğŸ‘‘</h2>
        </div>

        <div id="chat-window"></div>

        <div class="input-area">
            <button onclick="document.getElementById('fInp').click()" style="background:none; border:none; font-size:22px; cursor:pointer;">ğŸ“</button>
            <input type="file" id="fInp" accept="image/*" style="display:none" onchange="upImg(this)">
            <input type="text" id="mInp" placeholder="Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ø§Ù‹ ÙŠØ§ Ù…Ù„Ùƒ...">
            <button class="send-btn" onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

    <audio id="notif" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>

<script>
    const config = {
        apiKey: "AIzaSyDpjqkb4U-RF71r_Zv3tHAV9wWWe2L3pEQ", 
        authDomain: "masterchat-f2da9.firebaseapp.com",
        databaseURL: "https://masterchat-f2da9-default-rtdb.firebaseio.com",
        projectId: "masterchat-f2da9"
    };
    firebase.initializeApp(config);
    const auth = firebase.auth();
    const db = firebase.database();

    function toggleSidebar() {
        const side = document.getElementById('users-sidebar');
        const btn = document.querySelector('.toggle-users');
        side.classList.toggle('open');
        btn.innerText = side.classList.contains('open') ? "â–¶" : "â—€";
        btn.style.left = side.classList.contains('open') ? "200px" : "10px";
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            const myName = user.email === "rgrghh77@gmail.com" ? "Ø¹Ù„ÙˆØ´ ğŸ‘‘" : user.email.split('@')[0];
            const ref = db.ref('online/' + user.uid);
            ref.set({ n: myName, t: Date.now() });
            ref.onDisconnect().remove();
            loadChat();
            loadUsers();
        } else { window.location.href = "index.html"; }
    });

    function sendMsg() {
        const i = document.getElementById('mInp');
        if(i.value.trim()) {
            db.ref('msgs').push({
                u: auth.currentUser.email === "rgrghh77@gmail.com" ? "Ø¹Ù„ÙˆØ´ ğŸ‘‘" : auth.currentUser.email.split('@')[0],
                t: i.value,
                a: auth.currentUser.email === "rgrghh77@gmail.com",
                type: 'text'
            });
            i.value = '';
        }
    }

    function upImg(input) {
        if (input.files && input.files[0]) {
            const r = new FileReader();
            r.onload = e => {
                db.ref('msgs').push({
                    u: auth.currentUser.email === "rgrghh77@gmail.com" ? "Ø¹Ù„ÙˆØ´ ğŸ‘‘" : auth.currentUser.email.split('@')[0],
                    t: e.target.result,
                    type: 'image'
                });
            };
            r.readAsDataURL(input.files[0]);
        }
    }

    function loadChat() {
        const win = document.getElementById('chat-window');
        db.ref('msgs').limitToLast(40).on('child_added', snap => {
            const d = snap.val();
            const isMe = d.u.includes("Ø¹Ù„ÙˆØ´") && auth.currentUser.email === "rgrghh77@gmail.com" || d.u === auth.currentUser.email.split('@')[0];
            const content = d.type === 'image' ? `<img src="${d.t}" style="width:100%; border-radius:10px;">` : d.t;
            
            const div = document.createElement('div');
            div.className = `msg ${isMe ? 'me' : 'other'}`;
            div.innerHTML = `<b style="color:gold; font-size:11px; display:block; margin-bottom:5px;">${d.u}</b>${content}`;
            win.appendChild(div);
            win.scrollTop = win.scrollHeight;
            if(!isMe) document.getElementById('notif').play().catch(()=>{});
        });
    }

    function loadUsers() {
        const uBox = document.getElementById('online-users');
        db.ref('online').on('value', snap => {
            uBox.innerHTML = '';
            snap.forEach(c => {
                const u = c.val();
                uBox.innerHTML += `
                    <div class="user-card">
                        <div class="online-dot"></div>
                        <span class="name-glow">${u.n}</span>
                        <span>ğŸ‡®ğŸ‡¶</span>
                    </div>`;
            });
        });
    }
</script>
</body>
</html>
